<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/gg.png">
  <link rel="mask-icon" href="/images/gg.png" color="#222">
  <meta name="google-site-verification" content="J5sjnNRD2AYPWVE08_-8XO_8mBKRYD3NKVYRBCGMwQ8">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">



<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S5ZWC157GD');
</script>

<style>
    @font-face {
        /* font-family: "JasonHandwriting1-Regular"; */
/*
        src: url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff2) format("woff2"), url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff) format("woff");
		*/

        font-family: "ä¿æ–¹é«”11è™Ÿ";
        src: url(/fonts/Cubic_11_1.000_R.woff) format("woff")
    }
</style>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.blog.lasai.com.tw","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="&nbsp;">
<meta property="og:type" content="article">
<meta property="og:title" content="docker åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜">
<meta property="og:url" content="https://www.blog.lasai.com.tw/posts/docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C%E7%AD%86%E8%A8%98/index.html">
<meta property="og:site_name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
<meta property="og:description" content="&nbsp;">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2021-05-12T11:19:58.000Z">
<meta property="article:modified_time" content="2025-02-19T09:29:19.093Z">
<meta property="article:author" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.blog.lasai.com.tw/posts/docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C%E7%AD%86%E8%A8%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>docker åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜ | ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S5ZWC157GD');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!-- google ad -->
  <!--
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1069539516107706"
     crossorigin="anonymous"></script>
  -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!--
  <div class="spell" ></div>
  <div class="ghost" style="display: none;"></div>
  <div class="noise"></div>
  <div class="noise2"></div>
  -->


  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ğŸŒ¹ å–‡ä½å–‡è³½ ğŸŒ¹</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>çœŸå–‡è³½</a>

  </li>
        <li class="menu-item menu-item-map">

    <a href="/map/" rel="section"><i class="fa fa-map fa-fw"></i>å–‡è³½äººçš„å¥‡æ€ªç¾é£Ÿåœ°åœ–</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>é—œæ–¼å–‡è³½äºº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>å–‡è³½çš„æ¨™ç±¤</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å–‡è³½äº‚å¯«</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœå°‹
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœå°‹..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://www.blog.lasai.com.tw/posts/docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C%E7%AD%86%E8%A8%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
      <meta itemprop="description" content="ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜
        </h1>

        <div class="post-meta">
		
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">äº‚å¯«æ–¼</span>

              <time title="äº‚å…¥æ™‚é–“ï¼š2021-05-12 19:19:58" itemprop="dateCreated datePublished" datetime="2021-05-12T19:19:58+08:00">2021-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°æ–¼</span>
                <time title="ä¿®æ”¹æ™‚é–“ï¼š2025-02-19 17:29:19" itemprop="dateModified" datetime="2025-02-19T17:29:19+08:00">2025-02-19</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/posts/docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C%E7%AD%86%E8%A8%98/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/docker-åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="å»¢è©±å­—æ•¸">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">å»¢è©±å­—æ•¸ï¼š</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="æ‰€éœ€å‚·çœ¼æ™‚é–“">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">æ‰€éœ€å‚·çœ¼æ™‚é–“ &asymp;</span>
              <span>14 åˆ†é˜</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&nbsp;</p>
<span id="more"></span>

<h3 id="powershell-äº‹å‰æº–å‚™"><a href="#powershell-äº‹å‰æº–å‚™" class="headerlink" title="powershell äº‹å‰æº–å‚™"></a>powershell äº‹å‰æº–å‚™</h3><p>ç¤™æ–¼ä¹‹å‰æ•´ç† powershell æ¯”è¼ƒæ•£äº‚ , æˆ‘å·²ç¶“æ›´æ–°æˆ<a target="_blank" rel="noopener" href="https://weber87na.github.io/2021/12/01/%E6%88%91%E7%9A%84-powershell-%E8%A8%AD%E5%AE%9A/">é€™ç¯‡</a><br>å®‰è£ <code>CHOCOLATEY</code> <a target="_blank" rel="noopener" href="https://chocolatey.org/install">å®˜ç¶²</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(&#x27;https://chocolatey.org/install.ps1&#x27;))</span><br></pre></td></tr></table></figure>

<p>choco å®‰è£ <code>gsudo</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install gsudo</span><br></pre></td></tr></table></figure>

<p>æˆ–ä½¿ç”¨ powershell å®‰è£ <code>gsudo</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell -Command &quot;Set-ExecutionPolicy RemoteSigned -scope Process; iwr -useb https://raw.githubusercontent.com/gerardog/gsudo/master/installgsudo.ps1 | iex&quot;</span><br></pre></td></tr></table></figure>

<p>å®‰è£ firacode å­—é«” (å»ºè­°è¦å®‰è£ , é€™æ¨£ä½¿ç”¨ git-posh æ‰æœƒæ­£å¸¸é¡¯ç¤º)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install firacode</span><br></pre></td></tr></table></figure>
<p>æˆ–<a target="_blank" rel="noopener" href="https://github.com/tonsky/FiraCode">å®˜ç¶²ä¸‹è¼‰</a> , è§£å£“ç¸®ä»¥å¾Œé¸ <code>ttf</code> å…¨é¸ä»¥å¾Œå³éµå®‰è£</p>
<h3 id="è¨­å®š-windows-ssh-powershell-é€£ç·š"><a href="#è¨­å®š-windows-ssh-powershell-é€£ç·š" class="headerlink" title="è¨­å®š windows ssh powershell é€£ç·š"></a>è¨­å®š windows ssh powershell é€£ç·š</h3><p>æˆ‘é€™é‚Šç›´æ¥ä½¿ç”¨ windows çš„ powershell ä¾†é€²è¡Œé€£ç·š , å› ç‚ºé è¨­çš„ powershell ç•«é¢å¾ˆé†œ , åƒæ˜¯å¾ˆå¤è€çš„ç•¶æ©Ÿç•«é¢ , æ‰€ä»¥ç¨å¾® config ä¸€ä¸‹<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/163007658">powershell å­—é«”è¨­å®š</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é›»è…¦\HKEY_CURRENT_USER\Console\%SystemRoot%_SysWOW64_WindowsPowerShell_v1.0_powershell.exe</span><br><span class="line">FaceName è¨­å®š Fira Code æ³¨æ„æœ‰ç©ºæ ¼</span><br></pre></td></tr></table></figure>
<p>è¨­å®šå¥½å¾Œé–‹å•Ÿ powershell &#x3D;&gt; <code>å³éµ</code> &#x3D;&gt; <code>å…§å®¹</code> &#x3D;&gt; <code>å­—å‹</code> &#x3D;&gt; <code>Fira Code</code> å³å¯</p>
<p>è¬ä¸€æœ‰ä½¿ç”¨ powerline é€™é¬¼æ±è¥¿ , å¯ä»¥åˆ°é€™å€‹ç¶²é <a target="_blank" rel="noopener" href="https://github.com/powerline/fonts">ä¸‹è¼‰</a><br>é¸æ“‡é€™å€‹å­—é«” <code>DejaVu Sans Mono for Powerline</code> , å…¶ä»–å­—é«”æ¸¬ä¸å‡ºä¾† , åœ–ç¤ºéƒ½æœƒäº‚ç¢¼ , å®‰è£å¥½çš„è©±ç”¨ ssh é€£ç·š ubuntu ä¹Ÿå¯ä»¥æ­£å¸¸é¡¯ç¤º</p>
<p>å¾Œä¾†ç™¼ç¾ä¸ç®¡ç”¨ä»€éº¼å­—é«”åªè¦æ˜¯ run powershell éƒ½æœƒè·‘æ‰è®Šå›åŸå½¢å¾ˆé†œ , æ‰¾åˆ°ä¿å“¥<a target="_blank" rel="noopener" href="https://blog.miniasp.com/post/2017/12/06/Microsoft-YaHei-Mono-Chinese-Font-for-Command-Prompt-and-WSL">é€™ç¯‡</a> åªè¦ä¸‹è¼‰ä»–çš„å­—é«”å°±å¯ä»¥è§£æ±ºå•é¡Œ , ä½†æ˜¯ä¸€äº› icon é‚„æ˜¯ç„¡è§£è‡³å°‘é–‹ vim ä¸æœƒè·‘æ‰ , å°æ²’æœ‰ windows terminal çš„ç’°å¢ƒå¹«åŠ©æ»¿å¤§çš„<br>å¦å¤–æ²è»¸æ²’æœ‰ 30 cm çš„è©±å¯ä»¥ç”¨è€å¤–çš„<a target="_blank" rel="noopener" href="https://mcpmag.com/articles/2013/03/12/powershell-screen-buffer-size.aspx">è¨­å®š</a> è€å¤–ç›´æ¥è¨­å®š 3000 cmçœŸæ˜¯ç‹ è…³è‰²</p>
<p>å®‰è£ powershell é»‘è‰²ç³»ä½ˆæ™¯ <a target="_blank" rel="noopener" href="https://github.com/dracula/powershell">Dracula</a><br>ä¸‹è¼‰å¾Œè§£å£“ <code>dist\ColorTool</code> åŸ·è¡Œ <code>install.cmd</code> å³å¯å®Œæˆå®‰è£ , ä¸¦ä¸”å°‡ <code>dracula-prompt-configuration.ps1</code> å…§çš„è¨­å®šè²¼åˆ° <code>$profile</code><br>powershell <code>$profile</code> çš„è¨­å®šæª” <code>profile.ps1</code> è·Ÿ <code>.bashrc</code> é¡ä¼¼ , å°±æ˜¯ç”¨ä¾†åˆå§‹åŒ– powershell çš„è¨­å®šæª”<br>ä¸€èˆ¬æœƒåœ¨ä»¥ä¸‹è·¯å¾‘å…§æ–°å¢ä¸€å€‹ <code>profile.ps1</code> æ–‡ä»¶ä¾†é€²è¡Œç®¡ç† , è‹¥æœ‰ <code>Microsoft.PowerShell_profile.ps1</code> ä¹Ÿå¯ä»¥ç›´æ¥ç·¨è¼¯ä»–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#for admin</span><br><span class="line">C:\Windows\System32\WindowsPowerShell\v1.0</span><br><span class="line"></span><br><span class="line">#for user</span><br><span class="line">C:\Users\YourName\Documents\WindowsPowerShell\</span><br></pre></td></tr></table></figure>

<p>å®‰è£ oh-my-posh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Install-Module posh-git -Scope CurrentUser</span><br><span class="line">Install-Module oh-my-posh -Scope CurrentUser</span><br></pre></td></tr></table></figure>

<p>å®‰è£ <a target="_blank" rel="noopener" href="https://github.com/matt9ucci/DockerCompletion">DockerCompletion</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module DockerCompletion</span><br></pre></td></tr></table></figure>

<p>å•Ÿå‹•æ­·å²é æ¸¬æç¤º <a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/powershell/announcing-psreadline-2-1-with-predictive-intellisense/">predictive</a><br>æ³¨æ„é è¨­æ˜¯é—œé–‰çš„éœ€è¦è‡ªè¡Œå•Ÿç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module PSReadLine -RequiredVersion 2.1.0</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œé¡å¤–è¨­å®šè‡ªå·±çš„ config , éç¨‹ä¸­å¤ªé »ç¹æ‡¶å¾—æ‰“ docker ç›´æ¥ç”¨ alias , å¦å¤–é‚„æœ‰åƒæ˜¯ history æœå°‹å¯ä»¥æŒ‰ <code>ctrl + r</code> å¾€å‰æœå°‹é€™ç¨®ä¸éŒ¯çš„å°æŠ€å·§å¯ä»¥ç”¨ , è©³æƒ…åƒè€ƒ<a target="_blank" rel="noopener" href="https://www.thewindowsclub.com/how-to-see-powershell-command-history-on-windows-10">å°åº¦ä»”</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#è¨­å®š powershell çš„ key binding emacs style</span><br><span class="line">Set-PSReadLineOption -EditMode Emacs</span><br><span class="line">Import-Module posh-git</span><br><span class="line">Import-Module oh-my-posh</span><br><span class="line"></span><br><span class="line">#æ³¨æ„ posh v3 æ–°ç‰ˆæ˜¯é€™å€‹å‘½ä»¤ä¸æ˜¯ Set-Theme</span><br><span class="line">Set-PoshPrompt darkblood</span><br><span class="line"></span><br><span class="line">#è¨­å®š docker alias</span><br><span class="line">Set-Alias -Name d -Value docker</span><br><span class="line"></span><br><span class="line">#å•Ÿç”¨ docker æç¤º</span><br><span class="line">Import-Module DockerCompletion</span><br><span class="line"></span><br><span class="line">#è¨­å®šæ­·å²é æ¸¬æç¤º</span><br><span class="line">Set-PSReadLineOption -PredictionSource History</span><br></pre></td></tr></table></figure>

<p>æ¥è‘—å¯èƒ½æœƒç”¨ powershell ä»¥ Nuget å®‰è£å¥—ä»¶ , ç”¨ admin åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ , é˜²æ­¢å¾ŒçºŒç‚¸å‡º error</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12</span><br><span class="line">Install-PackageProvider -Name NuGet</span><br></pre></td></tr></table></figure>

<p>è¬ä¸€ docker ç‚¸å‡ºä»¥ä¸‹ error</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error during connect: Get http://%2F%2F.%2Fpipe%2Fdocker_engine/v1.38/images/json: open //./pipe/docker_engine: The system cannot find the file specified. In the default daemon configuration on Windows, the docker client must be run elevated to connect. This error may also indicate that the docker daemon is not running</span><br></pre></td></tr></table></figure>

<p>è«‹è¼¸å…¥ä»¥ä¸‹å‘½ä»¤å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;C:\Program Files\Docker\Docker&quot;</span><br><span class="line">./DockerCli.exe -SwitchDaemon</span><br></pre></td></tr></table></figure>

<p>åˆ‡æ› docker ä½¿ç”¨çš„ engine linux or windows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#åˆ‡æˆ linux</span><br><span class="line">./DockerCli.exe -SwitchLinuxEngine</span><br><span class="line"></span><br><span class="line">#åˆ‡æˆ windows</span><br><span class="line">./DockerCli.exe -SwitchWindowsEngine</span><br></pre></td></tr></table></figure>

<h3 id="docker-åŸºæœ¬è§€å¿µåŠæ“ä½œ"><a href="#docker-åŸºæœ¬è§€å¿µåŠæ“ä½œ" class="headerlink" title="docker åŸºæœ¬è§€å¿µåŠæ“ä½œ"></a>docker åŸºæœ¬è§€å¿µåŠæ“ä½œ</h3><p>image &#x3D;&gt; æª”æ¡ˆ<br>container &#x3D;&gt; æª”æ¡ˆå…§çš„è»Ÿé«”</p>
<p>æŸ¥çœ‹è³‡è¨Šçš„åŸºæœ¬å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#çœ‹ä¸€äº›è³‡è¨Š</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line">#ç›®å‰åŸ·è¡Œä¸­çš„ container</span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line">#æ³¨æ„çœ‹çœ‹æ˜¯ windows or linux</span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line">#å¹«åŠ©è¨Šæ¯</span><br><span class="line">docker help</span><br><span class="line">docker container --help</span><br><span class="line">docker container attach --help</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„è¨Šæ¯å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#çœ‹é€™æ©Ÿå™¨ä¸Šæœ‰å¤šå°‘ image</span><br><span class="line">docker image ls</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">#çœ‹ç›®å‰ running çš„</span><br><span class="line">docker container ls</span><br><span class="line"></span><br><span class="line">#çœ‹æ²’ running çš„</span><br><span class="line">docker container ls -a</span><br><span class="line"></span><br><span class="line">docker container ls --no-trunc -a</span><br><span class="line">docker image ls --no-trunc -a</span><br></pre></td></tr></table></figure>

<p>æœå°‹èˆ‡ä¸‹è¼‰ image<br><a target="_blank" rel="noopener" href="https://hub.docker.com/search?image_filter=official&type=image">ç†±é–€çš„ image</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#æœå°‹</span><br><span class="line">docker search hello-world</span><br><span class="line"></span><br><span class="line">#æœå°‹æ˜Ÿæ˜Ÿæ•¸å¤§æ–¼ 100 çš„</span><br><span class="line">docker search nginx -f stars=100</span><br><span class="line"></span><br><span class="line">#æ‹‰ hello-world</span><br><span class="line">docker image pull hello-world</span><br><span class="line">docker pull hello-world</span><br><span class="line"></span><br><span class="line">docker pull busybox</span><br><span class="line"></span><br><span class="line">#çœ‹çœ‹è‡ªå·±æœ‰ä»€éº¼ image</span><br><span class="line">docker image ls</span><br></pre></td></tr></table></figure>

<p>åŸ·è¡Œ hello-world</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run hello-world</span><br></pre></td></tr></table></figure>

<p>åŸ·è¡Œ ubuntu äº¤äº’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu</span><br><span class="line"></span><br><span class="line">#-i interactive äº¤äº’</span><br><span class="line">#-t tty linux çµ‚ç«¯è¡“èª</span><br><span class="line">docker run -i -t ubuntu /bin/bash</span><br><span class="line">docker run -it ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line">#é è¨­å°±æ˜¯é€²å…¥åˆ° /bin/bash è£¡é¢</span><br><span class="line">docker run ubuntu</span><br><span class="line"></span><br><span class="line">#ç›´æ¥è·‘ bash</span><br><span class="line">docker exec -it 3afs3 /bin/bash</span><br></pre></td></tr></table></figure>

<p>é™¤äº†äº¤äº’å¼ä»¥å¤– , ä¹Ÿå¯ä»¥è·‘æˆå¾Œå°æœå‹™ (daemon , å¤§é™¸å«åšå®ˆè­·é€²ç¨‹)</p>
<p>-d detachs<br>-p publish <host>:<container></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --help</span><br><span class="line">docker pull nginx</span><br><span class="line">docker run --name my-nginx -d -p 8787:80 nginx</span><br></pre></td></tr></table></figure>

<p>åŸ·è¡Œ chrome <a target="_blank" rel="noopener" href="http://localhost:8787/">http://localhost:8787/</a> æ‡‰è©²å¯ä»¥çœ‹åˆ° nginx<br>è£œå……å¯ä»¥ç”¨ inspect æª¢æŸ¥ image or container ç­‰ç­‰ç‹€æ…‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker container inspect d312</span><br><span class="line"></span><br><span class="line">#ç”¨ powershell åˆ—å‡ºæ©«å¼çš„è¨Šæ¯</span><br><span class="line">(docker container inspect d312 | ConvertFrom-Json)</span><br><span class="line"></span><br><span class="line">#æ’ˆ ip</span><br><span class="line">$ip = (docker container inspect d312 | ConvertFrom-Json).NetworkSettings.Networks.bridge.IPAddress</span><br><span class="line"></span><br><span class="line">#åŸ·è¡Œ chrome , ä¸éé€™å€‹ example ä¸èƒ½é€™æ¨£ run</span><br><span class="line">#start http://$ip</span><br><span class="line"></span><br><span class="line">#å…¶ä»–é€£ç·šæ–¹æ³•ä»¥æˆ‘é€™å°ç‚ºä¾‹</span><br><span class="line">#http://host.docker.internal:8787/</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ“ä½œ for image &amp; container</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#åœæ­¢ container</span><br><span class="line">docker stop my-nginx</span><br><span class="line"></span><br><span class="line">#é–‹å•Ÿ my-nginx æœå‹™</span><br><span class="line">docker start my-nginx</span><br><span class="line"></span><br><span class="line">#å› ç‚ºè¢«åœæ­¢äº†æ‰€ä»¥ç”¨ -a åˆ—å‡ºåŒ…å«åœæ­¢çš„ container</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">#çœ‹çœ‹æœ€å¾ŒåŸ·è¡Œçš„ container æ˜¯ä»€éº¼</span><br><span class="line">docker ps -l</span><br><span class="line"></span><br><span class="line">#-q æ˜¯åªåˆ—å‡º id</span><br><span class="line">docker ps -lq</span><br><span class="line"></span><br><span class="line">#åˆªé™¤ container</span><br><span class="line">docker container rm d312bcc86783</span><br><span class="line"></span><br><span class="line">#ä¹Ÿå¯ä»¥æ­é…å‰›å‰›çš„å‘½ä»¤ä½¿ç”¨</span><br><span class="line">docker container rm $(docker ps -lq)</span><br><span class="line"></span><br><span class="line">#é€™æ¨£å¯ä»¥å¿«é€Ÿåˆªé™¤å…¨éƒ¨å°±åƒ sql èªæ³•çš„ in ä¸€æ¨£</span><br><span class="line">#select * from container where id in (a345a,b2hfg,c25s,dw3,e23)</span><br><span class="line">docker container rm $(docker ps ls -aq)</span><br></pre></td></tr></table></figure>

<h3 id="Lab-Docker-åŒ…è£ä¸€å€‹-vim-çš„-image"><a href="#Lab-Docker-åŒ…è£ä¸€å€‹-vim-çš„-image" class="headerlink" title="Lab Docker åŒ…è£ä¸€å€‹ vim çš„ image"></a>Lab Docker åŒ…è£ä¸€å€‹ vim çš„ image</h3><p>å¸¸å¸¸åŒ…ä¾†ç”¨çš„å…©å€‹è¶…è¿·ä½ çš„ linux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox</span><br><span class="line">docker pull alpine</span><br></pre></td></tr></table></figure>

<p>åŒ…è£ä¸€å€‹æ–°çš„ image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it alpine</span><br><span class="line">apk add bash</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„é€™å€‹ä¸€ run exit ä¸‹è¼‰å°±ç™½è²»äº† , æ‰€ä»¥æˆ‘å€‘éœ€è¦é–‹å¦å¤–ä¸€å€‹ powershell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#çœ‹çœ‹ç›®å‰é€™å€‹åœ¨ run çš„ container</span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line">#è‡ªå·±åŒ…è£æˆæœ‰ bash ç‰ˆæœ¬çš„</span><br><span class="line">docker commit -m=&quot;add bash&quot; -a=&quot;gg&quot; 0c4a5f78e8ab alpine-bash</span><br></pre></td></tr></table></figure>

<p>é€™ä¸‹å­å°±æœ‰ bash å¯ä»¥ç”¨äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it alpine-bash /bin/bash</span><br><span class="line"></span><br><span class="line">#åœ¨å¤šåŒ…ä¸€å€‹ vim</span><br><span class="line">apk add vim</span><br></pre></td></tr></table></figure>

<p>ä¸€æ¨£é–‹å•Ÿå¦å¤–ä¸€å€‹ powershell ä¸¦ä¸” commit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker commit -m=&quot;add vim&quot; -a=&quot;gg&quot; 5cb alpine-bash-vim</span><br><span class="line">docker container run -it alpine-bash-vim /bin/bash</span><br></pre></td></tr></table></figure>

<p>å¾ host è¤‡è£½ vimrc æª”æ¡ˆåˆ° container , 404b2c &#x3D;&gt; container çš„ id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker cp &quot;C:\Program Files\Git\etc\vimrc&quot; 404b2c:/root/vimrc</span><br><span class="line">apk add curl</span><br><span class="line">apk add git</span><br><span class="line">curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span><br><span class="line">vim</span><br><span class="line">:PlugInstall</span><br><span class="line">#æ‰¾åˆ° colorscheme ayu ä¸¦ä¸”è¨»è§£æ‰æœ€å¾Œå°±å¯ä»¥ commit äº†</span><br></pre></td></tr></table></figure>

<p>è£œå…… , å¾ container è¤‡è£½æª”æ¡ˆåˆ° host</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 404b2c:/root/.vimrc $&#123;PWD&#125;/vimrcnew</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ä¸€å€‹ powershell é€²è¡Œ commit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker commit -m=&quot;add vim&quot; -a=&quot;gg&quot; 5cb alpine-bash-vim-myconfig</span><br><span class="line">docker images</span><br><span class="line">#æœ€å¾Œå¾ˆæ¸…æ¥šå¯ä»¥çœ‹åˆ° docker æ˜¯ä¸€å±¤ä¸€å±¤ç–Šä¸Šä¾†çš„ , æ‰€ä»¥æœ€å¾Œä¸€å€‹ image è£äº†ä¸€å †æ±è¥¿å¤§å°æ˜é¡¯è®Šå¤§å¾ˆå¤š</span><br><span class="line">#REPOSITORY                         TAG        IMAGE ID       CREATED             SIZE</span><br><span class="line">#alpine-bash-vim-myconfig           latest     cf92a859ff98   3 seconds ago       51MB</span><br><span class="line">#alpine-bash-vim                    latest     dc17cb68096a   About an hour ago   25.7MB</span><br><span class="line">#alpine-bash                        latest     0f542f76e815   About an hour ago   9.74MB</span><br></pre></td></tr></table></figure>

<h3 id="Lab-ç”¨-busybox-å®‰è£-vim-ä¸¦ä¸”åŒ…è£æˆæ–°çš„-image"><a href="#Lab-ç”¨-busybox-å®‰è£-vim-ä¸¦ä¸”åŒ…è£æˆæ–°çš„-image" class="headerlink" title="Lab ç”¨ busybox å®‰è£ vim , ä¸¦ä¸”åŒ…è£æˆæ–°çš„ image"></a>Lab ç”¨ busybox å®‰è£ vim , ä¸¦ä¸”åŒ…è£æˆæ–°çš„ image</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it progrium/busybox</span><br></pre></td></tr></table></figure>

<p>åœ¨ busybox å…§åŸ·è¡Œå®‰è£ vim ä¸¦ä¸”é€€å‡º container</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># busybox è£¡é¢å®‰è£ vim</span><br><span class="line">opkg-install vim</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦å†æ¬¡å•Ÿå‹•é€™å€‹ container çš„è©±å¯ä»¥è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ , æ³¨æ„ busybox è·Ÿ alpine é è¨­éƒ½æ˜¯ sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start 6f9bf9785ce5 /bin/sh</span><br></pre></td></tr></table></figure>

<p>é›–ç„¶å·²ç¶“é›¢é–‹äº† container , ä½†é‚„æ˜¯å¯ä»¥ commit ç‚ºæ–°çš„ image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -a=&quot;gg&quot; -m=&quot;add vim&quot; 6f9bf9785ce5 busybox-vim</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è‹¥ç¾åœ¨æŠŠä¹‹å‰çš„ container <code>6f9bf9785ce5</code> è·‘èµ·ä¾†çš„è©± vim é‚„æ˜¯æœƒå­˜åœ¨çš„ , ä½†å¦‚æœæ–°è·‘ä¸€å€‹ image å‰‡ vim ä¸æœƒåœ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 6f9bf9785ce5</span><br><span class="line"></span><br><span class="line">#åŸ·è¡Œ vim æ˜¯å¯ä»¥æˆåŠŸçš„</span><br><span class="line">vim</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ–¹æ³•å‰‡æ˜¯å¾æ–°å•Ÿå‹•ä¸€å€‹ container , æ‰€ä»¥è£¡é¢ä¸æœƒæœ‰ vim , container çš„ id æ˜¯ä¸ä¸€æ¨£çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it progrium/busybox</span><br><span class="line">docker container ls -a</span><br><span class="line">#CONTAINER ID   IMAGE            COMMAND   CREATED              STATUS                         </span><br><span class="line">#c77c1d77e23b   progrium/busybox &quot;/bin/sh&quot; About a minute ago   Exited (127) About a minute ago</span><br><span class="line">#6f9bf9785ce5   progrium/busybox &quot;/bin/sh&quot; 29 minutes ago       Exited (137) 6 minutes ago  </span><br></pre></td></tr></table></figure>


<h3 id="ç¶²è·¯åŸºæœ¬å‘½ä»¤"><a href="#ç¶²è·¯åŸºæœ¬å‘½ä»¤" class="headerlink" title="ç¶²è·¯åŸºæœ¬å‘½ä»¤"></a>ç¶²è·¯åŸºæœ¬å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line">#å»ºç«‹ç¶²è·¯</span><br><span class="line">docker network create test</span><br><span class="line"></span><br><span class="line">#åˆªé™¤ç¶²è·¯</span><br><span class="line">docker network rm 789</span><br></pre></td></tr></table></figure>

<p>åœ¨ container å…§äº’ç›¸é€£ç·š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker pull tutum/wordpress</span><br><span class="line">docker run -d -p 10001:80 --name blog1 tutum/wordpress</span><br><span class="line"></span><br><span class="line">#å°‡ container blog1 é€£ç·šåˆ° my_network çš„ç¶²è·¯å…§</span><br><span class="line">docker network connect my_network blog1</span><br><span class="line"></span><br><span class="line">#ç”¨ --network æŒ‡å®šç¶²è·¯ , æ‰€ä»¥æ­¤æ™‚é€™å…©å€‹ container å°±å¯ä»¥äº’é€šäº†</span><br><span class="line">docker run -it --network my_network ubuntu:16.04 bash</span><br></pre></td></tr></table></figure>

<p>æ­¤æ™‚åœ¨ ubuntu çš„ container å…§å®‰è£ curl ä¸¦ä¸”åŸ·è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install -y curl</span><br><span class="line">curl -sSL blog1 | head -n5</span><br></pre></td></tr></table></figure>

<h3 id="docker-é€²éšç¶²è·¯-debug"><a href="#docker-é€²éšç¶²è·¯-debug" class="headerlink" title="docker é€²éšç¶²è·¯ debug"></a>docker é€²éšç¶²è·¯ debug</h3><p>åœ¨ docker è£¡é¢æ‹”äº†ä¸€å †æ±è¥¿ , æ‰€ä»¥æƒ³çœ‹ç¶²è·¯çš„è©±ç›´æ¥å°± gg , æ‰€ä»¥æ‡‰è©²åŒ…ä¸€å€‹é€™ç¨®ç¶²è·¯é™¤éŒ¯å·¥å…·ä¾†ç”¨<br>é€šå¸¸è³‡æ·±ä¸€é»çš„äººéƒ½ç¿’æ…£ç”¨ ifconfig é€™é¡ net-tools å‘½ä»¤ä¾†çœ‹ , æ‰€ä»¥æœ€å¥½æ–°èˆŠ tool éƒ½åŒ…ä¸€åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line"></span><br><span class="line">#èˆŠç‰ˆæ¨™é…</span><br><span class="line">sudo apt-get install -y net-tools</span><br><span class="line"></span><br><span class="line">#æ–°ç‰ˆæ¨™é…</span><br><span class="line">sudo apt-get install -y iproute2</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨ debug ç¶²è·¯é€šä¸é€šçš„ command</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#ä¸€ç›´ ping</span><br><span class="line">ping 8.8.8.8</span><br><span class="line"></span><br><span class="line">#ping ä¸€æ¬¡</span><br><span class="line">ping 8.8.8.8 -c1</span><br><span class="line"></span><br><span class="line">traceroute 8.8.8.8</span><br><span class="line">mtr 8.8.8.8</span><br></pre></td></tr></table></figure>

<p>docker å¯¦éš›ä¸Šæ˜¯é€é linux bridge éš”é›¢ network namespace , é è¨­æœƒé€ä½ ä¸€å¼µ docker0 , å¦‚æœæœ‰å»ºç«‹ container å°±æœƒè‡ªå‹•ç™¼é… veth çµ¦ä½ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:15:5d:36:b4:38 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.137.156/24 brd 192.168.137.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 604759sec preferred_lft 604759sec</span><br><span class="line">    inet6 fe80::215:5dff:fe36:b438/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:9f:6f:7d:c8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:9fff:fe6f:7dc8/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: veth1f0e6cb@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether f2:2c:a5:77:11:12 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::f02c:a5ff:fe77:1112/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: veth9a6ae72@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether b6:99:a6:c7:dc:cb brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::b499:a6ff:fec7:dccb/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">21: vetha156707@if20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether b6:79:46:57:e5:82 brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class="line">    inet6 fe80::b479:46ff:fe57:e582/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>åªçœ‹ veth ä¸æ˜¯å¾ˆå¥½çœ‹ , æ‰€ä»¥å¯ä»¥ç”¨ä¸‹é¢é€™ç¨®æ–¹æ³•ä¾†çœ‹äº› details<br>æ’ˆ container çš„ pid , æ¥è‘—ç”¨ nsenter è·³é€²å» , æ³¨æ„é€™é‚ŠæŒ‡å®š -n åƒæ•¸çš„è©±æ‰å¯ä»¥ç›´æ¥é€²å» network namespace (netns)<br>ç™¼ç¾å¾ˆå¥½ç”¨ , è·³åˆ° netns å…§å¯ä»¥ç”¨ host çš„å·¥å…·é€²è¡Œ debug , å¦‚æœç›´æ¥é€²å» docker è£¡é¢æ˜¯æ²’æœ‰ ip å·¥å…·å¯ä»¥ä½¿ç”¨çš„<br>æœ€å¾Œå¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="https://www.cpweb.top/343">å¼·åœ‹äººé€™ç¯‡</a>å¯«å¾—æ»¿è©³ç´°çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 00f | grep Pid</span><br><span class="line">#ä¸åˆ†å¤§å°å¯«</span><br><span class="line">docker inspect 00f | grep -i pid</span><br><span class="line"></span><br><span class="line">#è·³åˆ° network namespace</span><br><span class="line">sudo nsenter -n -t 152912 /bin/bash</span><br><span class="line">ip a</span><br><span class="line">#1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">#    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">#    inet 127.0.0.1/8 scope host lo</span><br><span class="line">#       valid_lft forever preferred_lft forever</span><br><span class="line">#6: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">#    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">#    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">#       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#çœ‹çœ‹è·Ÿç›´æ¥è·³ docker è£¡é¢æœ‰å•¥å·®ç•° (nginx container)</span><br><span class="line">docker container exec -it e0c /bin/bash</span><br><span class="line">root@e0c0c8d096ca:/# ip a</span><br><span class="line">bash: ip: command not found</span><br><span class="line"></span><br><span class="line">#docker æœ‰æŠŠ netns å·å·æ¬åˆ° docker è³‡æ–™å¤¾åº•ä¸‹ , å¤šéš”ä¸€å±¤</span><br><span class="line">#é è¨­å‰‡æ˜¯åœ¨ /var/run/netns/</span><br><span class="line">sudo ls /var/run/docker/netns</span><br></pre></td></tr></table></figure>


<p>ç‚ºä½• container å¯ä»¥é€£ç·šå¤–ç¶² , å¯ä»¥ç”¨ iptables æŸ¥çœ‹çœ‹ docker å·å·åšçš„äº‹ , æœ‰å…©ç¨®çœ‹æ³•<br>æ–¹æ³•ä¸€ <code>iptables-save</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables-save</span><br><span class="line"></span><br><span class="line"># Generated by iptables-save v1.8.4 on Wed Aug 11 04:23:28 2021</span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [8720:602415]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [8382:1516434]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"># Completed on Wed Aug 11 04:23:28 2021</span><br><span class="line"># Generated by iptables-save v1.8.4 on Wed Aug 11 04:23:28 2021</span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [454:89225]</span><br><span class="line">:INPUT ACCEPT [22:4283]</span><br><span class="line">:OUTPUT ACCEPT [1697:136012]</span><br><span class="line">:POSTROUTING ACCEPT [1703:136290]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"># Completed on Wed Aug 11 04:23:28 2021</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒ <code>iptables</code> å¯ä»¥æ­é…åƒæ•¸çœ‹åˆ°è¡Œè™Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables --list --line-number</span><br><span class="line"></span><br><span class="line">#Chain INPUT (policy ACCEPT)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#</span><br><span class="line">#Chain FORWARD (policy DROP)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#1    DOCKER-USER  all  --  anywhere             anywhere</span><br><span class="line">#2    DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere</span><br><span class="line">#3    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">#4    DOCKER     all  --  anywhere             anywhere</span><br><span class="line">#5    ACCEPT     all  --  anywhere             anywhere</span><br><span class="line">#6    ACCEPT     all  --  anywhere             anywhere</span><br><span class="line">#</span><br><span class="line">#Chain OUTPUT (policy ACCEPT)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#</span><br><span class="line">#Chain DOCKER (1 references)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#</span><br><span class="line">#Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#1    DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere</span><br><span class="line">#2    RETURN     all  --  anywhere             anywhere</span><br><span class="line">#</span><br><span class="line">#Chain DOCKER-ISOLATION-STAGE-2 (1 references)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#1    DROP       all  --  anywhere             anywhere</span><br><span class="line">#2    RETURN     all  --  anywhere             anywhere</span><br><span class="line">#</span><br><span class="line">#Chain DOCKER-USER (1 references)</span><br><span class="line">#num  target     prot opt source               destination</span><br><span class="line">#1    RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure>

<p>åˆªé™¤çš„è©±ç”¨éœ€è¦åŠ  Chain è·Ÿ è¡Œè™Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables --delete FORWARD 1</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œé‚„æœ‰ç¨® debug æœ‰è¶£ç”¨æ³• , å› ç‚º docker æœ‰å€‹ container æ¨¡å¼ , k8s å°±æ˜¯ç”¨é€™ç¨®æ¨¡å¼<br>é€™é‚Šç”¨ nginx + dotnet core ä¾†ç©çœ‹çœ‹ , å› ç‚º dotnet core çš„ image å…§å»º curl æ‰€ä»¥å¯ä»¥ç”¨ä¾†æ‰“ nginx ç¶²é çœ‹çœ‹<br>æé†’å¦‚æœä½  port ç›¸è¡çªåˆ°çš„è©± container ä¸€åŸ·è¡Œ run å°±ç›´æ¥è·³èµ°äº† , ä¾‹å¦‚åŒæ™‚èµ·å…©å€‹ nginx æœƒæ¶ 80 , æ‰€ä»¥æœƒéƒ½èµ·ä¸ä¾†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run nginx</span><br><span class="line">docker run  -it --net=container:757f5a389a6b  mcr.microsoft.com/dotnet/sdk</span><br><span class="line">docker inspect 757f5a389a6b | grep IPA</span><br><span class="line"></span><br><span class="line">#&quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">#&quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">#        &quot;IPAMConfig&quot;: null,</span><br><span class="line">#        &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line"></span><br><span class="line">docker exec -it awr3 /bin/bash</span><br></pre></td></tr></table></figure>

<p>å…ˆè·³åˆ° nginx çš„ netns çœ‹çœ‹ , æ³¨æ„é€™é‚Šå¯ä»¥ç”¨ ip a æ˜¯å› ç‚ºåœ¨ host run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 757f5a389a6b | grep -i pid</span><br><span class="line">sudo   nsenter -t 25311 -n</span><br><span class="line">ip a</span><br><span class="line">#1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">#    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">#    inet 127.0.0.1/8 scope host lo</span><br><span class="line">#       valid_lft forever preferred_lft forever</span><br><span class="line">#16: eth0@if17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">#    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">#    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">#       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>æ¥è‘—è·³åˆ° dotnet core çš„ netns å…§çœ‹çœ‹ , ç™¼ç¾ ip æœç„¶èˆ‡ dotnet core çš„å¦‚å‡ºä¸€å¾¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker inspect awr3 | grep -i pid</span><br><span class="line">sudo   nsenter -t 35348 -n</span><br><span class="line">ip a</span><br><span class="line">#16: eth0@if17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">#    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">#    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">#       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h3 id="é€é-tcp-é€£ç·šé ç«¯-docker"><a href="#é€é-tcp-é€£ç·šé ç«¯-docker" class="headerlink" title="é€é tcp é€£ç·šé ç«¯ docker"></a>é€é tcp é€£ç·šé ç«¯ docker</h3><p>è«åå…¶å¦™çš„é ç«¯ docker tcp ä¸èƒ½é€£ç·š , <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/26561963/how-to-detect-a-docker-daemon-port">åƒè€ƒå¼·è€…è€å¤–</a><br>ä¸Šèª²çœ‹åˆ°å¯ä»¥ç›´æ¥ç”¨ ip åŠ ä¸ŠæŒ‡ä»¤çš„æ–¹å¼ç›´æ¥ç®¡ç†é ç«¯ docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H 10.1.25.123 images</span><br></pre></td></tr></table></figure>

<p>æäº†ä¸€å †æ–¹æ³•éƒ½å¤±æ•— , å¾Œä¾† try é€™å€‹è€å¤–è¬›çš„æ‰æˆåŠŸ</p>
<p>Prepare extra configuration file. Create a file named &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d&#x2F;docker.conf. Inside the file docker.conf, paste below content:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br></pre></td></tr></table></figure>
<p>Note that if there is no directory like docker.service.d or a file named docker.conf then you should create it.</p>
<p>Restart Docker. After saving this file, reload the configuration by systemctl daemon-reload and restart Docker by systemctl restart docker.service.</p>
<p>Check your Docker daemon. After restarting docker service, you can see the port in the output of systemctl status docker.service like &#x2F;usr&#x2F;bin&#x2F;dockerd -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock.</p>
<p>ä»¥ä¸‹ç‚ºæˆ‘çš„å¯¦ä½œç­†è¨˜éç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/systemd/system</span><br><span class="line">mkdir docker.service.d</span><br><span class="line">cd docker.service.d</span><br><span class="line">sudo vim docker.conf</span><br><span class="line"></span><br><span class="line">#åŠ å…¥é€™å€‹ç‰‡æ®µ</span><br><span class="line">#[Service]</span><br><span class="line">#ExecStart=</span><br><span class="line">#ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br><span class="line"></span><br><span class="line">#é‡æ–°æ›´æ–° daemon è¨­å®š</span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">#é‡é–‹ docker</span><br><span class="line">systemctl restart docker.service</span><br><span class="line"></span><br><span class="line">#å°å‡ºç‹€æ…‹</span><br><span class="line">systemctl status docker.service</span><br><span class="line"></span><br><span class="line">#â— docker.service - Docker Application Container Engine</span><br><span class="line">#     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">#    Drop-In: /etc/systemd/system/docker.service.d</span><br><span class="line">#             â””â”€docker.conf</span><br><span class="line">#     Active: active (running) since Thu 2021-07-15 12:49:20 CST; 8min ago</span><br><span class="line">#TriggeredBy: â— docker.socket</span><br><span class="line">#       Docs: https://docs.docker.com</span><br><span class="line">#   Main PID: 829386 (dockerd)</span><br><span class="line">#      Tasks: 39</span><br><span class="line">#     Memory: 75.5M</span><br><span class="line">#     CGroup: /system.slice/docker.service</span><br><span class="line">#             â”œâ”€829386 /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br><span class="line">#             â””â”€829752 /usr/bin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 1514 -container-ip 172.21.0.6 -container-port 10514</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ä¸€æ¨£å°å‡ºç‹€æ…‹</span><br><span class="line">ps auxw | grep dockerd</span><br><span class="line">#root      829386  3.2  2.8 2422328 114552 ?      Ssl  12:48   0:19 /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–éŒ¯èª¤"><a href="#å…¶ä»–éŒ¯èª¤" class="headerlink" title="å…¶ä»–éŒ¯èª¤"></a>å…¶ä»–éŒ¯èª¤</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39130263/docker-proxy-using-port-when-no-containers-are-running">ä»Šå¤©å™´å€‹å¥‡æ€ªéŒ¯èª¤</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint upbeat_cartwright (7b56e9f46ca459fcfd5e28b3fb4740dee0d7a0efc5dfc217b9f6a883db678b13): Bind for 0.0.0.0:80 failed: port is already allocated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo lsof -i -P -n</span><br><span class="line">sudo service docker stop</span><br><span class="line">sudo rm -f /var/lib/docker/network/files/local-kv.db</span><br><span class="line"></span><br><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/%E7%A7%81%E6%9C%89-Nuget-Server-%E6%9E%B6%E8%A8%AD-BaGet/" rel="prev" title="ç§æœ‰ Nuget Server æ¶è¨­ BaGet">
      <i class="fa fa-chevron-left"></i> ç§æœ‰ Nuget Server æ¶è¨­ BaGet
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/docker-%E5%BB%BA%E7%AB%8B%E7%A7%81%E6%9C%89%E7%9A%84-registry/" rel="next" title="docker å»ºç«‹ç§æœ‰çš„ registry">
      docker å»ºç«‹ç§æœ‰çš„ registry <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®éŒ„
        </li>
        <li class="sidebar-nav-overview">
          æœ¬ç«™æ¦‚è¦
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#powershell-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><span class="nav-number">1.</span> <span class="nav-text">powershell äº‹å‰æº–å‚™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-windows-ssh-powershell-%E9%80%A3%E7%B7%9A"><span class="nav-number">2.</span> <span class="nav-text">è¨­å®š windows ssh powershell é€£ç·š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">docker åŸºæœ¬è§€å¿µåŠæ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lab-Docker-%E5%8C%85%E8%A3%9D%E4%B8%80%E5%80%8B-vim-%E7%9A%84-image"><span class="nav-number">4.</span> <span class="nav-text">Lab Docker åŒ…è£ä¸€å€‹ vim çš„ image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lab-%E7%94%A8-busybox-%E5%AE%89%E8%A3%9D-vim-%E4%B8%A6%E4%B8%94%E5%8C%85%E8%A3%9D%E6%88%90%E6%96%B0%E7%9A%84-image"><span class="nav-number">5.</span> <span class="nav-text">Lab ç”¨ busybox å®‰è£ vim , ä¸¦ä¸”åŒ…è£æˆæ–°çš„ image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B6%B2%E8%B7%AF%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="nav-number">6.</span> <span class="nav-text">ç¶²è·¯åŸºæœ¬å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E9%80%B2%E9%9A%8E%E7%B6%B2%E8%B7%AF-debug"><span class="nav-number">7.</span> <span class="nav-text">docker é€²éšç¶²è·¯ debug</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E9%81%8E-tcp-%E9%80%A3%E7%B7%9A%E9%81%A0%E7%AB%AF-docker"><span class="nav-number">8.</span> <span class="nav-text">é€é tcp é€£ç·šé ç«¯ docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E9%8C%AF%E8%AA%A4"><span class="nav-number">9.</span> <span class="nav-text">å…¶ä»–éŒ¯èª¤</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ğŸŒ¹ å–‡è³½äºº ğŸŒ¹</p>
  <div class="site-description" itemprop="description">ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">342</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ¨™ç±¤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/weber87na" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;weber87na" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

	  <!-- skilltree å»£å‘Š -->
	  <div id="myadblock" style="margin-top:25px;position:relative">
	  <div id="myadblock-title" style="position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  <script src="https://skilltree.my/promotion/cec9b4b0-be5e-4727-85c6-f7af5445124a?w=350"></script>
	  </div>

	  <!-- google å»£å‘Š -->
	  <!--
	  <ins class="adsbygoogle"
		  style="display:inline-block;width:220px;height:120px;margin-top:50px;position:relative;border-bottom-left-radius: 15px 255px;border-bottom-right-radius: 225px 15px;border-top-left-radius: 255px 15px;border-top-right-radius: 15px 225px;border: 2px solid #41403e;"
		  data-ad-client="ca-pub-1069539516107706"
		  data-ad-slot="6588270137">
	  <div id="myadblock-title2" style="z-index:999999;position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  </ins>
	  <script>
		  (adsbygoogle = window.adsbygoogle || []).push({});
	  </script>
	  -->

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å–‡è³½çš„äºº! G__G+</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç¸½å»¢è©±å­—æ•¸ï¼š</span>
    <span title="ç¸½å»¢è©±å­—æ•¸">1.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">æ‰€éœ€ç¸½æµªè²»æ™‚é–“ &asymp;</span>
    <span title="æ‰€éœ€ç¸½æµªè²»æ™‚é–“">26:01</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://la-sai-de-ren.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.blog.lasai.com.tw/posts/docker-%E5%9F%BA%E6%9C%AC%E8%A7%80%E5%BF%B5%E5%8F%8A%E6%93%8D%E4%BD%9C%E7%AD%86%E8%A8%98/";
    this.page.identifier = "posts/docker-åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜/";
    this.page.title = "docker åŸºæœ¬è§€å¿µåŠæ“ä½œç­†è¨˜";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://la-sai-de-ren.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <!-- <div class="snow1" style="position:fixed !important"></div> -->
  <div class="cobweb" style="position:fixed !important"></div>
  <div class="spider" style="position:fixed !important"></div>
<div class="fswitch">é—œé–‰</div>
<div class="snowflakes" aria-hidden="true">
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
</div>

<!--
<script>
	function toggleSpell() {
		let spell = document.getElementsByClassName('spell')[0];
		let ghost = document.getElementsByClassName('ghost')[0];
		let noise = document.getElementsByClassName('noise')[0];
		let noise2 = document.getElementsByClassName('noise2')[0];
		if (spell.style.display === 'none') {
			spell.style.display = 'block';
			noise.style.display = '';
			noise2.style.display = '';
			ghost.style.display = 'none';
		} else {
			spell.style.display = 'none';
			noise.style.display = 'none';
			noise2.style.display = 'none';
			ghost.style.display = 'block';
		}
	}

	//è¨‚é–±å…§å®¹
	let spell = document.getElementsByClassName('spell')[0];
	let ghost = document.getElementsByClassName('ghost')[0];
	spell.addEventListener('click',toggleSpell);
	ghost.addEventListener('click',toggleSpell);
</script>
-->

<script>

let cobweb = document.querySelector('.cobweb');
let spider = document.querySelector('.spider');
let back = document.querySelector('.back-to-top');
let fswitch = document.querySelector('.fswitch');

document.addEventListener('keydown', function(event) {
	if (event.key === 'f') {
		console.log('press f key');
		ftoggle();
	}
});

fswitch.addEventListener('click' , function(){ 
	ftoggle();
});

function ftoggle(){
	if(cobweb.style.display === ''){
		cobweb.style.display = 'none';
	}else{
		cobweb.style.display = '';
	}
	if(spider.style.display === ''){
		spider.style.display = 'none';
	}else{
		spider.style.display = '';
	}
	if(back.style.display === ''){
		back.style.display = 'none';
	}else{
		back.style.display = '';
	}

	if(fswitch.innerText === 'é—œé–‰') fswitch.innerText = 'ä¹–ä¹–'
	else fswitch.innerText = 'é—œé–‰'
}



</script>

<script>
class ViNavigation {
  constructor() {
    this.Mode = {
      Normal: "normal",
      Motion: "motion",
    };

    this.lastKeyPressTime = 0;
    this.lastKeyPressed = "";
    this.currentMode = this.Mode.Normal;

    //å¯ä½¿ç”¨ç§»å‹•çš„å­—ç¢¼
    //å…± 18 å€‹å­— æ’é™¤ vi æœƒç”¨åˆ°çš„å­—
    this.tagChars = "ABCEILNOPQRSTVWXYZ";

    //ç›®å‰çš„ vim æ¨™ç¤ºå­—æ¨™ç±¤ array
    this.holdTags = new Array();

    //é å…ˆå»ºç«‹å…©å­—çµ„åˆçš„å­—å…¸
    this.dict = new Array();
    //é›™å±¤è¿´åœˆçŒå…¥æ‰€æœ‰å…©å­—çµ„åˆ
    for (var i = 0; i < this.tagChars.length; i++) {
      for (var j = 0; j < this.tagChars.length; j++) {
        this.dict.push(this.tagChars[i] + this.tagChars[j]);
      }
    }
  }

  viGoTop(keyPressed) {
    if (keyPressed === "g") {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  viGoBottom(keyPressed) {
    if (keyPressed === "G") {
      console.log("document.body.scrollHeight", document.body.scrollHeight);
      let h = Math.max(
        Math.max(
          document.body.scrollHeight,
          document.documentElement.scrollHeight
        ),
        Math.max(
          document.body.offsetHeight,
          document.documentElement.offsetHeight
        ),
        Math.max(
          document.body.clientHeight,
          document.documentElement.clientHeight
        )
      );
      window.scrollTo({ top: h, behavior: "smooth" });
    }
  }

  viFastDown(keyPressed) {
    if (keyPressed === "d") {
      this.move(350);
    }
  }

  viDown(keyPressed) {
    if (keyPressed === "j") {
      this.move(100);
    }
  }

  viFastUp(keyPressed) {
    if (keyPressed === "u") {
      this.move(-350);
    }
  }

  viUp(keyPressed) {
    if (keyPressed === "k") {
      this.move(-100);
    }
  }

  move(val) {
    var currentPosition =
      window.pageYOffset || document.documentElement.scrollTop;
    window.scrollTo({
      top: currentPosition + val,
      behavior: "smooth",
    });
  }

  removeViTags() {
    let allTags = document.querySelectorAll(".vim-tag");
    allTags.forEach(function (tag) {
      tag.parentNode.removeChild(tag);
    });
  }

  createViTag(text, href, top, left) {
    let newDiv = document.createElement("div");
    newDiv.classList.add("vim-tag");
    newDiv.style.fontFamily = "Arial, sans-serif";
    newDiv.style.fontSize = "12px";
    newDiv.style.position = "absolute";
    newDiv.style.backgroundColor = "#89CF07";
    newDiv.style.color = "black";
    newDiv.style.padding = "2px";
    newDiv.style.borderRadius = "2px";
    newDiv.style.zIndex = "999999";

    newDiv.textContent = text;
    newDiv.dataset.href = href;
    newDiv.style.top = top;
    newDiv.style.left = left;
    return newDiv;
  }

  createViTags() {
    let allTags = document.querySelectorAll("a");
    let counter = 0;
    for (let tag of allTags) {
      let rect = tag.getBoundingClientRect();
      let href = tag.href;
      //é€™å€‹è·é›¢éœ€è¦åŠ å…¥å·è»¸è·é›¢æ‰æœƒæ­£ç¢º
      let top = window.scrollY + rect.top + "px";
      let left = window.scrollX + rect.left + "px";
      let text = "";
      if (allTags.length <= this.tagChars.length) {
        text = this.tagChars[counter];
        this.holdTags.push(text);
      } else {
        text = this.dict[counter];
        this.holdTags.push(text);
      }
      let newDiv = this.createViTag(text, href, top, left);
      document.body.appendChild(newDiv);
      counter++;
    }
  }

  //æ‰¾å‡ºç›®å‰çš„é¦–å­— array
  firstCharArray() {
    let result = [];
    for (let i = 0; i < this.holdTags.length; i++) {
      let text = this.holdTags[i];
      if (text) {
        let theChar = text[0].toLowerCase();
        if (result.includes(theChar) === false) {
          result.push(theChar);
        }
      }
    }

    return result;
  }

  toggleMotion() {
    this.currentMode = this.Mode.Motion;
    this.lastKeyPressed = "";
    console.log("mode", this.currentMode);
    this.createViTags();
  }

  toggleNormal() {
    this.currentMode = this.Mode.Normal;
    console.log("mode", this.currentMode);
    this.removeViTags();
    this.holdTags = [];
    this.lastKeyPressed = "";
  }

  handleKeyDown(event) {
    let currentTime = new Date().getTime();
    let keyPressed = event.key;

    //æŒ‰ä¸‹ F æ™‚é€²å…¥ motion æ¨¡å¼
    if (this.currentMode === this.Mode.Normal && keyPressed === "F") {
      this.toggleMotion();
      return;
    }

    //æŒ‰ä¸‹ esc è·³é›¢ motion æ¨¡å¼å›åˆ° normal æ¨¡å¼
    if (this.currentMode === this.Mode.Motion && keyPressed === "Escape") {
      this.toggleNormal();
      return;
    }

    //ç•¶ motion ä¸€å€‹å­—æ™‚æ‰èµ°é€™æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length <= this.tagChars.length &&
      this.tagChars.toLowerCase().includes(keyPressed)
    ) {
      console.log("one char mode");
      let allTags = document.querySelectorAll(".vim-tag");

      allTags.forEach(function (tag) {
        if (tag.textContent.toLowerCase() === keyPressed) {
          window.location.href = tag.dataset.href;
        }
      });

      this.toggleNormal();
      return;
    }

    //ç•¶ motion å…©å€‹å­—æ‰èµ°é€™å€‹æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length > this.tagChars.length
    ) {
      console.log("motion lastKeyPressed", this.lastKeyPressed);
      console.log("motion current", keyPressed);

      if (!this.lastKeyPressed) {
        //å¦‚æœå‡ºç¾å­—è¡¨ä»¥å¤–çš„å­—å‰‡å›åˆ° normal
        //console.log("firstCharArray", this.firstCharArray());
        if (this.firstCharArray().includes(keyPressed) === false) {
          this.toggleNormal();
          return;
        } else {
          let allTags = document.querySelectorAll(".vim-tag");
          allTags.forEach(function (tag) {
            if (tag.textContent[0].toLowerCase() !== keyPressed) {
              tag.parentNode.removeChild(tag);
            }

            //å°‡ç¬¬ä¸€å€‹å­—è®Šç‚ºç´…è‰²
            if (tag.textContent[0].toLowerCase() === keyPressed) {
              tag.innerHTML =
                '<span style="color: red;">' +
                tag.textContent.charAt(0) +
                "</span>" +
                tag.textContent.substring(1);
            }
          });
        }
      }

      //å¦‚æœæœ‰å­—çš„è©±æ‰åŸ·è¡Œ
      if (this.lastKeyPressed) {
        let chars = this.lastKeyPressed + keyPressed;
        console.log("chars", chars);
        let allTags = document.querySelectorAll(".vim-tag");
        allTags.forEach(function (tag) {
          if (tag.textContent.toLowerCase() === chars) {
            window.location.href = tag.dataset.href;
          }
        });
        //è¬ä¸€æ²’æ‰¾åˆ°åˆ‡å› Normal
        this.toggleNormal();
        return;
      }
    }

    // ä»»ä½•æ¨¡å¼æŒ‰å…©ä¸‹çš„å€åŸŸ
    if (
      keyPressed === this.lastKeyPressed &&
      currentTime - this.lastKeyPressTime < 300
    ) {
      this.viGoTop(keyPressed);
    }

    // æŒ‰ä¸€ä¸‹çš„å€åŸŸ
    this.viGoBottom(keyPressed);
    this.viDown(keyPressed);
    this.viFastDown(keyPressed);
    this.viUp(keyPressed);
    this.viFastUp(keyPressed);

    this.lastKeyPressTime = currentTime;
    this.lastKeyPressed = keyPressed;
  }

  init() {
    document.addEventListener("keydown", this.handleKeyDown.bind(this));
  }
}

const viNavigation = new ViNavigation();
viNavigation.init();
</script>



</body>
</html>
