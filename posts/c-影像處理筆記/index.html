<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/gg.png">
  <link rel="mask-icon" href="/images/gg.png" color="#222">
  <meta name="google-site-verification" content="J5sjnNRD2AYPWVE08_-8XO_8mBKRYD3NKVYRBCGMwQ8">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">



<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S5ZWC157GD');
</script>

<style>
    @font-face {
        /* font-family: "JasonHandwriting1-Regular"; */
/*
        src: url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff2) format("woff2"), url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff) format("woff");
		*/

        font-family: "ä¿æ–¹é«”11è™Ÿ";
        src: url(/fonts/Cubic_11_1.000_R.woff) format("woff")
    }
</style>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.blog.lasai.com.tw","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="See the Pen    LaSai Image Processing by å–‡è³½äºº (@weber87na)   on CodePen.">
<meta property="og:type" content="article">
<meta property="og:title" content="c# å½±åƒè™•ç†ç­†è¨˜">
<meta property="og:url" content="https://www.blog.lasai.com.tw/posts/c-%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86%E7%AD%86%E8%A8%98/index.html">
<meta property="og:site_name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
<meta property="og:description" content="See the Pen    LaSai Image Processing by å–‡è³½äºº (@weber87na)   on CodePen.">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2024-11-01T04:10:34.000Z">
<meta property="article:modified_time" content="2025-03-07T20:17:32.309Z">
<meta property="article:author" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
<meta property="article:tag" content="c#">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.blog.lasai.com.tw/posts/c-%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86%E7%AD%86%E8%A8%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>c# å½±åƒè™•ç†ç­†è¨˜ | ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S5ZWC157GD');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!-- google ad -->
  <!--
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1069539516107706"
     crossorigin="anonymous"></script>
  -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!--
  <div class="spell" ></div>
  <div class="ghost" style="display: none;"></div>
  <div class="noise"></div>
  <div class="noise2"></div>
  -->


  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ğŸŒ¹ å–‡ä½å–‡è³½ ğŸŒ¹</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>çœŸå–‡è³½</a>

  </li>
        <li class="menu-item menu-item-map">

    <a href="/map/" rel="section"><i class="fa fa-map fa-fw"></i>å–‡è³½äººçš„å¥‡æ€ªç¾é£Ÿåœ°åœ–</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>é—œæ–¼å–‡è³½äºº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>å–‡è³½çš„æ¨™ç±¤</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å–‡è³½äº‚å¯«</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœå°‹
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœå°‹..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://www.blog.lasai.com.tw/posts/c-%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86%E7%AD%86%E8%A8%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
      <meta itemprop="description" content="ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          c# å½±åƒè™•ç†ç­†è¨˜
        </h1>

        <div class="post-meta">
		
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">äº‚å¯«æ–¼</span>

              <time title="äº‚å…¥æ™‚é–“ï¼š2024-11-01 12:10:34" itemprop="dateCreated datePublished" datetime="2024-11-01T12:10:34+08:00">2024-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°æ–¼</span>
                <time title="ä¿®æ”¹æ™‚é–“ï¼š2025-03-08 04:17:32" itemprop="dateModified" datetime="2025-03-08T04:17:32+08:00">2025-03-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/posts/c-%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86%E7%AD%86%E8%A8%98/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/c-å½±åƒè™•ç†ç­†è¨˜/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="å»¢è©±å­—æ•¸">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">å»¢è©±å­—æ•¸ï¼š</span>
              <span>37k</span>
            </span>
            <span class="post-meta-item" title="æ‰€éœ€å‚·çœ¼æ™‚é–“">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">æ‰€éœ€å‚·çœ¼æ™‚é–“ &asymp;</span>
              <span>34 åˆ†é˜</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="OJKqXXL" data-pen-title="LaSai Image Processing" data-user="weber87na" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a target="_blank" rel="noopener" href="https://codepen.io/weber87na/pen/OJKqXXL">
  LaSai Image Processing</a> by å–‡è³½äºº (<a target="_blank" rel="noopener" href="https://codepen.io/weber87na">@weber87na</a>)
  on <a target="_blank" rel="noopener" href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://public.codepenassets.com/embed/index.js"></script>


<span id="more"></span>

<p>æœ€è¿‘ç·´ç¿’ c èªè¨€, å‰›å¥½æ‹¿å€‹å½±åƒè™•ç†çš„ code è½‰ç‚º c# ç©çœ‹çœ‹, é †æ‰‹ç­†è¨˜ä¸‹</p>
<h2 id="ç°éš"><a href="#ç°éš" class="headerlink" title="ç°éš"></a>ç°éš</h2><p>ä»–åŸå§‹ c çš„ code å¦‚ä¸‹</p>
<p>é€™è£¡è¦æ³¨æ„ <code>bitDepth</code> è‹¥ç‚º 24 å‰‡è¡¨ç¤ºæœ‰ RGB ä¸‰è‰², å¤§å°å‰‡ç‚º <code>height * width * 3</code><br><code>bitDepth</code> å°æ–¼ç­‰æ–¼ 8 å‰‡åƒ <code>colorTable</code> é–‹é—¢çš„å¤§å°ç‚º <code>height * width</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fIn = fopen(&quot;images/lena_color.bmp&quot;, &quot;rb&quot;);</span><br><span class="line">    FILE *fOut = fopen(&quot;images/lena_gray.bmp&quot;, &quot;wb&quot;);</span><br><span class="line"></span><br><span class="line">    unsigned char imgHeader[54];</span><br><span class="line">    unsigned char colorTable[1024];</span><br><span class="line"></span><br><span class="line">    if (fIn == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;Unable to open image\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 54; i++)</span><br><span class="line">        imgHeader[i] = getc(fIn);</span><br><span class="line"></span><br><span class="line">    fwrite(imgHeader, sizeof(unsigned char), 54, fOut);</span><br><span class="line"></span><br><span class="line">    int height = *(int *)&amp;imgHeader[22];</span><br><span class="line">    int width = *(int *)&amp;imgHeader[18];</span><br><span class="line">    int bitDepth = *(int *)&amp;imgHeader[28];</span><br><span class="line"></span><br><span class="line">    if (bitDepth &lt;= 8)</span><br><span class="line">    &#123;</span><br><span class="line">        fread(colorTable, sizeof(unsigned char), 1024, fIn);</span><br><span class="line">        fwrite(colorTable, sizeof(unsigned char), 1024, fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int imgSize = height * width;</span><br><span class="line">    unsigned char buffer[imgSize][3];</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buffer[i][0] = getc(fIn);</span><br><span class="line">        buffer[i][1] = getc(fIn);</span><br><span class="line">        buffer[i][2] = getc(fIn);</span><br><span class="line"></span><br><span class="line">        int temp = 0;</span><br><span class="line">        temp = (buffer[i][0] * 0.3) + (buffer[i][1] * 0.59) + (buffer[i][2] * 0.11);</span><br><span class="line"></span><br><span class="line">        putc(temp, fOut);</span><br><span class="line">        putc(temp, fOut);</span><br><span class="line">        putc(temp, fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;Success!\n&quot;);</span><br><span class="line">    fclose(fIn);</span><br><span class="line">    fclose(fOut);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½‰ç‚º c# å¦‚ä¸‹, æœ‰ chatgpt çœŸé€Ÿåº¦ XD</p>
<p>è‡ªå·±è¦ºå¾—æ¯”è¼ƒé›£çš„é»æ‡‰è©²æ˜¯é€™å¥ <code>int width = *(int *)&amp;imgHeader[18];</code> ä»–æœƒæ’ˆ <code>18 19 20 21</code> é€™å¡Š data<br>åœ¨ c# å‰‡æ˜¯ç”¨ <code>int width = BitConverter.ToInt32(imgHeader, 18)</code> è®“ä»–å»æ’ˆé€™å¡Š<br>é€™é‚Šå¦‚æœç›´æ¥å¯«æˆ <code>int width = imgHeader[18];</code> çš„è©±å°±å–éŒ¯æ•¸å€¼äº†</p>
<p>æ­¤å¤– c# çš„ <code>2d array</code> æ˜¯ç”¨ <code>[,]</code> è¡¨ç¤º<br>å¦‚æœå¯«æˆ <code>[][]</code> å‰‡è¡¨ç¤º <code>jagged array</code> é€™é»è·Ÿ c ä¸å¤ªä¸€æ¨£</p>
<p>é‚„æœ‰ c çš„ <code>unsigned char</code> åœ¨ c# æ˜¯ç”¨ <code>byte</code></p>
<p>è®€å–çš„éƒ¨åˆ† c# å‰‡æ˜¯ç”¨å‡½æ•¸ Read å°±å¯ä»¥ä¸€å£æ°£è®€å– <code>int bytesRead = fIn.Read(imgHeader, 0, imgHeader.Length)</code>, ä¸ç”¨æå€‹ loop</p>
<p>é‚„æœ‰ä»–çš„ç¯„ä¾‹ code é¡è‰²é †åºæ˜¯ <code>RGB</code>, æ‡·ç–‘å¯èƒ½æ˜¯éŒ¯çš„ XD?<br>æˆ‘è¨˜æ†¶ä¸­æ‡‰è©²æ˜¯ <code>BGR</code> æ‰æ­£ç¢º, æ‰€ä»¥ä¿®æ­£ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">string inputFilePath = &quot;images/lena_color.bmp&quot;;</span><br><span class="line">string outputFilePath = &quot;images/lena_gray.bmp&quot;;</span><br><span class="line"></span><br><span class="line">// æ‰“é–‹è¼¸å…¥å’Œè¼¸å‡ºæ–‡ä»¶</span><br><span class="line">using FileStream fIn = new FileStream(inputFilePath, FileMode.Open, FileAccess.Read);</span><br><span class="line">using FileStream fOut = new FileStream(outputFilePath, FileMode.Create, FileAccess.Write);</span><br><span class="line"></span><br><span class="line">byte[] imgHeader = new byte[54];</span><br><span class="line">byte[] colorTable = new byte[1024];</span><br><span class="line"></span><br><span class="line">// è®€å– BMP æ¨™é ­</span><br><span class="line">int bytesRead = fIn.Read(imgHeader, 0, imgHeader.Length);</span><br><span class="line">if (bytesRead != imgHeader.Length)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Unable to read image header&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯«å…¥æ¨™é ­åˆ°è¼¸å‡ºæ–‡ä»¶</span><br><span class="line">fOut.Write(imgHeader, 0, imgHeader.Length);</span><br><span class="line"></span><br><span class="line">// ç²å–åœ–åƒçš„å¯¬åº¦ã€é«˜åº¦å’Œä½æ·±åº¦</span><br><span class="line">int height = BitConverter.ToInt32(imgHeader, 22);</span><br><span class="line">int width = BitConverter.ToInt32(imgHeader, 18);</span><br><span class="line">int bitDepth = BitConverter.ToInt16(imgHeader, 28);</span><br><span class="line"></span><br><span class="line">Console.WriteLine($&quot;height: &#123;height&#125;&quot;);</span><br><span class="line">Console.WriteLine($&quot;width: &#123;width&#125;&quot;);</span><br><span class="line">Console.WriteLine($&quot;bitDepth: &#123;bitDepth&#125;&quot;);</span><br><span class="line"></span><br><span class="line">// å¦‚æœä½æ·±åº¦å°æ–¼ç­‰æ–¼ 8ï¼Œè®€å–é¡è‰²è¡¨</span><br><span class="line">if (bitDepth &lt;= 8)</span><br><span class="line">&#123;</span><br><span class="line">    fIn.Read(colorTable, 0, colorTable.Length);</span><br><span class="line">    fOut.Write(colorTable, 0, colorTable.Length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¨ˆç®—åœ–åƒå¤§å°</span><br><span class="line">int imgSize = height * width;</span><br><span class="line">byte[,] buffer = new byte[imgSize, 3];</span><br><span class="line"></span><br><span class="line">// è®€å–åœ–åƒæ•¸æ“šä¸¦è½‰æ›ç‚ºç°éš</span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    buffer[i, 0] = (byte)blue;</span><br><span class="line">    buffer[i, 1] = (byte)green;</span><br><span class="line">    buffer[i, 2] = (byte)red;</span><br><span class="line"></span><br><span class="line">    int temp = 0;</span><br><span class="line">    //è½‰æ›ç°éšå…¬å¼ </span><br><span class="line">    //R * 0.299 + G * 0.587 + B * 0.114</span><br><span class="line">    temp = (int)(red * 0.299) + (int)(green * 0.587) + (int)(blue * 0.114);</span><br><span class="line">    fOut.WriteByte((byte)temp);</span><br><span class="line">    fOut.WriteByte((byte)temp);</span><br><span class="line">    fOut.WriteByte((byte)temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Console.WriteLine(&quot;Success!&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="äºŒå€¼åŒ–"><a href="#äºŒå€¼åŒ–" class="headerlink" title="äºŒå€¼åŒ–"></a>äºŒå€¼åŒ–</h2><p>äºŒå€¼åŒ–åªéœ€è¦çµ¦å€‹ threshold ç•¶å°æ–¼ threshold å‰‡çµ¦é»‘è‰² 0, å¤§æ–¼å‰‡çµ¦ç™½è‰² 255</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gray = (int)(red * 0.299) + (int)(green * 0.587) + (int)(blue * 0.114);</span><br><span class="line">binValue = 0;</span><br><span class="line">if(gray &lt; threshold) binValue = 0;</span><br><span class="line">else binValue = 255;</span><br><span class="line">fOut.WriteByte((byte)binValue);</span><br><span class="line">fOut.WriteByte((byte)binValue);</span><br><span class="line">fOut.WriteByte((byte)binValue);</span><br></pre></td></tr></table></figure>

<h2 id="äº®åº¦"><a href="#äº®åº¦" class="headerlink" title="äº®åº¦"></a>äº®åº¦</h2><p>äº®åº¦èª¿æ•´å‰‡æ˜¯çœ‹è¦è®Šäº®é‚„æ˜¯è®Šæš—, è®Šäº®çš„è©±å°±è®“æ•¸å€¼å¾€ 255 é æ”, åä¹‹å‰‡å¾€ 0 é æ”å³å¯<br>é€™è£¡å¾€æš—éƒ¨èª¿æ•´ç·´ä¸‹æŒ‡æ¨™, ä»–ç›´æ¥ç”¨ void, åƒæ•¸è¦ç”¨ <code>unsigned char *value</code>, å‘¼å«æ™‚è¨˜å¾—åŠ ä¸Š <code>&amp;</code> ç¬¦è™Ÿå³å¯, åƒé€™æ¨£ <code>to_darkness(&amp;buffer[i][0])</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#define BRIGHTNESS 50</span><br><span class="line">#define DARKNESS 50</span><br><span class="line"></span><br><span class="line">int to_brightness(int value)</span><br><span class="line">&#123;</span><br><span class="line">    if (value + BRIGHTNESS &gt;= 255)</span><br><span class="line">        return 255;</span><br><span class="line">    else</span><br><span class="line">        return value + BRIGHTNESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç”¨æ³•</span><br><span class="line">//to_darkness(&amp;buffer[i][0]);</span><br><span class="line">void to_darkness(unsigned char *value)</span><br><span class="line">&#123;</span><br><span class="line">    if (*value - DARKNESS &lt;= 0)</span><br><span class="line">        *value = 0;</span><br><span class="line">    else</span><br><span class="line">        *value = *value - DARKNESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	//ç•¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™è£¡ c# çš„å¯«æ³•å¦‚ä¸‹, é¦–å…ˆéœ€è¦åœ¨ <code>csproj</code> è£¡é¢è¨­å®šæ‰“é–‹ <code>unsafe</code> åŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;PropertyGroup&gt;</span><br><span class="line">   &lt;OutputType&gt;Exe&lt;/OutputType&gt;</span><br><span class="line">   &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;</span><br><span class="line">   &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;</span><br><span class="line">   &lt;Nullable&gt;enable&lt;/Nullable&gt;</span><br><span class="line">&lt;!-- åŠ å…¥é€™è¡Œæ‰“é–‹ unsafe åŠŸèƒ½ --&gt;</span><br><span class="line">   &lt;AllowUnsafeBlocks&gt;True&lt;/AllowUnsafeBlocks&gt;</span><br><span class="line"> &lt;/PropertyGroup&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥è‘—å¯«äº®åº¦èª¿æ•´çš„å‡½æ•¸, æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯éœ€è¦åœ¨å‡½æ•¸é–‹é ­åŠ ä¸Š <code>unsafe</code> é—œéµå­—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">unsafe void ToBrightness(byte* value)</span><br><span class="line">&#123;</span><br><span class="line">    const int BRIGHTNESS = 100;</span><br><span class="line">    if (*value + BRIGHTNESS &gt;= 255) *value = 255;</span><br><span class="line">    else *value += BRIGHTNESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsafe void ToDarkness(byte* value)</span><br><span class="line">&#123;</span><br><span class="line">    const int DARKNESS = 100;</span><br><span class="line">    if (*value - DARKNESS &lt;= 0) *value = 0;</span><br><span class="line">    else *value -= DARKNESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘¼å«æ™‚è¦å…ˆé–‹ä¸€å€‹ <code>unsafe</code> å€å¡Š, ç”¨ <code>fixed</code> æ’ˆæŒ‡æ¨™, æœ€å¾Œè·Ÿ c ä¸€æ¨£å‘¼å«å°±å¯ä»¥æƒ¹, æ•´å€‹ç‚«ç‚® ~</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">unsafe</span><br><span class="line">&#123;</span><br><span class="line">	for (int j = 0; j &lt; 3; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		fixed (byte* ptr = &amp;buffer[i, j])</span><br><span class="line">		&#123;</span><br><span class="line">			ToBrightness(ptr);</span><br><span class="line">			fOut.WriteByte(*ptr);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›´æ–¹åœ–-Histogram"><a href="#ç›´æ–¹åœ–-Histogram" class="headerlink" title="ç›´æ–¹åœ– Histogram"></a>ç›´æ–¹åœ– Histogram</h2><p>é€™è£¡çš„ c# code å¦‚ä¸‹<br>é¦–å…ˆé–‹é—¢ <code>int[,] ihist = new int[3, 256]</code> ä¾†æ”¾ bgr æ¯å€‹ pixel çš„è‰²å½©ç´¢å¼•<br>å› ç‚ºè‰²å½©æœƒç”± <code>0 ~ 255</code> å…± <code>256</code> å€‹å€¼, é–‹é—¢ç©ºé–“è¦æ³¨æ„ä¸‹ <code>ä¸è¦å¯«æˆ 255</code>, é€™è£¡ä¸€æ¨£ç”¨ <code>bgr</code> çš„é †åºä¾†è¨˜éŒ„</p>
<p>æ¥è‘—é–‹ä¸€å€‹ sum array ä¾†å­˜ç›®å‰ pixel æ•¸é‡</p>
<p>ç„¶å¾Œç”¨ for loop æŠŠç›®å‰ pixel çš„ index èˆ‡ sum ä¿å­˜èµ·ä¾†</p>
<p>æ¥è‘—å®£å‘Š <code>float[,] hist = new float[3, 256]</code> ä¾†ä¿å­˜çµæœ<br>ç”¨ loop å°‡ <code>ä¿å­˜è‰²å½©æ•¸å€¼ / sum</code> ä¾†å–å¾—æ¯å€‹é»ä½ç›´æ–¹åœ–çš„æ•¸å€¼å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">string inputFilePath = &quot;images/lena_color.bmp&quot;;</span><br><span class="line">string outputFilePath = &quot;images/histogram_rgb.txt&quot;;</span><br><span class="line"></span><br><span class="line">// æ‰“é–‹è¼¸å…¥å’Œè¼¸å‡ºæ–‡ä»¶</span><br><span class="line">using FileStream fIn = new FileStream(inputFilePath, FileMode.Open, FileAccess.Read);</span><br><span class="line">using StreamWriter fOut = new StreamWriter(outputFilePath);</span><br><span class="line"></span><br><span class="line">byte[] imgHeader = new byte[54];</span><br><span class="line"></span><br><span class="line">int bytesRead = fIn.Read(imgHeader, 0, imgHeader.Length);</span><br><span class="line">if (bytesRead != imgHeader.Length)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Unable to read image header&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int height = BitConverter.ToInt32(imgHeader, 22);</span><br><span class="line">int width = BitConverter.ToInt32(imgHeader, 18);</span><br><span class="line"></span><br><span class="line">//å½±åƒå¤§å° (é«˜ * å¯¬)</span><br><span class="line">int imgSize = height * width;</span><br><span class="line"></span><br><span class="line">//è¨˜éŒ„ rgb çš„ 0 - 255 è‰²å½©ç´¢å¼•</span><br><span class="line">int[,] ihist = new int[3, 256];</span><br><span class="line"></span><br><span class="line">//è¨˜éŒ„ rgb ç›®å‰åŠ ç¸½æ•¸é‡</span><br><span class="line">int[] sum = new int[3];</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    ihist[0, blue] = ihist[0, blue] + 1;</span><br><span class="line">    ihist[1, green] = ihist[1, green] + 1;</span><br><span class="line">    ihist[2, red] = ihist[2, red] + 1;</span><br><span class="line">	</span><br><span class="line">    sum[0]++;</span><br><span class="line">    sum[1]++;</span><br><span class="line">    sum[2]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æœ€çµ‚çµæœ</span><br><span class="line">float[,] hist = new float[3, 256];</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; 256; i++)</span><br><span class="line">&#123;</span><br><span class="line">    hist[0, i] = (float)ihist[0, i] / (float)sum[0];</span><br><span class="line">    hist[1, i] = (float)ihist[1, i] / (float)sum[1];</span><br><span class="line">    hist[2, i] = (float)ihist[2, i] / (float)sum[2];</span><br><span class="line">    fOut.Write(&quot;&#123;0&#125; &#123;1&#125; &#123;2&#125;&quot; , hist[0 , i].ToString(&quot;F6&quot;), hist[1 , i].ToString(&quot;F6&quot;), hist[2 , i].ToString(&quot;F6&quot;));</span><br><span class="line">    if (i &lt; 255) fOut.WriteLine();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹ä»–çš„èª²ç¨‹ç”¨ gnuplot æ‡¶å¾—å®‰è£çš„è©±å¯ä»¥ç›´æ¥ç”¨é€™å€‹ç·šä¸Šç‰ˆæœ¬ <a target="_blank" rel="noopener" href="https://gnuplot.io/">https://gnuplot.io/</a><br>å¯ä»¥è·Ÿé€™å€‹ç¶²ç«™ <a target="_blank" rel="noopener" href="https://sisik.eu/histo">https://sisik.eu/histo</a> ç•«å‡ºä¾†çš„å°ç…§, ä¸éèº«ææœƒæœ‰é»èµ°é˜èµ°é˜ XD<br>ç„¶å¾Œæ•²å…¥ä»¥ä¸‹ code ä¾†åŸ·è¡Œ, å°±å¯ä»¥ç•«å‡ºä¾†ä¸‰å€‹ band çš„ç›´æ–¹åœ–æƒ¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># è¨­å®šæ¨™é¡Œ</span><br><span class="line">set title &quot;RGB Histogram&quot;</span><br><span class="line"></span><br><span class="line"># è¨­å®šxè»¸ç¯„åœ</span><br><span class="line">set xlabel &quot;Pixel Value&quot;</span><br><span class="line">set xrange [0:255]</span><br><span class="line"></span><br><span class="line"># è¨­å®šyè»¸ç¯„åœ</span><br><span class="line">set ylabel &quot;Frequency&quot;</span><br><span class="line"></span><br><span class="line"># è¨­å®šé¡è‰²ï¼Œé€™è£¡æ˜¯ç´…è‰²ã€ç¶ è‰²å’Œè—è‰²é€šé“çš„é¡è‰²</span><br><span class="line">set style line 1 linecolor rgb &quot;blue&quot;  linetype 1 linewidth 2</span><br><span class="line">set style line 2 linecolor rgb &quot;green&quot; linetype 1 linewidth 2</span><br><span class="line">set style line 3 linecolor rgb &quot;red&quot; linetype 1 linewidth 2</span><br><span class="line"></span><br><span class="line"># ç¹ªè£½ç›´æ–¹åœ–ï¼Œä½¿ç”¨ä¸‰åˆ—è³‡æ–™ï¼Œä¸¦è¨­å®šä¸åŒé¡è‰²</span><br><span class="line">plot &quot;data3.txt&quot; using 1 with lines linestyle 1 title &quot;Blue&quot;, \</span><br><span class="line">     &quot;data3.txt&quot; using 2 with lines linestyle 2 title &quot;Green&quot;, \</span><br><span class="line">     &quot;data3.txt&quot; using 3 with lines linestyle 3 title &quot;Red&quot;</span><br></pre></td></tr></table></figure>

<p>æˆ–æ˜¯ç”¨ python ä¾†ç•«ä¹Ÿå¯ä»¥, é€™è£¡è¦æ³¨æ„ rgb é †åº, js æ˜¯ rgb , c or c# æ˜¯ bgr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#jupyter notebook</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">data = np.loadtxt(&quot;histogram_rgb.txt&quot;)</span><br><span class="line"></span><br><span class="line"># å‡è¨­è³‡æ–™æ˜¯ä¸‰åˆ—ï¼Œåˆ†åˆ¥ä»£è¡¨ç´…è‰²ã€ç¶ è‰²å’Œè—è‰²çš„åƒç´ å€¼</span><br><span class="line">blue = data[:, 0]</span><br><span class="line">green = data[:, 1]</span><br><span class="line">red = data[:, 2]</span><br><span class="line"></span><br><span class="line">plt.plot(blue,&#x27;b&#x27;)</span><br><span class="line">plt.plot(green,&#x27;g&#x27;)</span><br><span class="line">plt.plot(red,&#x27;r&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è¨­å®šæ¨™é¡Œå’Œè»¸æ¨™ç±¤</span><br><span class="line">plt.title(&#x27;RGB Histogram&#x27;)</span><br><span class="line">plt.xlabel(&#x27;Pixel Value&#x27;)</span><br><span class="line">plt.ylabel(&#x27;Frequency&#x27;)</span><br><span class="line"></span><br><span class="line"># é¡¯ç¤ºåœ–ä¾‹</span><br><span class="line">plt.legend([&#x27;blue&#x27;,&#x27;green&#x27;,&#x27;red&#x27;])</span><br><span class="line"></span><br><span class="line"># é¡¯ç¤ºåœ–è¡¨</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>é€™è£¡ js æ¯”è¼ƒç‰¹åˆ¥<br>é–‹é—¢ 2d array éœ€è¦ç”¨ Array(256).fill(0) æ‰æœƒå¡ 0 åœ¨è£¡é¢, å…¶ä»–å°±å·®ä¸å¤š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">histogram(canvas) &#123;</span><br><span class="line">  let ctx = canvas.getContext(&quot;2d&quot;);</span><br><span class="line">  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</span><br><span class="line">  const pixels = imageData.data;</span><br><span class="line"></span><br><span class="line">  let ihist = [</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  let sum = [0, 0, 0];</span><br><span class="line"></span><br><span class="line">  for (let i = 0; i &lt; pixels.length; i += 4) &#123;</span><br><span class="line">    const r = pixels[i]; // ç´…è‰²</span><br><span class="line">    const g = pixels[i + 1]; // ç¶ è‰²</span><br><span class="line">    const b = pixels[i + 2]; // è—è‰²</span><br><span class="line">    const a = pixels[i + 3]; // é€æ˜åº¦</span><br><span class="line"></span><br><span class="line">    ihist[0][r] = ihist[0][r] + 1;</span><br><span class="line">    ihist[1][g] = ihist[1][g] + 1;</span><br><span class="line">    ihist[2][b] = ihist[2][b] + 1;</span><br><span class="line"></span><br><span class="line">    sum[0]++;</span><br><span class="line">    sum[1]++;</span><br><span class="line">    sum[2]++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let hist = [</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">    new Array(256).fill(0),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  let str = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">  for (let i = 0; i &lt; 256; i++) &#123;</span><br><span class="line">    hist[0][i] = ihist[0][i] / sum[0];</span><br><span class="line">    hist[1][i] = ihist[1][i] / sum[1];</span><br><span class="line">    hist[2][i] = ihist[2][i] / sum[2];</span><br><span class="line"></span><br><span class="line">    let r = hist[0][i].toFixed(6);</span><br><span class="line">    let g = hist[1][i].toFixed(6);</span><br><span class="line">    let b = hist[2][i].toFixed(6);</span><br><span class="line">    str += `$&#123;r&#125; $&#123;g&#125; $&#123;b&#125;`;</span><br><span class="line">    if (i &lt; 255) str += &quot;\n&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Histogram-Equalization"><a href="#Histogram-Equalization" class="headerlink" title="Histogram Equalization"></a>Histogram Equalization</h2><p>å»¶çºŒè®€å–å‡º Histogram çš„æ•¸å€¼ä»¥å¾Œ, å¯ä»¥ç”¨ Histogram Equalization ä¾†è®“è‰²å½©å¹³å‡åˆ†å¸ƒ</p>
<p>é€™é‚Šå…ˆå®£å‘Šä¸€å€‹ç”¨ä¾†å­˜çµæœçš„ array <code>int[,] histEq = new int[3, 256]</code></p>
<p>æ¥è‘—é›™é‡ loop è·‘ <code>ç´¯ç©åˆ†å¸ƒå‡½æ•¸ CDF cumulative distribution function</code>, å• gpt èªªåŠ  0.5 æ•ˆæœæœƒæ¯”è¼ƒå¥½</p>
<p>å†ä¾†æŠŠ Position æ­¸ä½, å› ç‚ºä¸€é–‹å§‹æª”æ¡ˆæœ‰å…ˆè®€éä¸€æ¬¡äº†, æ­¤æ™‚ä½ç½®ç‚º -1, å°‡ä»–èª¿æ•´åˆ° 54<br>ä¾åºæŠŠ bgr æ•¸å€¼æ‹¿å‡ºä¾†, ä¸¦ä¸”ä¸Ÿå…¥ histEq é€™å€‹ array å°æ‡‰çš„ç´¢å¼•å–å¾—æ–°çš„æ•¸å€¼, æœ€å¾Œå¯«å…¥æª”æ¡ˆä¾¿å¯</p>
<p>é©—è­‰å¯ä»¥åˆ°é€™å€‹ç¶²ç«™ <a target="_blank" rel="noopener" href="https://www7.lunapic.com/editor/?action=adaptive-equalize">https://www7.lunapic.com/editor/?action=adaptive-equalize</a> ä¾†çœ‹çœ‹çµæœæ˜¯å¦ä¸€æ¨£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">string inputFilePath = &quot;images/lena_color.bmp&quot;;</span><br><span class="line">string outputFilePath = &quot;images/lenaeq.bmp&quot;;</span><br><span class="line"></span><br><span class="line">// æ‰“é–‹è¼¸å…¥å’Œè¼¸å‡ºæ–‡ä»¶</span><br><span class="line">using FileStream fIn = new FileStream(inputFilePath, FileMode.Open, FileAccess.Read);</span><br><span class="line">using FileStream fOut = new FileStream(outputFilePath, FileMode.Create, FileAccess.Write);</span><br><span class="line">//using StreamWriter fOut = new StreamWriter(outputFilePath);</span><br><span class="line"></span><br><span class="line">byte[] imgHeader = new byte[54];</span><br><span class="line">byte[] colorTable = new byte[1024];</span><br><span class="line"></span><br><span class="line">// è®€å– BMP æ¨™é ­</span><br><span class="line">int bytesRead = fIn.Read(imgHeader, 0, imgHeader.Length);</span><br><span class="line">if (bytesRead != imgHeader.Length)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Unable to read image header&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯«å…¥æ¨™é ­åˆ°è¼¸å‡ºæ–‡ä»¶</span><br><span class="line">fOut.Write(imgHeader, 0, imgHeader.Length);</span><br><span class="line"></span><br><span class="line">// ç²å–åœ–åƒçš„å¯¬åº¦ã€é«˜åº¦å’Œä½æ·±åº¦</span><br><span class="line">int height = BitConverter.ToInt32(imgHeader, 22);</span><br><span class="line">int width = BitConverter.ToInt32(imgHeader, 18);</span><br><span class="line">int bitDepth = BitConverter.ToInt16(imgHeader, 28);</span><br><span class="line"></span><br><span class="line">//Console.WriteLine($&quot;height: &#123;height&#125;&quot;);</span><br><span class="line">//Console.WriteLine($&quot;width: &#123;width&#125;&quot;);</span><br><span class="line">//Console.WriteLine($&quot;bitDepth: &#123;bitDepth&#125;&quot;);</span><br><span class="line"></span><br><span class="line">// å¦‚æœä½æ·±åº¦å°æ–¼ç­‰æ–¼ 8ï¼Œè®€å–é¡è‰²è¡¨</span><br><span class="line">if (bitDepth &lt;= 8)</span><br><span class="line">&#123;</span><br><span class="line">    fIn.Read(colorTable, 0, colorTable.Length);</span><br><span class="line">    //fOut.Write(colorTable, 0, colorTable.Length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¨ˆç®—åœ–åƒå¤§å°</span><br><span class="line">int imgSize = height * width;</span><br><span class="line"></span><br><span class="line">int[,] ihist = new int[3, 256];</span><br><span class="line">int[] sum = new int[3];</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    ihist[0, blue] = ihist[0, blue] + 1;</span><br><span class="line">    ihist[1, green] = ihist[1, green] + 1;</span><br><span class="line">    ihist[2, red] = ihist[2, red] + 1;</span><br><span class="line">    sum[0]++;</span><br><span class="line">    sum[1]++;</span><br><span class="line">    sum[2]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float[,] hist = new float[3, 256];</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; 256; i++)</span><br><span class="line">&#123;</span><br><span class="line">    hist[0, i] = (float)ihist[0, i] / (float)sum[0];</span><br><span class="line">    hist[1, i] = (float)ihist[1, i] / (float)sum[1];</span><br><span class="line">    hist[2, i] = (float)ihist[2, i] / (float)sum[2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç´¯ç©åˆ†å¸ƒå‡½æ•¸ CDF cumulative distribution function</span><br><span class="line">int[,] histEq = new int[3, 256];</span><br><span class="line">for (int i = 0; i &lt; 256; i++)</span><br><span class="line">&#123;</span><br><span class="line">    float cdfBlueSum = 0.0f;</span><br><span class="line">    float cdfGreenSum = 0.0f;</span><br><span class="line">    float cdfRedSum = 0.0f;</span><br><span class="line">    for (int j = 0; j &lt;= i; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        cdfBlueSum += hist[0, j];</span><br><span class="line">        cdfGreenSum += hist[1, j];</span><br><span class="line">        cdfRedSum += hist[2, j];</span><br><span class="line">    &#125;</span><br><span class="line">    //åŠ  0.5 çš„è©±æœƒå¾—åˆ°æ¯”è¼ƒå„ªçš„æ•ˆæœ</span><br><span class="line">    histEq[0, i] = (int)(255 * cdfBlueSum + 0.5);</span><br><span class="line">    histEq[1, i] = (int)(255 * cdfGreenSum + 0.5);</span><br><span class="line">    histEq[2, i] = (int)(255 * cdfRedSum + 0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å› ç‚ºå·²ç¶“è®€éä¸€æ¬¡, æ‰€ä»¥éœ€è¦ç§»å‹•ä½ç½®è·³é header ä¹Ÿå¯ä»¥ç”¨ Seek å‡½æ•¸</span><br><span class="line">fIn.Position = 54;</span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    var blueEq = histEq[0, blue];</span><br><span class="line">    var greenEq = histEq[1, green];</span><br><span class="line">    var redEq = histEq[2, red];</span><br><span class="line"></span><br><span class="line">    fOut.WriteByte((byte)blueEq);</span><br><span class="line">    fOut.WriteByte((byte)greenEq);</span><br><span class="line">    fOut.WriteByte((byte)redEq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Console.WriteLine(&quot;Success!&quot;);</span><br></pre></td></tr></table></figure>

<p>ä»–åŸå§‹çš„ c ç¨‹å¼ç¢¼å¦‚ä¸‹, ä¸éä»–æ˜¯åªåšç°éš, æˆ‘æ˜¯åš RGB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#define BMP_HEADER_SIZE         54</span><br><span class="line">#define BMP_COLOR_TABLE_SIZE    1024</span><br><span class="line">#define CUSTOM_IMG_SIZE         512*512</span><br><span class="line"></span><br><span class="line">float IMG_HIST[255];</span><br><span class="line"></span><br><span class="line">void  imageReader(const char *imgName,</span><br><span class="line">                  int *_height,</span><br><span class="line">                  int *_width,</span><br><span class="line">                  int *_bitDepth,</span><br><span class="line">                  unsigned char *_header,</span><br><span class="line">                  unsigned char *_colorTable,</span><br><span class="line">                  unsigned char *_buf</span><br><span class="line">                  );</span><br><span class="line"> void imageWriter(const char *imgName,</span><br><span class="line">                 unsigned char *header,</span><br><span class="line">                 unsigned char *colorTable,</span><br><span class="line">                 unsigned char *buf,</span><br><span class="line">                 int bitDepth) ;</span><br><span class="line"></span><br><span class="line">void ImgHistogram(unsigned char * _imgData, int imgRows, int imgCols, float hist[]);</span><br><span class="line">void ImgHistogramEqualization(unsigned char *_inputImgData, unsigned char *_outputImgData,int imgRows,int imgCols);</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int imgWidth, imgHeight,imgBitDepth;</span><br><span class="line">    unsigned char imgHeader[BMP_HEADER_SIZE];</span><br><span class="line">    unsigned char imgColorTable[BMP_COLOR_TABLE_SIZE];</span><br><span class="line">    unsigned char imgBuffer[CUSTOM_IMG_SIZE];</span><br><span class="line">    unsigned char imgBuffer2[CUSTOM_IMG_SIZE];</span><br><span class="line"></span><br><span class="line">    const char imgName[] = &quot;lena512.bmp&quot;;</span><br><span class="line">    const char newImgName[] =&quot;lena_eqz.bmp&quot;;</span><br><span class="line"></span><br><span class="line">    imageReader(imgName,&amp;imgHeight,&amp;imgWidth,&amp;imgBitDepth,&amp;imgHeader[0],&amp;imgColorTable[0],&amp;imgBuffer[0]);</span><br><span class="line">    ImgHistogramEqualization(&amp;imgBuffer[0],&amp;imgBuffer2[0],imgHeight,imgWidth);</span><br><span class="line">    imageWriter(newImgName,imgHeader,imgColorTable,imgBuffer2,imgBitDepth);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void imageWriter(const char *imgName,</span><br><span class="line">                 unsigned char *header,</span><br><span class="line">                 unsigned char *colorTable,</span><br><span class="line">                 unsigned char *buf,</span><br><span class="line">                 int bitDepth)</span><br><span class="line">   &#123;</span><br><span class="line">     FILE *fo = fopen(imgName,&quot;wb&quot;);</span><br><span class="line">     fwrite(header,sizeof(unsigned char),54,fo);</span><br><span class="line">     if(bitDepth &lt;=8)</span><br><span class="line">     &#123;</span><br><span class="line">         fwrite(colorTable,sizeof(unsigned char),1024,fo);</span><br><span class="line">     &#125;</span><br><span class="line">     fwrite(buf,sizeof(unsigned char),CUSTOM_IMG_SIZE, fo);</span><br><span class="line">     fclose(fo);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   void  imageReader(const char *imgName,</span><br><span class="line">                  int *_height,</span><br><span class="line">                  int *_width,</span><br><span class="line">                  int *_bitDepth,</span><br><span class="line">                  unsigned char *_header,</span><br><span class="line">                  unsigned char *_colorTable,</span><br><span class="line">                  unsigned char *_buf</span><br><span class="line">                  )</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line">    FILE *streamIn;</span><br><span class="line">    streamIn = fopen(imgName,&quot;rb&quot;);</span><br><span class="line"></span><br><span class="line">    if(streamIn ==(FILE *)0)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        printf(&quot;Unable to read image \n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(i =0;i&lt;54;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _header[i] = getc(streamIn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *_width = *(int *)&amp;_header[18];</span><br><span class="line">    *_height = *(int *)&amp;_header[22];</span><br><span class="line">    *_bitDepth = *(int *)&amp;_header[28];</span><br><span class="line"></span><br><span class="line">    if(*_bitDepth &lt;=8)</span><br><span class="line">    &#123;</span><br><span class="line">        fread(_colorTable,sizeof(unsigned char),1024,streamIn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fread(_buf,sizeof(unsigned char),CUSTOM_IMG_SIZE,streamIn);</span><br><span class="line"></span><br><span class="line">    fclose(streamIn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void ImgHistogram(unsigned char * _imgData, int imgRows, int imgCols, float hist[])</span><br><span class="line">&#123;</span><br><span class="line">  FILE *fptr;</span><br><span class="line">  fptr = fopen(&quot;image_hist.txt&quot;,&quot;w&quot;);</span><br><span class="line">  int x,y,i,j;</span><br><span class="line">  long int ihist[255];</span><br><span class="line">  long int sum;</span><br><span class="line"></span><br><span class="line">  for(i=0;i&lt;=255;i++)</span><br><span class="line">  &#123;</span><br><span class="line">      ihist[i] = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  sum =0;</span><br><span class="line">  for(y =0;y&lt;imgRows;y++)</span><br><span class="line">  &#123;</span><br><span class="line">      for(x=0;x&lt;imgCols;x++)</span><br><span class="line">      &#123;</span><br><span class="line">          j = *(_imgData+x+y*imgCols);</span><br><span class="line">          ihist[j] = ihist[j] +1;</span><br><span class="line">          sum = sum +1;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    for( i =0;i&lt;255;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        hist[i] = (float)ihist[i]/(float)sum;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     for(int i=0;i&lt;255;i++)</span><br><span class="line">     &#123;</span><br><span class="line">         fprintf(fptr,&quot;\n%f&quot;,hist[i]);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    fclose(fptr);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ImgHistogramEqualization(unsigned char *_inputImgData, unsigned char *_outputImgData,int imgRows,int imgCols)</span><br><span class="line">&#123;</span><br><span class="line">    int x,y,i,j;</span><br><span class="line">    int histeq[256];</span><br><span class="line">    float hist[256];</span><br><span class="line">    float sum;</span><br><span class="line"></span><br><span class="line">    ImgHistogram(&amp;_inputImgData[0], imgRows,imgCols,&amp;hist[0]);</span><br><span class="line"></span><br><span class="line">    for(i=0;i&lt;255;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum =0.0;</span><br><span class="line">        for(j=0;j&lt;=i;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            sum = sum+hist[j];</span><br><span class="line">        &#125;</span><br><span class="line">        histeq[i] = (int)(255*sum+0.5);</span><br><span class="line">    &#125;</span><br><span class="line">    for(y =0;y&lt;imgRows;y++)</span><br><span class="line">    &#123;</span><br><span class="line">        for(x=0;x&lt;imgCols;x++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(_outputImgData+x+y*imgCols) =  histeq[*(_inputImgData+x+y*imgCols)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è² ç‰‡æ•ˆæœ-aka-éˆç•°æ•ˆæœ-filter"><a href="#è² ç‰‡æ•ˆæœ-aka-éˆç•°æ•ˆæœ-filter" class="headerlink" title="è² ç‰‡æ•ˆæœ aka éˆç•°æ•ˆæœ filter"></a>è² ç‰‡æ•ˆæœ aka éˆç•°æ•ˆæœ filter</h2><p>è² ç‰‡æ•ˆæœæ¯”è¼ƒç°¡å–®, ä¸ç®¡ç°éšæˆ–å½©è‰²åªè¦ç”¨ <code>255 - ç›®å‰è‰²å½©</code> å°±å¯ä»¥äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    fOut.WriteByte((byte)(255 - blue));</span><br><span class="line">    fOut.WriteByte((byte)(255 - green));</span><br><span class="line">    fOut.WriteByte((byte)(255 - red));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å½±åƒæ¨¡ç³Š-aka-è¿·ç‰‡æ•ˆæœ-filter"><a href="#å½±åƒæ¨¡ç³Š-aka-è¿·ç‰‡æ•ˆæœ-filter" class="headerlink" title="å½±åƒæ¨¡ç³Š aka è¿·ç‰‡æ•ˆæœ filter"></a>å½±åƒæ¨¡ç³Š aka è¿·ç‰‡æ•ˆæœ filter</h2><p>é¦–å…ˆè¦æº–å‚™ä¸€å€‹ 3x3 çš„ array filter<br>é€™å€‹ filter æœƒè¨ˆç®—æ¯å€‹ pixel å‘¨åœ 3x3 å€åŸŸå…§çš„å¹³å‡å€¼ä¾†é€²è¡Œæ¨¡ç³Šè™•ç†</p>
<p>å¹³å¸¸åœ¨è®€å½±åƒæ™‚éƒ½æœƒç”± <code>å¯¬é«˜èµ·å§‹å€¼ 0</code> ~ <code>å¯¬é«˜çµæŸå€¼</code><br>é€™è£¡çš„è¿´åœˆå› ç‚ºè¦æ”¾ 3x3 filter æ‰€ä»¥ç”± <code>å¯¬é«˜èµ·å§‹å€¼ + 1</code> ~ <code>å¯¬é«˜çµæŸå€¼ - 1</code></p>
<p>ä¸éé€™æ¨£åšæœƒæœ‰é»‘é‚Š, æœ€å¾Œé‚„è¦å†è£œä¸‹è®“é»‘é‚Šçš„ pixel æ˜¯ä¸Šä¸‹æˆ–æ˜¯å·¦å³çš„ pixel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">string inputFilePath = &quot;images/lena_color.bmp&quot;;</span><br><span class="line">string outputFilePath = &quot;images/lena_blur.bmp&quot;;</span><br><span class="line"></span><br><span class="line">// æ‰“é–‹è¼¸å…¥å’Œè¼¸å‡ºæ–‡ä»¶</span><br><span class="line">using FileStream fIn = new FileStream(inputFilePath, FileMode.Open, FileAccess.Read);</span><br><span class="line">using FileStream fOut = new FileStream(outputFilePath, FileMode.Create, FileAccess.Write);</span><br><span class="line"></span><br><span class="line">byte[] imgHeader = new byte[54];</span><br><span class="line">byte[] colorTable = new byte[1024];</span><br><span class="line"></span><br><span class="line">// è®€å– BMP æ¨™é ­</span><br><span class="line">int bytesRead = fIn.Read(imgHeader, 0, imgHeader.Length);</span><br><span class="line">if (bytesRead != imgHeader.Length)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Unable to read image header&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯«å…¥æ¨™é ­åˆ°è¼¸å‡ºæ–‡ä»¶</span><br><span class="line">fOut.Write(imgHeader, 0, imgHeader.Length);</span><br><span class="line"></span><br><span class="line">// ç²å–åœ–åƒçš„å¯¬åº¦ã€é«˜åº¦å’Œä½æ·±åº¦</span><br><span class="line">int height = BitConverter.ToInt32(imgHeader, 22);</span><br><span class="line">int width = BitConverter.ToInt32(imgHeader, 18);</span><br><span class="line">int bitDepth = BitConverter.ToInt16(imgHeader, 28);</span><br><span class="line"></span><br><span class="line">Console.WriteLine($&quot;height: &#123;height&#125;&quot;);</span><br><span class="line">Console.WriteLine($&quot;width: &#123;width&#125;&quot;);</span><br><span class="line">Console.WriteLine($&quot;bitDepth: &#123;bitDepth&#125;&quot;);</span><br><span class="line"></span><br><span class="line">// å¦‚æœä½æ·±åº¦å°æ–¼ç­‰æ–¼ 8ï¼Œè®€å–é¡è‰²è¡¨</span><br><span class="line">if (bitDepth &lt;= 8)</span><br><span class="line">&#123;</span><br><span class="line">    fIn.Read(colorTable, 0, colorTable.Length);</span><br><span class="line">    fOut.Write(colorTable, 0, colorTable.Length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¨ˆç®—åœ–åƒå¤§å°</span><br><span class="line">int imgSize = height * width;</span><br><span class="line"></span><br><span class="line">//ç›®å‰å½±åƒ</span><br><span class="line">byte[,] buffer = new byte[imgSize, 3];</span><br><span class="line"></span><br><span class="line">//è¼¸å‡ºå½±åƒ</span><br><span class="line">byte[,] outBuffer = new byte[imgSize, 3];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//è®€å–ç›®å‰å½±åƒçš„ pixel</span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    buffer[i, 0] = (byte)blue;</span><br><span class="line">    buffer[i, 1] = (byte)green;</span><br><span class="line">    buffer[i, 2] = (byte)red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å› ç‚ºæ˜¯ 3*3 æ‰€ä»¥æ•¸å€¼è¦ç”¨ 9</span><br><span class="line">float blur = 1.0f / 9.0f;</span><br><span class="line">float[,] filter = &#123;</span><br><span class="line">    &#123;blur , blur , blur&#125;,</span><br><span class="line">    &#123;blur , blur , blur&#125;,</span><br><span class="line">    &#123;blur , blur , blur&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">for (int y = 1; y &lt; height - 1; y++)</span><br><span class="line">&#123;</span><br><span class="line">    for (int x = 1; x &lt; width - 1; x++)</span><br><span class="line">    &#123;</span><br><span class="line">        float sum0 = 0.0f;</span><br><span class="line">        float sum1 = 0.0f;</span><br><span class="line">        float sum2 = 0.0f;</span><br><span class="line"></span><br><span class="line">        //å° 3x3 çš„ filter loop ç®—å‡ºåŠ æ¬Šå¹³å‡çµæœ</span><br><span class="line">        for (int fy = -1; fy &lt;= 1; fy++)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int fx = -1; fx &lt;= 1; fx++)</span><br><span class="line">            &#123;</span><br><span class="line">                //åŸå§‹å€¼</span><br><span class="line">                //var blue = buffer[y * width + x, 0];</span><br><span class="line">                //var red = buffer[y * width + x, 1];</span><br><span class="line">                //var green = buffer[y * width + x, 1];</span><br><span class="line"></span><br><span class="line">                //blur æ¨¡ç³Šå€¼</span><br><span class="line">                var blue = filter[fy + 1, fx + 1] * buffer[(y + fy) * width + (x + fx), 0];</span><br><span class="line">                var green = filter[fy + 1, fx + 1] * buffer[(y + fy) * width + (x + fx), 1];</span><br><span class="line">                var red = filter[fy + 1, fx + 1] * buffer[(y + fy) * width + (x + fx), 2];</span><br><span class="line"></span><br><span class="line">                sum0 += blue;</span><br><span class="line">                sum1 += green;</span><br><span class="line">                sum2 += red;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //æŠŠåŠ æ¬Šå€¼ä¸Ÿåˆ°ç›®å‰é€™å€‹ pixel</span><br><span class="line">        outBuffer[y * width + x, 0] = (byte)sum0;</span><br><span class="line">        outBuffer[y * width + x, 1] = (byte)sum1;</span><br><span class="line">        outBuffer[y * width + x, 2] = (byte)sum2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//é»‘é‚Šè™•ç†</span><br><span class="line">for (int y = 0; y &lt; height; y++)</span><br><span class="line">&#123;</span><br><span class="line">    for (int x = 0; x &lt; width; x++)</span><br><span class="line">    &#123;</span><br><span class="line">        // å°æ–¼æœ€ä¸Šé¢ä¸€è¡Œï¼Œè¨­ç½®èˆ‡ä¸‹ä¸€è¡Œç›¸åŒ</span><br><span class="line">        if (y == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            outBuffer[y * width + x , 0 ] = buffer[(y + 1) * width + x , 0];</span><br><span class="line">            outBuffer[y * width + x , 1 ] = buffer[(y + 1) * width + x , 1];</span><br><span class="line">            outBuffer[y * width + x , 2 ] = buffer[(y + 1) * width + x , 2];</span><br><span class="line">        &#125;</span><br><span class="line">        // å°æ–¼æœ€ä¸‹é¢ä¸€è¡Œï¼Œè¨­ç½®èˆ‡ä¸Šä¸€è¡Œç›¸åŒ</span><br><span class="line">        else if (y == height - 1)</span><br><span class="line">        &#123;</span><br><span class="line">            outBuffer[y * width + x, 0 ] = buffer[(y - 1) * width + x, 0 ];</span><br><span class="line">            outBuffer[y * width + x, 1 ] = buffer[(y - 1) * width + x, 1 ];</span><br><span class="line">            outBuffer[y * width + x, 2 ] = buffer[(y - 1) * width + x, 2 ];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // å°æ–¼æœ€å·¦é‚Šä¸€åˆ—ï¼Œè¨­ç½®èˆ‡å³é‚Šç›¸åŒ</span><br><span class="line">        if (x == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            outBuffer[y * width + x, 0 ] = buffer[y * width + (x + 1), 0];</span><br><span class="line">            outBuffer[y * width + x, 1 ] = buffer[y * width + (x + 1), 1];</span><br><span class="line">            outBuffer[y * width + x, 2 ] = buffer[y * width + (x + 1), 2];</span><br><span class="line">        &#125;</span><br><span class="line">        // å°æ–¼æœ€å³é‚Šä¸€åˆ—ï¼Œè¨­ç½®èˆ‡å·¦é‚Šç›¸åŒ</span><br><span class="line">        else if (x == width - 1)</span><br><span class="line">        &#123;</span><br><span class="line">            outBuffer[y * width + x , 0] = buffer[y * width + (x - 1), 0];</span><br><span class="line">            outBuffer[y * width + x , 1] = buffer[y * width + (x - 1), 1];</span><br><span class="line">            outBuffer[y * width + x , 2] = buffer[y * width + (x - 1), 2];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = outBuffer[i, 0];</span><br><span class="line">    var green = outBuffer[i, 1];</span><br><span class="line">    var red = outBuffer[i, 2];</span><br><span class="line"></span><br><span class="line">    fOut.WriteByte(blue);</span><br><span class="line">    fOut.WriteByte(green);</span><br><span class="line">    fOut.WriteByte(red);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Console.WriteLine(&quot;Success!&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="Sepia-Filter-è€ç…§ç‰‡æ•ˆæœ"><a href="#Sepia-Filter-è€ç…§ç‰‡æ•ˆæœ" class="headerlink" title="Sepia Filter è€ç…§ç‰‡æ•ˆæœ"></a>Sepia Filter è€ç…§ç‰‡æ•ˆæœ</h2><p>é€™å€‹çœŸçš„è¶…ç¥å¥‡çš„, ä¸è¦å•ç‚ºä»€éº¼æœƒé€™æ¨£ XD</p>
<p>çœ‹ä»–èª²ç¨‹ä¹Ÿè·Ÿé€™è£¡çš„ç®—æ³•ä¸€æ¨£ <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1061093/how-is-a-sepia-tone-created">https://stackoverflow.com/questions/1061093/how-is-a-sepia-tone-created</a><br>ä¸æ›‰å¾—åˆ°åº•æ˜¯å•¥å¦–è¡“ ~</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">&#123;</span><br><span class="line">    var blue = fIn.ReadByte();</span><br><span class="line">    var green = fIn.ReadByte();</span><br><span class="line">    var red = fIn.ReadByte();</span><br><span class="line"></span><br><span class="line">    var sepiaRed = (red * .393) + (green * .769) + (blue * .189);</span><br><span class="line">    var sepiaGreen = (red * .349) + (green * .686) + (blue * .168);</span><br><span class="line">    var sepiaBlue = (red * .272) + (green * .534) + (blue * .131);</span><br><span class="line">    if (sepiaRed &gt;= 255) sepiaRed = 255;</span><br><span class="line">    if (sepiaGreen &gt;= 255) sepiaGreen = 255;</span><br><span class="line">    if (sepiaBlue &gt;= 255) sepiaBlue = 255;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fOut.WriteByte((byte)sepiaBlue);</span><br><span class="line">    fOut.WriteByte((byte)sepiaGreen);</span><br><span class="line">    fOut.WriteByte((byte)sepiaRed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Discrete-Convolution"><a href="#Discrete-Convolution" class="headerlink" title="Discrete Convolution"></a>Discrete Convolution</h2><p>é€™å€‹ example å¯¦åœ¨æœ‰é»å›°é›£, å°±ç®—ä¾é  ChatGPT å¹«å¿™ç¿»ä¸éä¹Ÿæ˜¯æ²’è¾¦æ³• 100% æ­£ç¢º, å¾Œä¾†ä¿®äº†ä¸‹</p>
<p>é€™è£¡è¦æ³¨æ„åˆ°çš„åœ¨ c è£¡é¢ <code>signed char</code> å°æ‡‰åˆ° c# æ‡‰è©²æ˜¯ <code>sbyte</code></p>
<p><code>(byte*)System.Runtime.InteropServices.Marshal.AllocHGlobal(size);</code> å‰‡å¯ä»¥ç”¨ä¾†ä»£æ›¿ <code>malloc</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">unsafe</span><br><span class="line">&#123;</span><br><span class="line">    //2D Discrete convolution</span><br><span class="line">    void Convolve(int imgRows, int imgCols, Mask myMask, byte* input_buf, byte* output_buf)</span><br><span class="line">    &#123;</span><br><span class="line">        long y, x, fy, fx, yIndex, xIndex;</span><br><span class="line">        int ms, im = 0, val;</span><br><span class="line">        byte* tmp;</span><br><span class="line"></span><br><span class="line">        //the outer summation loop</span><br><span class="line">        for (y = 0; y &lt; imgRows; ++y)</span><br><span class="line">            for (x = 0; x &lt; imgCols; ++x)</span><br><span class="line">            &#123;</span><br><span class="line">                val = 0;</span><br><span class="line">                for (fy = 0; fy &lt; myMask.Rows; ++fy)</span><br><span class="line">                    for (fx = 0; fx &lt; myMask.Cols; ++fx)</span><br><span class="line">                    &#123;</span><br><span class="line">                        ms = *(myMask.Data + fy * myMask.Rows + fx);</span><br><span class="line">                        yIndex = y - fy;</span><br><span class="line">                        xIndex = x - fx;</span><br><span class="line">                        if (yIndex &gt;= 0 &amp;&amp; xIndex &gt;= 0)</span><br><span class="line">                            im = *(input_buf + yIndex * imgRows + xIndex);</span><br><span class="line">                        val += ms * im;</span><br><span class="line">                    &#125;</span><br><span class="line">                if (val &gt; 255) val = 255;</span><br><span class="line">                if (val &lt; 0) val = 0;</span><br><span class="line">                tmp = output_buf + y * imgRows + x;</span><br><span class="line">                *tmp = (byte)val;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    void Convolve2(int imgRows, int imgCols, Mask myMask, byte[] inputBuf, byte[] outputBuf)</span><br><span class="line">    &#123;</span><br><span class="line">        int val;</span><br><span class="line">        int ms, im = 0;</span><br><span class="line">        int yIndex, xIndex;</span><br><span class="line"></span><br><span class="line">        // the outer summation loop</span><br><span class="line">        for (int y = 0; y &lt; imgRows; ++y)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int x = 0; x &lt; imgCols; ++x)</span><br><span class="line">            &#123;</span><br><span class="line">                val = 0;</span><br><span class="line"></span><br><span class="line">                // Iterate through the mask</span><br><span class="line">                for (int fy = 0; fy &lt; myMask.Rows; ++fy)</span><br><span class="line">                &#123;</span><br><span class="line">                    for (int fx = 0; fx &lt; myMask.Cols; ++fx)</span><br><span class="line">                    &#123;</span><br><span class="line">                        ms = *(myMask.Data + fy * myMask.Rows + fx);</span><br><span class="line"></span><br><span class="line">                        yIndex = y - fy;</span><br><span class="line">                        xIndex = x - fx;</span><br><span class="line"></span><br><span class="line">                        // Check if the indices are within bounds</span><br><span class="line">                        if (yIndex &gt;= 0 &amp;&amp; xIndex &gt;= 0)</span><br><span class="line">                        &#123;</span><br><span class="line">                            // Get the grayscale pixel value from the input buffer</span><br><span class="line">                            im = inputBuf[(yIndex * imgCols + xIndex)]; // For grayscale, it&#x27;s just one value</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        val += ms * im; // Apply the convolution operation</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // Clamp the result to be between 0 and 255</span><br><span class="line">                if (val &gt; 255) val = 255;</span><br><span class="line">                if (val &lt; 0) val = 0;</span><br><span class="line"></span><br><span class="line">                // Store the result back into the output buffer</span><br><span class="line">                outputBuf[y * imgCols + x] = (byte)val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">    void ImageWriter(string imgName, byte[] header, byte[] colorTable, byte[] buf, int bitDepth)</span><br><span class="line">    &#123;</span><br><span class="line">        using (FileStream fs = new FileStream(imgName, FileMode.Create, FileAccess.Write))</span><br><span class="line">        using (BinaryWriter writer = new BinaryWriter(fs))</span><br><span class="line">        &#123;</span><br><span class="line">            // Write the header</span><br><span class="line">            writer.Write(header, 0, 54);</span><br><span class="line"></span><br><span class="line">            // Write the color table if bit depth is &lt;= 8</span><br><span class="line">            if (bitDepth &lt;= 8)</span><br><span class="line">            &#123;</span><br><span class="line">                writer.Write(colorTable, 0, 1024);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Write the image buffer</span><br><span class="line">            writer.Write(buf, 0, buf.Length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    void ImageReader(string imgName, out int height, out int width, out int bitDepth,</span><br><span class="line">                     byte[] header, byte[] colorTable, byte[] buf)</span><br><span class="line">    &#123;</span><br><span class="line">        using (FileStream fs = new FileStream(imgName, FileMode.Open, FileAccess.Read))</span><br><span class="line">        using (BinaryReader reader = new BinaryReader(fs))</span><br><span class="line">        &#123;</span><br><span class="line">            // Read the header (54 bytes)</span><br><span class="line">            reader.Read(header, 0, 54);</span><br><span class="line"></span><br><span class="line">            // Read the width, height, and bit depth</span><br><span class="line">            width = BitConverter.ToInt32(header, 18);</span><br><span class="line">            height = BitConverter.ToInt32(header, 22);</span><br><span class="line">            bitDepth = BitConverter.ToInt16(header, 28);</span><br><span class="line"></span><br><span class="line">            // If the bit depth is &lt;= 8, read the color table</span><br><span class="line">            if (bitDepth &lt;= 8)</span><br><span class="line">            &#123;</span><br><span class="line">                reader.Read(colorTable, 0, 1024);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Read the image data</span><br><span class="line">            reader.Read(buf, 0, buf.Length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    byte* malloc(int size)</span><br><span class="line">    &#123;</span><br><span class="line">        return (byte*)System.Runtime.InteropServices.Marshal.AllocHGlobal(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const int BMP_HEADER_SIZE = 54;</span><br><span class="line">    const int BMP_COLOR_TABLE_SIZE = 1024;</span><br><span class="line">    const int CUSTOM_IMG_SIZE = 256 * 256;</span><br><span class="line"></span><br><span class="line">    int imgWidth, imgHeight, imgBitDepth;</span><br><span class="line">    byte[] imgHeader = new byte[BMP_HEADER_SIZE];</span><br><span class="line">    byte[] imgColorTable = new byte[BMP_COLOR_TABLE_SIZE];</span><br><span class="line">    byte[] imgBuffer = new byte[CUSTOM_IMG_SIZE];</span><br><span class="line">    byte[] imgBuffer2 = new byte[CUSTOM_IMG_SIZE];</span><br><span class="line"></span><br><span class="line">    string imgName = &quot;cameraman.bmp&quot;;</span><br><span class="line">    string newImgName = &quot;cameraman_new.bmp&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Mask lpMask;</span><br><span class="line">    lpMask.Rows = lpMask.Cols = 5;</span><br><span class="line"></span><br><span class="line">    // ä½¿ç”¨ unsafe æ“ä½œåˆ†é…å…§å­˜</span><br><span class="line">    lpMask.Data = (sbyte*)malloc(25);</span><br><span class="line"></span><br><span class="line">    // è¨­ç½®æ‰€æœ‰ mask çš„å€¼ç‚º -1</span><br><span class="line">    sbyte* tmp = lpMask.Data;</span><br><span class="line">    for (int i = 0; i &lt; 25; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        *tmp = (sbyte)-1; // å°‡æ¯å€‹å€¼è¨­ç½®ç‚º -1</span><br><span class="line">        ++tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¨­ç½®ä¸­é–“çš„å€¼ç‚º 24</span><br><span class="line">    tmp = lpMask.Data + 13;</span><br><span class="line">    *tmp = 24;</span><br><span class="line"></span><br><span class="line">    // è®€å–åœ–åƒ</span><br><span class="line">    ImageReader(imgName, out imgHeight, out imgWidth, out imgBitDepth, imgHeader, imgColorTable, imgBuffer);</span><br><span class="line"></span><br><span class="line">    // é€²è¡Œå·ç©æ“ä½œ</span><br><span class="line">    fixed (byte* ptrImgBuffer = imgBuffer,  ptrImgBuffer2 = imgBuffer2)</span><br><span class="line">        Convolve(imgHeight, imgWidth, lpMask, ptrImgBuffer, ptrImgBuffer2);</span><br><span class="line"></span><br><span class="line">	//æˆ–ç”¨é€™å€‹å‡½æ•¸</span><br><span class="line">	//Convolve2(imgHeight, imgWidth, lpMask, imgBuffer, imgBuffer2);</span><br><span class="line"></span><br><span class="line">    // è¼¸å‡ºåœ–åƒ</span><br><span class="line">    ImageWriter(newImgName, imgHeader, imgColorTable, imgBuffer2, imgBitDepth);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(&quot;Success!&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public unsafe struct Mask</span><br><span class="line">&#123;</span><br><span class="line">    public int Rows;</span><br><span class="line">    public int Cols;</span><br><span class="line">    public sbyte* Data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é‚Šç·£äººæª¢æ¸¬-Detecting-Lines-with-a-Line-Detector"><a href="#é‚Šç·£äººæª¢æ¸¬-Detecting-Lines-with-a-Line-Detector" class="headerlink" title="é‚Šç·£äººæª¢æ¸¬ Detecting Lines with a Line Detector"></a>é‚Šç·£äººæª¢æ¸¬ Detecting Lines with a Line Detector</h2><p>ä»–é€™è£¡åŸç‰ˆç”¨ <code>LineDetector</code> å¯«èµ·ä¾†æ¯”è¼ƒå™å¿ƒ, è¦å°‡ 1d æŒ‡æ¨™ç®—æˆ 2d<br>æˆ‘è‡ªå·±å‰‡æ˜¯å¯«å€‹ <code>byteArrayTo2D</code> å…ˆæŠŠ <code>byte*</code> è½‰ç‚º <code>byte[,]</code><br>ç„¶å¾Œç”¨ <code>LineDetector2D</code> å»æª¢æ¸¬é‚Šç·£æ¯”è¼ƒè¼•é¬†<br>ä¸éé€™è£¡æœ‰å€‹è©­ç•°çš„é», ä»–çš„æ¢ä»¶è¦ç”¨ <code>y &lt; imgRows - 1 x &lt; imgCols</code> æ‰æœƒæ­£ç¢º, ä¸ç„¶ array æœƒè¶Šç•Œ<br>ä¸å¤ªæ›‰å¾—ç‚ºå•¥è·ŸæŒ‡æ¨™çš„æ¢ä»¶ä¸å¤ªä¸€æ¨£, é€™ç¨®å¤ªç´°çš„é‚è¼¯æœ€é›£ debug<br>æœ€å¾Œæ„å¤–ç™¼ç¾åŸä¾† <code>byte[,]</code> å¥½åƒå¯ä»¥ç›´æ¥è½‰ç‚º <code>pointer</code> ä¸ç”¨å¤šè™•ç†ä¸€æ‰‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">int BMP_HEADER_SIZE = 54;</span><br><span class="line">int BMP_COLOR_TABLE_SIZE = 1024;</span><br><span class="line">int CUSTOM_IMG_SIZE = 512 * 512;</span><br><span class="line"></span><br><span class="line">unsafe</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    void ImageWriter(string imgName, byte* header, byte* colorTable, byte* buf, int bitDepth)</span><br><span class="line">    &#123;</span><br><span class="line">        // æ‰“é–‹æ–‡ä»¶ä»¥å¯«å…¥</span><br><span class="line">        using (FileStream fs = new FileStream(imgName, FileMode.Create, FileAccess.Write))</span><br><span class="line">        &#123;</span><br><span class="line">            using (BinaryWriter writer = new BinaryWriter(fs))</span><br><span class="line">            &#123;</span><br><span class="line">                // å¯«å…¥ header</span><br><span class="line">                for (int i = 0; i &lt; BMP_HEADER_SIZE; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    writer.Write(*(header + i));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // å¦‚æœä½æ·±åº¦ &lt;= 8ï¼Œå‰‡å¯«å…¥é¡è‰²è¡¨</span><br><span class="line">                if (bitDepth &lt;= 8)</span><br><span class="line">                &#123;</span><br><span class="line">                    for (int i = 0; i &lt; BMP_COLOR_TABLE_SIZE; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        writer.Write(*(colorTable + i));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // å¯«å…¥åœ–åƒæ•¸æ“š</span><br><span class="line">                for (int i = 0; i &lt; CUSTOM_IMG_SIZE; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    writer.Write(*(buf + i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void ImageReader(string imgName, int* height, int* width, int* bitDepth,</span><br><span class="line">                     byte[] header, byte[] colorTable, byte[] buf)</span><br><span class="line">    &#123;</span><br><span class="line">        using (FileStream fs = new FileStream(imgName, FileMode.Open, FileAccess.Read))</span><br><span class="line">        using (BinaryReader reader = new BinaryReader(fs))</span><br><span class="line">        &#123;</span><br><span class="line">            // Read the header (54 bytes)</span><br><span class="line">            reader.Read(header, 0, 54);</span><br><span class="line"></span><br><span class="line">            // Read the width, height, and bit depth</span><br><span class="line">            *width = BitConverter.ToInt32(header, 18);</span><br><span class="line">            *height = BitConverter.ToInt32(header, 22);</span><br><span class="line">            *bitDepth = BitConverter.ToInt16(header, 28);</span><br><span class="line"></span><br><span class="line">            // If the bit depth is &lt;= 8, read the color table</span><br><span class="line">            if (*bitDepth &lt;= 8)</span><br><span class="line">            &#123;</span><br><span class="line">                reader.Read(colorTable, 0, 1024);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Read the image data</span><br><span class="line">            reader.Read(buf, 0, buf.Length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void LineDetector(byte* _inputImgData, byte* _outputImgData,</span><br><span class="line">                          int imgCols, int imgRows, int[,] MASK)</span><br><span class="line">    &#123;</span><br><span class="line">        int x, y, i, j, sum;</span><br><span class="line"></span><br><span class="line">        for (y = 1; y &lt;= imgRows - 1; y++)</span><br><span class="line">        &#123;</span><br><span class="line">            for (x = 1; x &lt;= imgCols - 1; x++)</span><br><span class="line">            &#123;</span><br><span class="line">                sum = 0;</span><br><span class="line">                for (i = -1; i &lt;= 1; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    for (j = -1; j &lt;= 1; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //é€™è¡¨ç¤ºåœ–ç‰‡ç›®å‰çš„ pixel</span><br><span class="line">                        //*(_inputImgData + x + i + (long)(y + j) * imgCols)</span><br><span class="line"></span><br><span class="line">                        //ç›®å‰ç§»å‹•åˆ° mask çš„æ ¼å­</span><br><span class="line">                        //MASK[i + 1, j + 1]</span><br><span class="line">                        sum = sum + *(_inputImgData + x + i + (long)(y + j) * imgCols) * MASK[i + 1, j + 1];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (sum &gt; 255)</span><br><span class="line">                    sum = 255;</span><br><span class="line">                if (sum &lt; 0)</span><br><span class="line">                    sum = 0;</span><br><span class="line">                *(_outputImgData + x + (long)y * imgCols) = (byte)sum;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    void LineDetector2D(byte[,] _inputImgData, byte[,] _outputImgData,</span><br><span class="line">                      int imgCols, int imgRows, int[,] MASK)</span><br><span class="line">    &#123;</span><br><span class="line">        int x, y, i, j, sum;</span><br><span class="line"></span><br><span class="line">        for (y = 1; y &lt; imgRows - 1; y++)</span><br><span class="line">        &#123;</span><br><span class="line">            for (x = 1; x &lt; imgCols - 1; x++)</span><br><span class="line">            &#123;</span><br><span class="line">                sum = 0;</span><br><span class="line">                for (i = -1; i &lt;= 1; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    for (j = -1; j &lt;= 1; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        // é€™æ˜¯åœ–åƒç›®å‰çš„åƒç´ ï¼Œæ”¹ç‚ºç›´æ¥ä½¿ç”¨äºŒç¶­é™£åˆ—</span><br><span class="line">                        sum = sum + _inputImgData[y + i, x + j] * MASK[i + 1, j + 1];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // ç¢ºä¿åƒç´ å€¼åœ¨ [0, 255] ç¯„åœå…§</span><br><span class="line">                if (sum &gt; 255)</span><br><span class="line">                    sum = 255;</span><br><span class="line">                if (sum &lt; 0)</span><br><span class="line">                    sum = 0;</span><br><span class="line"></span><br><span class="line">                // å°‡çµæœå„²å­˜å›è¼¸å‡ºåœ–åƒ</span><br><span class="line">                _outputImgData[y, x] = (byte)sum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    void byteArrayTo2D(byte* buffer, byte[,] outBuffer)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int y = 0; y &lt; 512; y++)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int x = 0; x &lt; 512; x++)</span><br><span class="line">            &#123;</span><br><span class="line">                outBuffer[y, x] = buffer[y * 512 + x];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    int imgWidth;</span><br><span class="line">    int imgHeight;</span><br><span class="line">    int imgBitDepth;</span><br><span class="line">    byte[] imgHeader = new byte[BMP_HEADER_SIZE];</span><br><span class="line">    byte[] imgColorTable = new byte[BMP_COLOR_TABLE_SIZE];</span><br><span class="line">    byte[] imgBuffer = new byte[CUSTOM_IMG_SIZE];</span><br><span class="line">    byte[] imgBuffer2 = new byte[CUSTOM_IMG_SIZE];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    byte[,] imgBufferTwoD = new byte[512, 512];</span><br><span class="line">    byte[,] imgBuffer2TwoD = new byte[512, 512];</span><br><span class="line"></span><br><span class="line">    string imgName = &quot;lena512.bmp&quot;;</span><br><span class="line">    string newImgName = &quot;lena_rdia_2d.bmp&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    int[,] VER = &#123;</span><br><span class="line">        &#123; -1,2,-1&#125;,</span><br><span class="line">        &#123; -1,2,-1&#125;,</span><br><span class="line">        &#123; -1,2,-1&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    int[,] HOR = &#123;</span><br><span class="line">        &#123; -1,-1,-1&#125;,</span><br><span class="line">        &#123; 2,2,2&#125;,</span><br><span class="line">        &#123; -1,-1,-1&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    int[,] LDIA = &#123;</span><br><span class="line">        &#123; 2,-1,-1&#125;,</span><br><span class="line">        &#123; -1,2,-1&#125;,</span><br><span class="line">        &#123; -1,-1,2&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    int[,] RDIA = &#123;</span><br><span class="line">        &#123; -1,-1,2&#125;,</span><br><span class="line">        &#123; -1,2,-1&#125;,</span><br><span class="line">        &#123; 2,-1,-1&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ImageReader(imgName, &amp;imgHeight, &amp;imgWidth, &amp;imgBitDepth, imgHeader, imgColorTable, imgBuffer);</span><br><span class="line">    fixed (byte* ptrImgBuffer = &amp;imgBuffer[0])</span><br><span class="line">        byteArrayTo2D(ptrImgBuffer, imgBufferTwoD);</span><br><span class="line"></span><br><span class="line">    LineDetector2D(imgBufferTwoD, imgBuffer2TwoD, imgWidth, imgHeight, RDIA);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //fixed (byte* ptrImgBuffer = &amp;imgBuffer[0], ptrImgBuffer2 = &amp;imgBuffer2[0])</span><br><span class="line">    //    LineDetector(ptrImgBuffer, ptrImgBuffer2, imgWidth, imgHeight, RDIA);</span><br><span class="line"></span><br><span class="line">    fixed (byte* ptrImgHeader = imgHeader, ptrImgColorTable = imgColorTable, ptrImgBuffer2 = imgBuffer2TwoD)</span><br><span class="line">        ImageWriter(newImgName, ptrImgHeader, ptrImgColorTable, ptrImgBuffer2, imgBitDepth);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(&quot;Success!\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åŠ é¹½"><a href="#åŠ é¹½" class="headerlink" title="åŠ é¹½"></a>åŠ é¹½</h2><p>é€™è£¡å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ä¾†åŠ æ–™<br>é€™è£¡ä»–ä¸€æ¨£ç”¨ <code>*(inputImgData + x + (long)y * imgCols)</code> è®€èµ·ä¾†æ¯”è¼ƒå™å¿ƒ</p>
<p>å‡å¦‚ width &#x3D; 5, height &#x3D; 2</p>
<p>0 1 2 3 4<br>5 6* 7 8 9</p>
<p>å¦‚æœ 6 æ˜¯ç›®å‰é¸åˆ°çš„æ ¼å­å°±çœ‹å¾—å¾ˆæ¸…æ¥š, å› ç‚ºä»–æœ€å¾Œè¦è¢«æ‹†æˆ 1d</p>
<p>0 1 2 3 4 5 6* 7 8 9</p>
<p>5 + 2 &#x3D; 7</p>
<p>ç´¢å¼•ç”± 0 é–‹å§‹, å¿…é ˆæ¸›ä¸€æ‰€ä»¥å¾—åˆ° 6 é€™å€‹ç´¢å¼•ä½ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">void SaltPepper(byte* inputImgData, int imgCols, int imgRows, float prob)</span><br><span class="line">&#123;</span><br><span class="line">	int x, y, data, data1, data2;</span><br><span class="line">	data = (int)(prob * 32768 / 2);</span><br><span class="line">	data1 = data + 16384;</span><br><span class="line">	data2 = 16384 - data;</span><br><span class="line"></span><br><span class="line">	Random rnd = new Random();</span><br><span class="line"></span><br><span class="line">	for (y = 0; y &lt; imgRows; y++)</span><br><span class="line">	&#123;</span><br><span class="line">		for (x = 0; x &lt; imgCols; x++)</span><br><span class="line">		&#123;</span><br><span class="line">			data = rnd.Next(0, 32768);</span><br><span class="line">			if (data &gt;= 16384 &amp;&amp; data &lt; data1)</span><br><span class="line">				*(inputImgData + x + (long)y * imgCols) = 0;</span><br><span class="line">			if (data &gt;= data2 &amp;&amp; data &lt; 16384)</span><br><span class="line">				*(inputImgData + x + (long)y * imgCols) = 255;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SaltPepper2D(byte[,] inputImgData, int imgCols, int imgRows, float prob)</span><br><span class="line">&#123;</span><br><span class="line">	int x, y, data, data1, data2;</span><br><span class="line">	data = (int)(prob * 32768 / 2);</span><br><span class="line">	data1 = data + 16384;</span><br><span class="line">	data2 = 16384 - data;</span><br><span class="line"></span><br><span class="line">	Random rnd = new Random();</span><br><span class="line"></span><br><span class="line">	for (y = 0; y &lt; imgRows; y++)</span><br><span class="line">	&#123;</span><br><span class="line">		for (x = 0; x &lt; imgCols; x++)</span><br><span class="line">		&#123;</span><br><span class="line">			data = rnd.Next(0, 32768);</span><br><span class="line">			if (data &gt;= 16384 &amp;&amp; data &lt; data1)</span><br><span class="line">				inputImgData[y, x] = 0;</span><br><span class="line">				//*(inputImgData + x + (long)y * imgCols) = 0;</span><br><span class="line"></span><br><span class="line">			if (data &gt;= data2 &amp;&amp; data &lt; 16384) </span><br><span class="line">				inputImgData[y, x] = 255;</span><br><span class="line">				//*(inputImgData + x + (long)y * imgCols) = 255;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="High-Pass-Filter"><a href="#High-Pass-Filter" class="headerlink" title="High Pass Filter"></a>High Pass Filter</h2><p>é€™è£¡æ¯”è¼ƒç°¡å–®, ä¸€æ¨£å°±æ˜¯è·‘å€‹å·ç©å°±æå®šäº†, code å°±ä¸åˆ—æƒ¹</p>
<p>-1 -1 -1<br>-1 9 -1<br>-1 -1 -1</p>
<h2 id="é«˜æ–¯é›œè¨Š"><a href="#é«˜æ–¯é›œè¨Š" class="headerlink" title="é«˜æ–¯é›œè¨Š"></a>é«˜æ–¯é›œè¨Š</h2><p>å¸Œæœ›æ²’å¯«éŒ¯ LOL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">void Gussian(byte* _inputImgData, int imgCols, int imgRows, float var, float mean)</span><br><span class="line">&#123;</span><br><span class="line">	int x, y;</span><br><span class="line">	double noise, theta;</span><br><span class="line">	Random rnd = new Random();</span><br><span class="line">	for (y = 0; y &lt; imgRows; y++)</span><br><span class="line">	&#123;</span><br><span class="line">		for (x = 0; x &lt; imgCols; x++)</span><br><span class="line">		&#123;</span><br><span class="line">			noise = Math.Sqrt(-2 * var * Math.Log(1.0 - rnd.Next(0, 32767) / 32767.1));</span><br><span class="line">			theta = rnd.Next(0, 32767) * 1.9175345e-4 - Math.PI;</span><br><span class="line">			noise = noise * Math.Cos(theta);</span><br><span class="line">			noise = noise + mean;</span><br><span class="line">			if (noise &gt; 255) noise = 255;</span><br><span class="line">			if (noise &lt; 0) noise = 0;</span><br><span class="line">			*(_inputImgData + x + (long)y * imgCols) = (byte)(noise + 0.5);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="js-ç‰ˆæœ¬"><a href="#js-ç‰ˆæœ¬" class="headerlink" title="js ç‰ˆæœ¬"></a>js ç‰ˆæœ¬</h2><p>js çš„è©±è¦æ³¨æ„å½±åƒæ˜¯ç”± rgb ç‚ºé †åº, å¦å¤–ä»–å¥½åƒéƒ½æœƒæœ‰ alpha é€æ˜åº¦é€šé“</p>
<p>æé€™å€‹é‚„è¦è¨˜é †åºæ•´å€‹è©­ç•° LOL</p>
<p>é‚„æœ‰ä»– img canva ç­‰æ¯”ä¾‹ç¸®æ”¾ä¹Ÿæ¯”è¼ƒé›£å¯«</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘å¯¦ä½œéƒ¨åˆ†çš„ç¶²å€ <a target="_blank" rel="noopener" href="https://codepen.io/weber87na/pen/OJKqXXL">https://codepen.io/weber87na/pen/OJKqXXL</a></p>
<h2 id="RIP-é¢¨æ ¼çš„-asp-net-core-middleware"><a href="#RIP-é¢¨æ ¼çš„-asp-net-core-middleware" class="headerlink" title="RIP é¢¨æ ¼çš„ asp.net core middleware"></a>RIP é¢¨æ ¼çš„ asp.net core middleware</h2><p>æé€™ä¹Ÿæ˜¯ææ»¿ä¹…çš„, æœ¬ä¾†ä»¥ç‚ºç›´æ¥ä¿®æ”¹ Response å°±å¥½äº†, æ²’æƒ³åˆ°é‚„è¦å…ˆ <code>new MemoryStream</code><br>é€™è£¡å¦‚æœè¦ç¦æ­¢ Cache å¯ä»¥åŠ ä¸Š</p>
<p><code>context.Context.Response.Headers.Add(&quot;Cache-Control&quot;, &quot;no-cache, no-store&quot;);</code></p>
<p><code>context.Context.Response.Headers.Add(&quot;Expires&quot;, &quot;-1&quot;);</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">app.UseStaticFiles(new StaticFileOptions</span><br><span class="line">&#123;</span><br><span class="line">    OnPrepareResponseAsync = async context =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        context.Context.Response.Headers.Add(&quot;Cache-Control&quot;, &quot;no-cache, no-store&quot;);</span><br><span class="line">        context.Context.Response.Headers.Add(&quot;Expires&quot;, &quot;-1&quot;);</span><br><span class="line">	</span><br><span class="line">        if (context.File.Name.EndsWith(&quot;.bmp&quot;, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            await BmpToGrayAsync(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async Task BmpToGrayAsync(StaticFileResponseContext context)</span><br><span class="line">&#123;</span><br><span class="line">    var filePath = context.File.PhysicalPath;</span><br><span class="line">    byte[] imgData = await File.ReadAllBytesAsync(filePath);</span><br><span class="line"></span><br><span class="line">    using (var bmpStream = new MemoryStream(imgData))</span><br><span class="line">    &#123;</span><br><span class="line">        //read header</span><br><span class="line">        byte[] imgHeader = new byte[54];</span><br><span class="line">        await bmpStream.ReadAsync(imgHeader, 0, imgHeader.Length);</span><br><span class="line"></span><br><span class="line">        int height = BitConverter.ToInt32(imgHeader, 22);</span><br><span class="line">        int width = BitConverter.ToInt32(imgHeader, 18);</span><br><span class="line">        int bitDepth = BitConverter.ToInt16(imgHeader, 28);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine($&quot;height: &#123;height&#125;&quot;);</span><br><span class="line">        Console.WriteLine($&quot;width: &#123;width&#125;&quot;);</span><br><span class="line">        Console.WriteLine($&quot;bitDepth: &#123;bitDepth&#125;&quot;);</span><br><span class="line"></span><br><span class="line">        //read color table</span><br><span class="line">        byte[] colorTable = new byte[1024];</span><br><span class="line">        if (bitDepth &lt;= 8)</span><br><span class="line">        &#123;</span><br><span class="line">            await bmpStream.ReadAsync(colorTable, 0, colorTable.Length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //åœ–ç‰‡å¤§å°</span><br><span class="line">        int imgSize = height * width;</span><br><span class="line">        using (var output = new MemoryStream())</span><br><span class="line">        &#123;</span><br><span class="line">            //write header</span><br><span class="line">            await output.WriteAsync(imgHeader, 0, imgHeader.Length);</span><br><span class="line">            if (bitDepth &lt;= 8)</span><br><span class="line">            &#123;</span><br><span class="line">                await output.WriteAsync(colorTable, 0, colorTable.Length);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                var blue = (byte)bmpStream.ReadByte(); </span><br><span class="line">                var green = (byte)bmpStream.ReadByte();</span><br><span class="line">                var red = (byte)bmpStream.ReadByte();</span><br><span class="line"></span><br><span class="line">                // ä½¿ç”¨ç°éšå…¬å¼ï¼šR * 0.299 + G * 0.587 + B * 0.114</span><br><span class="line">                int gray = (int)(red * 0.299 + green * 0.587 + blue * 0.114);</span><br><span class="line">                output.WriteByte((byte)gray);</span><br><span class="line">                output.WriteByte((byte)gray);</span><br><span class="line">                output.WriteByte((byte)gray);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //è¨­å®š</span><br><span class="line">            context.Context.Response.ContentType = &quot;image/bmp&quot;;</span><br><span class="line">            output.Seek(0, SeekOrigin.Begin);</span><br><span class="line">            await output.CopyToAsync(context.Context.Response.Body);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç²—ç³™çš„é¦¬è³½å…‹"><a href="#ç²—ç³™çš„é¦¬è³½å…‹" class="headerlink" title="ç²—ç³™çš„é¦¬è³½å…‹"></a>ç²—ç³™çš„é¦¬è³½å…‹</h2><p>é€™è£¡ c# å°±æ‡¶å¾—å¯«äº†, ä¸éæœ‰ js<br>å‡è¨­é¦¬è³½å…‹ç¯„åœæ˜¯ 3 * 3<br>ä»–åŸç†å°±æ˜¯æ‹¿ 3 * 3 çš„å·¦ä¸Šè§’ç•¶é»ä½<br>é™¤äº† loop åœ–ç‰‡çš„è¿´åœˆ, å†è·‘ä¸€å€‹å·¢ç‹€è¿´åœˆ, ä¸¦ä¸”è®“é€™ 9 æ ¼å…§è¨­å®šç‚ºå·¦ä¸Šè§’çš„é»å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fIn = fopen(&quot;images/lena_color.bmp&quot;, &quot;rb&quot;);</span><br><span class="line">    FILE *fOut = fopen(&quot;images/lena_mosaic.bmp&quot;, &quot;wb&quot;);</span><br><span class="line"></span><br><span class="line">    unsigned char imgHeader[54];</span><br><span class="line">    unsigned char colorTable[1024];</span><br><span class="line"></span><br><span class="line">    if (fIn == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;Unable to open image\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 54; i++)</span><br><span class="line">        imgHeader[i] = getc(fIn);</span><br><span class="line"></span><br><span class="line">    fwrite(imgHeader, sizeof(unsigned char), 54, fOut);</span><br><span class="line"></span><br><span class="line">    int height = *(int *)&amp;imgHeader[22];</span><br><span class="line">    int width = *(int *)&amp;imgHeader[18];</span><br><span class="line">    int bitDepth = *(int *)&amp;imgHeader[28];</span><br><span class="line"></span><br><span class="line">    if (bitDepth &lt;= 8)</span><br><span class="line">    &#123;</span><br><span class="line">        fread(colorTable, sizeof(unsigned char), 1024, fIn);</span><br><span class="line">        fwrite(colorTable, sizeof(unsigned char), 1024, fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int imgSize = height * width;</span><br><span class="line">    unsigned char buffer[imgSize][3];</span><br><span class="line">    int mosaicSize = 5;</span><br><span class="line"></span><br><span class="line">    // è¤‡è£½åœ–ç‰‡ pixel åˆ°æœ€å¾Œè¦ out çš„ buffer</span><br><span class="line">    for (int y = 0; y &lt; height; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int x = 0; x &lt; width; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            int current = x + y * width;</span><br><span class="line">            buffer[current][0] = getc(fIn);</span><br><span class="line">            buffer[current][1] = getc(fIn);</span><br><span class="line">            buffer[current][2] = getc(fIn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //loop pixel æ­¥é€²å€¼ç”¨ 3 * 3 å¤§å°</span><br><span class="line">    for (int y = 0; y &lt; height; y += mosaicSize)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int x = 0; x &lt; width; x += mosaicSize)</span><br><span class="line">        &#123;</span><br><span class="line">            //å–å¾—ç›®å‰ pixel</span><br><span class="line">            int current = x + y * width;</span><br><span class="line">            int blue = buffer[current][0];</span><br><span class="line">            int green = buffer[current][1];</span><br><span class="line">            int red = buffer[current][2];</span><br><span class="line"></span><br><span class="line">            //è·‘ä¸€å€‹ 3 * 3 å¤§å°çš„é¦¬è³½å…‹</span><br><span class="line">            //æŠŠç›®å‰çš„è¨­å®šé€™ 3 * 3 éƒ½æ˜¯ç”¨ç›®å‰é€™å€‹ pixel</span><br><span class="line">            for (int my = 0; my &lt; mosaicSize &amp;&amp; (y + my) &lt; height; my++)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int mx = 0; mx &lt; mosaicSize &amp;&amp; (x + mx) &lt; width; mx++)</span><br><span class="line">                &#123;</span><br><span class="line">                    int current = (y + my) * width + (x + mx);</span><br><span class="line">                    buffer[current][0] = blue;</span><br><span class="line">                    buffer[current][1] = green;</span><br><span class="line">                    buffer[current][2] = red;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¼¸å‡ºæœ€çµ‚ buffer</span><br><span class="line">    for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        putc(buffer[i][0], fOut);</span><br><span class="line">        putc(buffer[i][1], fOut);</span><br><span class="line">        putc(buffer[i][2], fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;Success!\n&quot;);</span><br><span class="line">    fclose(fIn);</span><br><span class="line">    fclose(fOut);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¹³æ»‘é¦¬è³½å…‹"><a href="#å¹³æ»‘é¦¬è³½å…‹" class="headerlink" title="å¹³æ»‘é¦¬è³½å…‹"></a>å¹³æ»‘é¦¬è³½å…‹</h2><p>å¹³æ»‘çš„è©±éœ€è¦å…ˆå° 3 * 3 çš„é¦¬è³½å…‹è‰²æ ¼å­å½©è¨ˆç®—å¹³å‡å€¼<br>æ¥è‘—è·Ÿç²—æš´ç‰ˆæœ¬çš„ä¸€æ¨£, æŠŠå¹³å‡å€¼çµ¦ 3 * 3 å…§çš„æ¯å€‹ pixel å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fIn = fopen(&quot;images/lena_color.bmp&quot;, &quot;rb&quot;);</span><br><span class="line">    FILE *fOut = fopen(&quot;images/lena_mosaic_smooth.bmp&quot;, &quot;wb&quot;);</span><br><span class="line"></span><br><span class="line">    unsigned char imgHeader[54];</span><br><span class="line">    unsigned char colorTable[1024];</span><br><span class="line"></span><br><span class="line">    if (fIn == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;Unable to open image\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 54; i++)</span><br><span class="line">        imgHeader[i] = getc(fIn);</span><br><span class="line"></span><br><span class="line">    fwrite(imgHeader, sizeof(unsigned char), 54, fOut);</span><br><span class="line"></span><br><span class="line">    int height = *(int *)&amp;imgHeader[22];</span><br><span class="line">    int width = *(int *)&amp;imgHeader[18];</span><br><span class="line">    int bitDepth = *(int *)&amp;imgHeader[28];</span><br><span class="line"></span><br><span class="line">    if (bitDepth &lt;= 8)</span><br><span class="line">    &#123;</span><br><span class="line">        fread(colorTable, sizeof(unsigned char), 1024, fIn);</span><br><span class="line">        fwrite(colorTable, sizeof(unsigned char), 1024, fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int imgSize = height * width;</span><br><span class="line">    unsigned char buffer[imgSize][3];</span><br><span class="line">    int mosaicSize = 10;</span><br><span class="line"></span><br><span class="line">    // è¤‡è£½åœ–ç‰‡ pixel åˆ°æœ€å¾Œè¦ out çš„ buffer</span><br><span class="line">    for (int y = 0; y &lt; height; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int x = 0; x &lt; width; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            int current = x + y * width;</span><br><span class="line">            buffer[current][0] = getc(fIn);</span><br><span class="line">            buffer[current][1] = getc(fIn);</span><br><span class="line">            buffer[current][2] = getc(fIn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // loop pixel æ­¥é€²å€¼ç”¨ 3 * 3 å¤§å°</span><br><span class="line">    for (int y = 0; y &lt; height; y += mosaicSize)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int x = 0; x &lt; width; x += mosaicSize)</span><br><span class="line">        &#123;</span><br><span class="line">            int sumBlue = 0;</span><br><span class="line">            int sumGreen = 0;</span><br><span class="line">            int sumRed = 0;</span><br><span class="line">            int count = 0;</span><br><span class="line"></span><br><span class="line">            for (int my = 0; my &lt; mosaicSize &amp;&amp; (y + my) &lt; height; my++)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int mx = 0; mx &lt; mosaicSize &amp;&amp; (x + mx) &lt; width; mx++)</span><br><span class="line">                &#123;</span><br><span class="line">                    int current = (y + my) * width + (x + mx);</span><br><span class="line">                    sumBlue += buffer[current][0];</span><br><span class="line">                    sumGreen += buffer[current][1];</span><br><span class="line">                    sumRed += buffer[current][2];</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            int avgBlue = sumBlue / count;</span><br><span class="line">            int avgGreen = sumGreen / count;</span><br><span class="line">            int avgRed = sumRed / count;</span><br><span class="line"></span><br><span class="line">            // è·‘ä¸€å€‹ 3 * 3 å¤§å°çš„é¦¬è³½å…‹</span><br><span class="line">            // æŠŠç›®å‰çš„è¨­å®šé€™ 3 * 3 éƒ½æ˜¯ç”¨ç›®å‰é€™å€‹ pixel</span><br><span class="line">            for (int my = 0; my &lt; mosaicSize &amp;&amp; (y + my) &lt; height; my++)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int mx = 0; mx &lt; mosaicSize &amp;&amp; (x + mx) &lt; width; mx++)</span><br><span class="line">                &#123;</span><br><span class="line">                    int current = (y + my) * width + (x + mx);</span><br><span class="line">                    buffer[current][0] = avgBlue;</span><br><span class="line">                    buffer[current][1] = avgGreen;</span><br><span class="line">                    buffer[current][2] = avgRed;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¼¸å‡ºæœ€çµ‚ buffer</span><br><span class="line">    for (int i = 0; i &lt; imgSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        putc(buffer[i][0], fOut);</span><br><span class="line">        putc(buffer[i][1], fOut);</span><br><span class="line">        putc(buffer[i][2], fOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;Success!\n&quot;);</span><br><span class="line">    fclose(fIn);</span><br><span class="line">    fclose(fOut);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ascii-Art-js"><a href="#Ascii-Art-js" class="headerlink" title="Ascii Art js"></a>Ascii Art js</h2><p>è¨˜å¾—å¾ˆå¤šå¹´å‰ç¨å¾®ç©éç·šä¸Š AsciiArt ç”¢ç”Ÿå™¨è¦ºå¾—å¾ˆæœ‰æ„æ€, ä¸éä¹Ÿä¸æ›‰å¾—æ€éº¼åšçš„, ä»Šå¤©å°±é †ä¾¿å¯«çœ‹çœ‹<br>åƒè€ƒé€™ç¯‡</p>
<p>ä»–åŸç†å°±æ˜¯æŠŠåœ–ç‰‡ç°éšåŒ–, ç„¶å¾Œç”¨ä¸€å€‹ array å®šç¾©è‹¥å¹²æ•¸é‡çš„å­—ç¬¦<br>ä»–é€™é‚Šç”¨é€™æ¨£, æˆ‘è‡ªå·±å®šç¾©å…¶ä»–ç¬¦è™Ÿ, ä¸éæ•ˆæœä¸å¤ªå¥½<br>$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft&#x2F;\|()1{}[]?-_+~&lt;&gt;i!lI;:,&quot;^â€˜. &#96;</p>
<p>å› ç‚ºç°éšæ˜¯ <code>0 ~ 255</code> æ‰€ä»¥é€™è£¡ç”¨ <code>ceil(ç°è‰² / 10)</code> ç®—å‡ºå­—ç¬¦ç´¢å¼•ä½ç½®å³å¯<br>ç„¶å¾Œè®“å–å¾—çš„å­—ç¬¦ç˜‹ç‹‚ç›¸åŠ , æœ€å¾Œå°±å¾—åˆ°çµæœ</p>
<p>é€™è£¡ css çš„å­—è¦è¨­å®š <code>1px</code> ä¸ç„¶ç•«é¢æœƒèµ°é˜</p>
<p>å¦‚æœæƒ³è¦å½©è‰²çš„è©±è·Ÿç°éšçš„å¯«æ³•å·®ä¸å¤š, ä¸éè¦æŠŠ return çš„å­—è®Šæˆ span ä¸¦è¨­å®šé¡è‰², è©³ç´°å¯ä»¥çœ‹ code<br>å–å¾—çµæœä»¥å¾Œ, å‰‡æ˜¯è¦è¨­å®šå…ƒç´ çš„ <code>innerHtml</code> è€Œéç°éšçš„ <code>innerText</code></p>
<p><a target="_blank" rel="noopener" href="https://codepen.io/weber87na/full/OJKqXXL">https://codepen.io/weber87na/full/OJKqXXL</a></p>
<h2 id="æ°´å¹³-å‚ç›´ç¿»è½‰-js"><a href="#æ°´å¹³-å‚ç›´ç¿»è½‰-js" class="headerlink" title="æ°´å¹³ å‚ç›´ç¿»è½‰ js"></a>æ°´å¹³ å‚ç›´ç¿»è½‰ js</h2><p>é€™è£¡ä¹Ÿæ˜¯æ‡¶å¾—æ c# äº†, åœ¨ js ä¸Šæ°´å¹³ç¿»è½‰çš„è©±éœ€è¦å…ˆå¾—åˆ° beginIndex åŠ endIndex<br>ç„¶å¾ŒæŠŠ copiedPixels[beginIndex] çš„ RGB è¨­å®šç‚º pixels[endIndex] çš„ RGB å°±æå®šäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//èµ·å§‹</span><br><span class="line">let beginIndex = (y * imageData.width + x) * 4;</span><br><span class="line"></span><br><span class="line">//çµæŸ</span><br><span class="line">let endIndex = (y * imageData.width + imageData.width - x) * 4;</span><br></pre></td></tr></table></figure>

<p>å‚ç›´ç¿»è½‰çš„è©±ä¹Ÿå·®ä¸å¤š, åªæ˜¯ <code>endIndex</code> ç®—æ³•ä¸åŒ, é—œéµç‚º <code>imageData.height - y</code> å–å¾—çµæŸä½ç½®çš„å‚ç›´é«˜åº¦</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//èµ·å§‹</span><br><span class="line">let beginIndex = (y * imageData.width + x) * 4;</span><br><span class="line"></span><br><span class="line">//çµæŸ</span><br><span class="line">let endIndex = ((imageData.height - y) * imageData.width + x) * 4;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/c/" rel="tag"># c#</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/asp-net-core-%E5%8F%96%E5%BE%97-IIS-ApplicationPoolName-SiteName/" rel="prev" title="asp.net core å–å¾— IIS ApplicationPoolName SiteName">
      <i class="fa fa-chevron-left"></i> asp.net core å–å¾— IIS ApplicationPoolName SiteName
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/npm-registry-%E8%A8%AD%E5%AE%9A/" rel="next" title="npm registry è¨­å®š">
      npm registry è¨­å®š <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®éŒ„
        </li>
        <li class="sidebar-nav-overview">
          æœ¬ç«™æ¦‚è¦
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%81%B0%E9%9A%8E"><span class="nav-number">1.</span> <span class="nav-text">ç°éš</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%80%BC%E5%8C%96"><span class="nav-number">2.</span> <span class="nav-text">äºŒå€¼åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%AE%E5%BA%A6"><span class="nav-number">3.</span> <span class="nav-text">äº®åº¦</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9C%96-Histogram"><span class="nav-number">4.</span> <span class="nav-text">ç›´æ–¹åœ– Histogram</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Histogram-Equalization"><span class="nav-number">5.</span> <span class="nav-text">Histogram Equalization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B2%A0%E7%89%87%E6%95%88%E6%9E%9C-aka-%E9%9D%88%E7%95%B0%E6%95%88%E6%9E%9C-filter"><span class="nav-number">6.</span> <span class="nav-text">è² ç‰‡æ•ˆæœ aka éˆç•°æ•ˆæœ filter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BD%B1%E5%83%8F%E6%A8%A1%E7%B3%8A-aka-%E8%BF%B7%E7%89%87%E6%95%88%E6%9E%9C-filter"><span class="nav-number">7.</span> <span class="nav-text">å½±åƒæ¨¡ç³Š aka è¿·ç‰‡æ•ˆæœ filter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sepia-Filter-%E8%80%81%E7%85%A7%E7%89%87%E6%95%88%E6%9E%9C"><span class="nav-number">8.</span> <span class="nav-text">Sepia Filter è€ç…§ç‰‡æ•ˆæœ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Discrete-Convolution"><span class="nav-number">9.</span> <span class="nav-text">Discrete Convolution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%82%8A%E7%B7%A3%E4%BA%BA%E6%AA%A2%E6%B8%AC-Detecting-Lines-with-a-Line-Detector"><span class="nav-number">10.</span> <span class="nav-text">é‚Šç·£äººæª¢æ¸¬ Detecting Lines with a Line Detector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E9%B9%BD"><span class="nav-number">11.</span> <span class="nav-text">åŠ é¹½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#High-Pass-Filter"><span class="nav-number">12.</span> <span class="nav-text">High Pass Filter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E9%9B%9C%E8%A8%8A"><span class="nav-number">13.</span> <span class="nav-text">é«˜æ–¯é›œè¨Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#js-%E7%89%88%E6%9C%AC"><span class="nav-number">14.</span> <span class="nav-text">js ç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RIP-%E9%A2%A8%E6%A0%BC%E7%9A%84-asp-net-core-middleware"><span class="nav-number">15.</span> <span class="nav-text">RIP é¢¨æ ¼çš„ asp.net core middleware</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B2%97%E7%B3%99%E7%9A%84%E9%A6%AC%E8%B3%BD%E5%85%8B"><span class="nav-number">16.</span> <span class="nav-text">ç²—ç³™çš„é¦¬è³½å…‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E6%BB%91%E9%A6%AC%E8%B3%BD%E5%85%8B"><span class="nav-number">17.</span> <span class="nav-text">å¹³æ»‘é¦¬è³½å…‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ascii-Art-js"><span class="nav-number">18.</span> <span class="nav-text">Ascii Art js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B0%B4%E5%B9%B3-%E5%9E%82%E7%9B%B4%E7%BF%BB%E8%BD%89-js"><span class="nav-number">19.</span> <span class="nav-text">æ°´å¹³ å‚ç›´ç¿»è½‰ js</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ğŸŒ¹ å–‡è³½äºº ğŸŒ¹</p>
  <div class="site-description" itemprop="description">ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ¨™ç±¤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/weber87na" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;weber87na" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

	  <!-- skilltree å»£å‘Š -->
	  <div id="myadblock" style="margin-top:25px;position:relative">
	  <div id="myadblock-title" style="position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  <script src="https://skilltree.my/promotion/cec9b4b0-be5e-4727-85c6-f7af5445124a?w=350"></script>
	  </div>

	  <!-- google å»£å‘Š -->
	  <!--
	  <ins class="adsbygoogle"
		  style="display:inline-block;width:220px;height:120px;margin-top:50px;position:relative;border-bottom-left-radius: 15px 255px;border-bottom-right-radius: 225px 15px;border-top-left-radius: 255px 15px;border-top-right-radius: 15px 225px;border: 2px solid #41403e;"
		  data-ad-client="ca-pub-1069539516107706"
		  data-ad-slot="6588270137">
	  <div id="myadblock-title2" style="z-index:999999;position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  </ins>
	  <script>
		  (adsbygoogle = window.adsbygoogle || []).push({});
	  </script>
	  -->

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å–‡è³½çš„äºº! G__G+</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç¸½å»¢è©±å­—æ•¸ï¼š</span>
    <span title="ç¸½å»¢è©±å­—æ•¸">1.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">æ‰€éœ€ç¸½æµªè²»æ™‚é–“ &asymp;</span>
    <span title="æ‰€éœ€ç¸½æµªè²»æ™‚é–“">25:58</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://la-sai-de-ren.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.blog.lasai.com.tw/posts/c-%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86%E7%AD%86%E8%A8%98/";
    this.page.identifier = "posts/c-å½±åƒè™•ç†ç­†è¨˜/";
    this.page.title = "c# å½±åƒè™•ç†ç­†è¨˜";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://la-sai-de-ren.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <!-- <div class="snow1" style="position:fixed !important"></div> -->
  <div class="cobweb" style="position:fixed !important"></div>
  <div class="spider" style="position:fixed !important"></div>
<div class="fswitch">é—œé–‰</div>
<div class="snowflakes" aria-hidden="true">
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
</div>

<!--
<script>
	function toggleSpell() {
		let spell = document.getElementsByClassName('spell')[0];
		let ghost = document.getElementsByClassName('ghost')[0];
		let noise = document.getElementsByClassName('noise')[0];
		let noise2 = document.getElementsByClassName('noise2')[0];
		if (spell.style.display === 'none') {
			spell.style.display = 'block';
			noise.style.display = '';
			noise2.style.display = '';
			ghost.style.display = 'none';
		} else {
			spell.style.display = 'none';
			noise.style.display = 'none';
			noise2.style.display = 'none';
			ghost.style.display = 'block';
		}
	}

	//è¨‚é–±å…§å®¹
	let spell = document.getElementsByClassName('spell')[0];
	let ghost = document.getElementsByClassName('ghost')[0];
	spell.addEventListener('click',toggleSpell);
	ghost.addEventListener('click',toggleSpell);
</script>
-->

<script>

let cobweb = document.querySelector('.cobweb');
let spider = document.querySelector('.spider');
let back = document.querySelector('.back-to-top');
let fswitch = document.querySelector('.fswitch');

document.addEventListener('keydown', function(event) {
	if (event.key === 'f') {
		console.log('press f key');
		ftoggle();
	}
});

fswitch.addEventListener('click' , function(){ 
	ftoggle();
});

function ftoggle(){
	if(cobweb.style.display === ''){
		cobweb.style.display = 'none';
	}else{
		cobweb.style.display = '';
	}
	if(spider.style.display === ''){
		spider.style.display = 'none';
	}else{
		spider.style.display = '';
	}
	if(back.style.display === ''){
		back.style.display = 'none';
	}else{
		back.style.display = '';
	}

	if(fswitch.innerText === 'é—œé–‰') fswitch.innerText = 'ä¹–ä¹–'
	else fswitch.innerText = 'é—œé–‰'
}



</script>

<script>
class ViNavigation {
  constructor() {
    this.Mode = {
      Normal: "normal",
      Motion: "motion",
    };

    this.lastKeyPressTime = 0;
    this.lastKeyPressed = "";
    this.currentMode = this.Mode.Normal;

    //å¯ä½¿ç”¨ç§»å‹•çš„å­—ç¢¼
    //å…± 18 å€‹å­— æ’é™¤ vi æœƒç”¨åˆ°çš„å­—
    this.tagChars = "ABCEILNOPQRSTVWXYZ";

    //ç›®å‰çš„ vim æ¨™ç¤ºå­—æ¨™ç±¤ array
    this.holdTags = new Array();

    //é å…ˆå»ºç«‹å…©å­—çµ„åˆçš„å­—å…¸
    this.dict = new Array();
    //é›™å±¤è¿´åœˆçŒå…¥æ‰€æœ‰å…©å­—çµ„åˆ
    for (var i = 0; i < this.tagChars.length; i++) {
      for (var j = 0; j < this.tagChars.length; j++) {
        this.dict.push(this.tagChars[i] + this.tagChars[j]);
      }
    }
  }

  viGoTop(keyPressed) {
    if (keyPressed === "g") {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  viGoBottom(keyPressed) {
    if (keyPressed === "G") {
      console.log("document.body.scrollHeight", document.body.scrollHeight);
      let h = Math.max(
        Math.max(
          document.body.scrollHeight,
          document.documentElement.scrollHeight
        ),
        Math.max(
          document.body.offsetHeight,
          document.documentElement.offsetHeight
        ),
        Math.max(
          document.body.clientHeight,
          document.documentElement.clientHeight
        )
      );
      window.scrollTo({ top: h, behavior: "smooth" });
    }
  }

  viFastDown(keyPressed) {
    if (keyPressed === "d") {
      this.move(350);
    }
  }

  viDown(keyPressed) {
    if (keyPressed === "j") {
      this.move(100);
    }
  }

  viFastUp(keyPressed) {
    if (keyPressed === "u") {
      this.move(-350);
    }
  }

  viUp(keyPressed) {
    if (keyPressed === "k") {
      this.move(-100);
    }
  }

  move(val) {
    var currentPosition =
      window.pageYOffset || document.documentElement.scrollTop;
    window.scrollTo({
      top: currentPosition + val,
      behavior: "smooth",
    });
  }

  removeViTags() {
    let allTags = document.querySelectorAll(".vim-tag");
    allTags.forEach(function (tag) {
      tag.parentNode.removeChild(tag);
    });
  }

  createViTag(text, href, top, left) {
    let newDiv = document.createElement("div");
    newDiv.classList.add("vim-tag");
    newDiv.style.fontFamily = "Arial, sans-serif";
    newDiv.style.fontSize = "12px";
    newDiv.style.position = "absolute";
    newDiv.style.backgroundColor = "#89CF07";
    newDiv.style.color = "black";
    newDiv.style.padding = "2px";
    newDiv.style.borderRadius = "2px";
    newDiv.style.zIndex = "999999";

    newDiv.textContent = text;
    newDiv.dataset.href = href;
    newDiv.style.top = top;
    newDiv.style.left = left;
    return newDiv;
  }

  createViTags() {
    let allTags = document.querySelectorAll("a");
    let counter = 0;
    for (let tag of allTags) {
      let rect = tag.getBoundingClientRect();
      let href = tag.href;
      //é€™å€‹è·é›¢éœ€è¦åŠ å…¥å·è»¸è·é›¢æ‰æœƒæ­£ç¢º
      let top = window.scrollY + rect.top + "px";
      let left = window.scrollX + rect.left + "px";
      let text = "";
      if (allTags.length <= this.tagChars.length) {
        text = this.tagChars[counter];
        this.holdTags.push(text);
      } else {
        text = this.dict[counter];
        this.holdTags.push(text);
      }
      let newDiv = this.createViTag(text, href, top, left);
      document.body.appendChild(newDiv);
      counter++;
    }
  }

  //æ‰¾å‡ºç›®å‰çš„é¦–å­— array
  firstCharArray() {
    let result = [];
    for (let i = 0; i < this.holdTags.length; i++) {
      let text = this.holdTags[i];
      if (text) {
        let theChar = text[0].toLowerCase();
        if (result.includes(theChar) === false) {
          result.push(theChar);
        }
      }
    }

    return result;
  }

  toggleMotion() {
    this.currentMode = this.Mode.Motion;
    this.lastKeyPressed = "";
    console.log("mode", this.currentMode);
    this.createViTags();
  }

  toggleNormal() {
    this.currentMode = this.Mode.Normal;
    console.log("mode", this.currentMode);
    this.removeViTags();
    this.holdTags = [];
    this.lastKeyPressed = "";
  }

  handleKeyDown(event) {
    let currentTime = new Date().getTime();
    let keyPressed = event.key;

    //æŒ‰ä¸‹ F æ™‚é€²å…¥ motion æ¨¡å¼
    if (this.currentMode === this.Mode.Normal && keyPressed === "F") {
      this.toggleMotion();
      return;
    }

    //æŒ‰ä¸‹ esc è·³é›¢ motion æ¨¡å¼å›åˆ° normal æ¨¡å¼
    if (this.currentMode === this.Mode.Motion && keyPressed === "Escape") {
      this.toggleNormal();
      return;
    }

    //ç•¶ motion ä¸€å€‹å­—æ™‚æ‰èµ°é€™æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length <= this.tagChars.length &&
      this.tagChars.toLowerCase().includes(keyPressed)
    ) {
      console.log("one char mode");
      let allTags = document.querySelectorAll(".vim-tag");

      allTags.forEach(function (tag) {
        if (tag.textContent.toLowerCase() === keyPressed) {
          window.location.href = tag.dataset.href;
        }
      });

      this.toggleNormal();
      return;
    }

    //ç•¶ motion å…©å€‹å­—æ‰èµ°é€™å€‹æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length > this.tagChars.length
    ) {
      console.log("motion lastKeyPressed", this.lastKeyPressed);
      console.log("motion current", keyPressed);

      if (!this.lastKeyPressed) {
        //å¦‚æœå‡ºç¾å­—è¡¨ä»¥å¤–çš„å­—å‰‡å›åˆ° normal
        //console.log("firstCharArray", this.firstCharArray());
        if (this.firstCharArray().includes(keyPressed) === false) {
          this.toggleNormal();
          return;
        } else {
          let allTags = document.querySelectorAll(".vim-tag");
          allTags.forEach(function (tag) {
            if (tag.textContent[0].toLowerCase() !== keyPressed) {
              tag.parentNode.removeChild(tag);
            }

            //å°‡ç¬¬ä¸€å€‹å­—è®Šç‚ºç´…è‰²
            if (tag.textContent[0].toLowerCase() === keyPressed) {
              tag.innerHTML =
                '<span style="color: red;">' +
                tag.textContent.charAt(0) +
                "</span>" +
                tag.textContent.substring(1);
            }
          });
        }
      }

      //å¦‚æœæœ‰å­—çš„è©±æ‰åŸ·è¡Œ
      if (this.lastKeyPressed) {
        let chars = this.lastKeyPressed + keyPressed;
        console.log("chars", chars);
        let allTags = document.querySelectorAll(".vim-tag");
        allTags.forEach(function (tag) {
          if (tag.textContent.toLowerCase() === chars) {
            window.location.href = tag.dataset.href;
          }
        });
        //è¬ä¸€æ²’æ‰¾åˆ°åˆ‡å› Normal
        this.toggleNormal();
        return;
      }
    }

    // ä»»ä½•æ¨¡å¼æŒ‰å…©ä¸‹çš„å€åŸŸ
    if (
      keyPressed === this.lastKeyPressed &&
      currentTime - this.lastKeyPressTime < 300
    ) {
      this.viGoTop(keyPressed);
    }

    // æŒ‰ä¸€ä¸‹çš„å€åŸŸ
    this.viGoBottom(keyPressed);
    this.viDown(keyPressed);
    this.viFastDown(keyPressed);
    this.viUp(keyPressed);
    this.viFastUp(keyPressed);

    this.lastKeyPressTime = currentTime;
    this.lastKeyPressed = keyPressed;
  }

  init() {
    document.addEventListener("keydown", this.handleKeyDown.bind(this));
  }
}

const viNavigation = new ViNavigation();
viNavigation.init();
</script>



</body>
</html>
