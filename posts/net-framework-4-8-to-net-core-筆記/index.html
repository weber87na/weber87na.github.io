<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/gg.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/gg.png">
  <link rel="mask-icon" href="/images/gg.png" color="#222">
  <meta name="google-site-verification" content="J5sjnNRD2AYPWVE08_-8XO_8mBKRYD3NKVYRBCGMwQ8">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">



<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S5ZWC157GD');
</script>

<style>
    @font-face {
        /* font-family: "JasonHandwriting1-Regular"; */
/*
        src: url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff2) format("woff2"), url(https://cdn.jsdelivr.net/gh/max32002/JasonHandWritingFonts@20210716/webfont/JasonHandwriting1-Regular.woff) format("woff");
		*/

        font-family: "ä¿æ–¹é«”11è™Ÿ";
        src: url(/fonts/Cubic_11_1.000_R.woff) format("woff")
    }
</style>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.blog.lasai.com.tw","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="&nbsp;">
<meta property="og:type" content="article">
<meta property="og:title" content=".net framework 4.8 to .net core ç­†è¨˜">
<meta property="og:url" content="https://www.blog.lasai.com.tw/posts/net-framework-4-8-to-net-core-%E7%AD%86%E8%A8%98/index.html">
<meta property="og:site_name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
<meta property="og:description" content="&nbsp;">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2023-12-28T12:01:34.000Z">
<meta property="article:modified_time" content="2025-02-19T09:29:19.093Z">
<meta property="article:author" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
<meta property="article:tag" content="c#">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.blog.lasai.com.tw/posts/net-framework-4-8-to-net-core-%E7%AD%86%E8%A8%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>.net framework 4.8 to .net core ç­†è¨˜ | ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S5ZWC157GD"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S5ZWC157GD');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!-- google ad -->
  <!--
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1069539516107706"
     crossorigin="anonymous"></script>
  -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!--
  <div class="spell" ></div>
  <div class="ghost" style="display: none;"></div>
  <div class="noise"></div>
  <div class="noise2"></div>
  -->


  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ğŸŒ¹ å–‡ä½å–‡è³½ ğŸŒ¹</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>çœŸå–‡è³½</a>

  </li>
        <li class="menu-item menu-item-map">

    <a href="/map/" rel="section"><i class="fa fa-map fa-fw"></i>å–‡è³½äººçš„å¥‡æ€ªç¾é£Ÿåœ°åœ–</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>é—œæ–¼å–‡è³½äºº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>å–‡è³½çš„æ¨™ç±¤</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å–‡è³½äº‚å¯«</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœå°‹
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœå°‹..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://www.blog.lasai.com.tw/posts/net-framework-4-8-to-net-core-%E7%AD%86%E8%A8%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹">
      <meta itemprop="description" content="ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸŒ¹ å–‡è³½çš„äºº Blog ğŸŒ¹">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          .net framework 4.8 to .net core ç­†è¨˜
        </h1>

        <div class="post-meta">
		
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">äº‚å¯«æ–¼</span>

              <time title="äº‚å…¥æ™‚é–“ï¼š2023-12-28 20:01:34" itemprop="dateCreated datePublished" datetime="2023-12-28T20:01:34+08:00">2023-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°æ–¼</span>
                <time title="ä¿®æ”¹æ™‚é–“ï¼š2025-02-19 17:29:19" itemprop="dateModified" datetime="2025-02-19T17:29:19+08:00">2025-02-19</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/posts/net-framework-4-8-to-net-core-%E7%AD%86%E8%A8%98/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/net-framework-4-8-to-net-core-ç­†è¨˜/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="å»¢è©±å­—æ•¸">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">å»¢è©±å­—æ•¸ï¼š</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="æ‰€éœ€å‚·çœ¼æ™‚é–“">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">æ‰€éœ€å‚·çœ¼æ™‚é–“ &asymp;</span>
              <span>16 åˆ†é˜</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&nbsp;</p>
<span id="more"></span>

<p>é€™æ˜¯æˆ‘å·¥ä½œä¸Šå‡ç´šèˆŠç‰ˆ <code>web api</code> <code>æ’ç¨‹ç¨‹å¼</code> åŠ <code>åº•å±¤é¡åˆ¥</code> é‡åˆ°çš„ç›¸é—œè§£æ³• , ä»¥ cookbook çš„æ–¹å¼è¨˜éŒ„ä¸‹</p>
<h2 id="ef-core"><a href="#ef-core" class="headerlink" title="ef core"></a>ef core</h2><h3 id="ef-core-The-entity-type-â€˜IdentityUserLoginâ€˜-requires-a-primary-key-to-be-defined"><a href="#ef-core-The-entity-type-â€˜IdentityUserLoginâ€˜-requires-a-primary-key-to-be-defined" class="headerlink" title="ef core The entity type â€˜IdentityUserLoginâ€˜ requires a primary key to be defined"></a>ef core The entity type â€˜IdentityUserLogin<string>â€˜ requires a primary key to be defined</h3><p>å¯ä»¥åƒè€ƒ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40703615/the-entity-type-identityuserloginstring-requires-a-primary-key-to-be-defined">é€™è£¡</a></p>
<p>å› ç‚ºæœ‰ä½¿ç”¨åˆ° <code>IdentityDbContext&lt;MyUser&gt;</code> æ‰€ä»¥åœ¨ <code>OnModelCreating</code> å…ˆå‘¼å«</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-DbContext-Include-Roles"><a href="#ef-core-DbContext-Include-Roles" class="headerlink" title="ef core DbContext Include Roles"></a>ef core DbContext Include Roles</h3><p>é€™å€‹å•é¡Œç–‘ä¼¼è¦è‡ªå·±å®šç¾© Roles æ²’å®šç¾©é€™æ¨£å¯«çš„è©±æœƒå™´ç´…å­—</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Users.Include(x =&gt; x.Roles);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åƒè€ƒ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47767267/ef-core-2-how-to-include-roles-navigation-property-on-identityuser">é€™ç¯‡</a></p>
<p>è§£æ³•å¦‚ä¸‹ , é€™è£¡æ³¨æ„åˆ°ä½¿ç”¨ <code>IdentityUser</code></p>
<p>éœ€è¦å®‰è£å¥—ä»¶ <code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyUser</span> : <span class="title">IdentityUser</span>&#123;</span><br><span class="line">    <span class="comment">//è¦è‡ªå·±æ‰‹å‹•åŠ å…¥</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Navigation property for the roles this user belongs to.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ICollection&lt;IdentityUserRole&lt;<span class="built_in">string</span>&gt;&gt; Roles &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span> List&lt;IdentityUserRole&lt;<span class="built_in">string</span>&gt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-new-DbContext"><a href="#ef-core-new-DbContext" class="headerlink" title="ef core new DbContext"></a>ef core new DbContext</h3><p>å¦‚æœåœ¨ä»¥å‰çš„é¡åˆ¥è£¡é¢æœ‰ç›´æ¥ <code>new DbContext</code> é€™æ¨£æœƒå™´ Erorr</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> db = <span class="keyword">new</span> YourrDbContext())</span><br></pre></td></tr></table></figure>

<p>ä¸æƒ³è¦æ³¨å…¥çš„è©±å¯ä»¥åƒè€ƒä»¥ä¸‹é€™å€‹æ–¹æ³•</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> optionsBuilder = <span class="keyword">new</span> DbContextOptionsBuilder&lt;YourrDbContext&gt;();</span><br><span class="line">optionsBuilder.UseSqlServer(GetConnectionString());</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> db = <span class="keyword">new</span> YourrDbContext(optionsBuilder.Options))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>GetConnectionString</code> å‡½æ•¸å¯¦ä½œå¦‚ä¸‹</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetConnectionString</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> builder = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">                    .SetBasePath(Directory.GetCurrentDirectory())</span><br><span class="line">                    .AddJsonFile(<span class="string">&quot;appsettings.json&quot;</span>, optional: <span class="literal">false</span>, reloadOnChange: <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">var</span> configuration = builder.Build();</span><br><span class="line">    <span class="keyword">var</span> result = configuration.GetConnectionString(<span class="string">&quot;YourrDbContext&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="ef-core-æ²’æœ‰-SqlQuery-çš„è§£æ³•"><a href="#ef-core-æ²’æœ‰-SqlQuery-çš„è§£æ³•" class="headerlink" title="ef core æ²’æœ‰ SqlQuery çš„è§£æ³•"></a>ef core æ²’æœ‰ SqlQuery çš„è§£æ³•</h3><p>æˆ‘å‡ç´šçš„ç‰ˆæœ¬æ˜¯ç”¨ .net 6 æˆ‘æ‰¾åˆ°é€™å€‹<a target="_blank" rel="noopener" href="https://github.com/PaulARoy/EntityFrameworkCore.RawSQLExtensions">å¥—ä»¶</a> <code>EntityFrameworkCore.RawSQLExtensions</code><br>æœ‰äº†ä»–ä»¥å¾ŒåŸºæœ¬ä¸Šéƒ½ç„¡ç—›è§£æ±º</p>
<h3 id="ef-core-string-null-å™´çš„éŒ¯èª¤"><a href="#ef-core-string-null-å™´çš„éŒ¯èª¤" class="headerlink" title="ef core string null å™´çš„éŒ¯èª¤"></a>ef core string null å™´çš„éŒ¯èª¤</h3><p>åœ¨ ef core è£¡é¢é è¨­çš„ string æœƒè®Šæˆ not null æƒ³è¦æ²¿ç”¨ä»¥å‰çš„è¡Œç‚ºçš„è©±è¦åœ¨ <code>.csproj</code> æŠŠ <code>&lt;Nullable&gt;</code> è¨»è§£èµ·ä¾†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--&lt;Nullable&gt;enable&lt;/Nullable&gt;--&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-HasOptional-WithMany"><a href="#ef-core-HasOptional-WithMany" class="headerlink" title="ef core HasOptional WithMany"></a>ef core HasOptional WithMany</h3><p>.net framework</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HasOptional( t =&gt; t.myUser ).WithMany();</span><br></pre></td></tr></table></figure>

<p>.net core</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;ExtInfo&gt;(entity =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    entity.HasOne(x =&gt; x.myUser).WithMany();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ef-core-WillCascadeOnDelete"><a href="#ef-core-WillCascadeOnDelete" class="headerlink" title="ef core WillCascadeOnDelete"></a>ef core WillCascadeOnDelete</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/55233677/what-is-the-equivalent-of-willcascadeondeletefalse-in-ef-core">https://stackoverflow.com/questions/55233677/what-is-the-equivalent-of-willcascadeondeletefalse-in-ef-core</a></p>
<p>åœ¨ ef core æ²’é€™å€‹å‡½æ•¸äº†æ”¹ç”¨ OnDelete(DeleteBehavior.SetNull)</p>
<h3 id="ef-core-HasRequired-WithMany"><a href="#ef-core-HasRequired-WithMany" class="headerlink" title="ef core HasRequired WithMany"></a>ef core HasRequired WithMany</h3><p>.net framework</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HasRequired(t =&gt; t.ExtInfo)</span><br><span class="line">.WithMany()</span><br><span class="line">.HasForeignKey(t =&gt; t.ExtId);</span><br></pre></td></tr></table></figure>

<p>.net core</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">entity.HasOne(x =&gt; x.ExtInfo)</span><br><span class="line">    .WithMany()</span><br><span class="line">    .HasForeignKey(x =&gt; x.ExtId)</span><br></pre></td></tr></table></figure>



<h3 id="ef-core-å¤š-Key-çš„å•é¡Œ"><a href="#ef-core-å¤š-Key-çš„å•é¡Œ" class="headerlink" title="ef core å¤š Key çš„å•é¡Œ"></a>ef core å¤š Key çš„å•é¡Œ</h3><p>has multiple properties with the [Key] attribute. Composite primary keys can only be set using â€˜HasKeyâ€™ in â€˜OnModelCreatingâ€™</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/74342264/the-entity-type-has-multiple-properties-with-the-key-attribute-composite-prim">https://stackoverflow.com/questions/74342264/the-entity-type-has-multiple-properties-with-the-key-attribute-composite-prim</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    modelBuilder.Entity&lt;MyModel&gt;()</span><br><span class="line">          .HasKey(m =&gt; <span class="keyword">new</span> &#123; m.column1 , m.column2 &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-æ‰‹æ®˜æŠŠé—œè¯éµè¨­å®šç‚ºç‰©ä»¶"><a href="#ef-core-æ‰‹æ®˜æŠŠé—œè¯éµè¨­å®šç‚ºç‰©ä»¶" class="headerlink" title="ef core æ‰‹æ®˜æŠŠé—œè¯éµè¨­å®šç‚ºç‰©ä»¶"></a>ef core æ‰‹æ®˜æŠŠé—œè¯éµè¨­å®šç‚ºç‰©ä»¶</h3><p>cannot be used as a property on entity type because it is configured as a navigation</p>
<p>æœƒå‡ºç¾é€™å€‹æ‡‰è©²æ˜¯æ‰‹æ®˜æ‰“éŒ¯</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/58659431/propertyname-cannot-be-used-as-a-property-on-entity-type-typename-because-it">https://stackoverflow.com/questions/58659431/propertyname-cannot-be-used-as-a-property-on-entity-type-typename-because-it</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    modelBuilder.Entity&lt;User&gt;(user =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        user</span><br><span class="line">        .HasOne(x =&gt; x.Gender)</span><br><span class="line">        .WithMany(x =&gt; x.Users)</span><br><span class="line">        .HasForeignKey(x =&gt; x.GenderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user.HasIndex(x =&gt; x.Gender);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™è£¡é€™å€‹è€å¤–æ‰“éŒ¯æˆ <code>user.HasIndex(x =&gt; x.Gender)</code> æ­£è§£æ‡‰è©²æ˜¯ <code>user.HasIndex(x =&gt; x.GenderId)</code></p>
<h3 id="ef-core-view-ä¸Šé¢-Key-çš„å•é¡Œ"><a href="#ef-core-view-ä¸Šé¢-Key-çš„å•é¡Œ" class="headerlink" title="ef core view ä¸Šé¢ Key çš„å•é¡Œ"></a>ef core view ä¸Šé¢ Key çš„å•é¡Œ</h3><p>åœ¨èˆŠç‰ˆæœƒé€™æ¨£å¯«</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Table(<span class="string">&quot;YOURVIEW&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YOURVIEW</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Key</span>]</span><br><span class="line">    [<span class="meta">Column( Order = 0 )</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> YOURID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ–°ç‰ˆè¦æŠŠ <code>Key</code> ç§»é™¤ç„¶å¾ŒåŠ ä¸Š <code>Keyless</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Table(<span class="string">&quot;YOURVIEW&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">Keyless</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YOURVIEW</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//todo ä»–æ‡‰è©²æ˜¯ view åœ¨ ef core ä¸ç”¨å¯« Key ä¹Ÿæœƒå‹•</span></span><br><span class="line">    <span class="comment">// [Key]</span></span><br><span class="line">    <span class="comment">// [Column( Order = 0 )]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> YOURID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-AutoInclude"><a href="#ef-core-AutoInclude" class="headerlink" title="ef core AutoInclude"></a>ef core AutoInclude</h3><p>å¦‚æœä¹‹å‰çš„ç¨‹å¼æŸ¥è©¢ä¸‹å»æœƒå‡ºç¾é—œè¯å±¬æ€§çš„è©± , ä½†æ˜¯ä½ çš„æ²’å‡ºç¾å‰‡è¡¨ç¤ºæ²’è¨­å®š <code>AutoInclude</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PointLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? Point1Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Point Point1 &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Point</span>&#123;</span><br><span class="line">    [<span class="meta">Key, DatabaseGenerated(DatabaseGeneratedOption.None)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;PointLog&gt;().HasOne(x =&gt; x.Point1).WithMany().HasForeignKey(r =&gt; r.Point1Id);</span><br><span class="line">modelBuilder.Entity&lt;PointLog&gt;().Navigation(x =&gt; x.Point1).AutoInclude();</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-HasDatabaseGeneratedOption-DatabaseGeneratedOption-Identity"><a href="#ef-core-HasDatabaseGeneratedOption-DatabaseGeneratedOption-Identity" class="headerlink" title="ef core HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)"></a>ef core HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)</h3><p>åœ¨ .net framework æœƒå¯«é€™æ¨£</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Property( t =&gt; t.Id ).HasDatabaseGeneratedOption( DatabaseGeneratedOption.Identity )</span><br></pre></td></tr></table></figure>

<p>ef core</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/36155429/auto-increment-on-partial-primary-key-with-entity-framework-core">https://stackoverflow.com/questions/36155429/auto-increment-on-partial-primary-key-with-entity-framework-core</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;Foo&gt;()</span><br><span class="line">            .Property(f =&gt; f.Id)</span><br><span class="line">            .ValueGeneratedOnAdd();</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-Lazy-loading"><a href="#ef-core-Lazy-loading" class="headerlink" title="ef core Lazy loading"></a>ef core Lazy loading</h3><p>å¦‚æœæƒ³è¦ç”¨ lazy loading å¿…é ˆè¦è‡ªå·±æ‰‹å‹•å•Ÿç”¨</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/ef/core/querying/related-data/lazy">https://learn.microsoft.com/en-us/ef/core/querying/related-data/lazy</a></p>
<p>éœ€è¦å…ˆå®‰è£é€™å€‹å¥—ä»¶ <code>Microsoft.EntityFrameworkCore.Proxies</code></p>
<p>å¦å¤–å°è¦½å±¬æ€§éƒ½è¦è¨­å®š <code>virtual</code> ä¸ç„¶ä¹Ÿæœƒå™´ error ~</p>
<p>å¦å¤–è¦æ³¨æ„å¦‚æœç”± .net framework å‡ç´šçš„æœƒæœ‰å¤šè™•é€™ç¨®åœ°æ–¹ä¹Ÿè¦è¨˜å¾—è·Ÿè‘—ä¿®æ­£ <code>var db = new YourDbContext()</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddDbContext&lt;YourDbContext&gt;(options =&gt;</span><br><span class="line">    options.UseLazyLoadingProxies().UseSqlServer(builder.Configuration.GetConnectionString(<span class="string">&quot;YourDbContext&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æ•¸é‡å¤ªå¤šçš„è©±å¯ä»¥åœ¨å»ºæ§‹å­è£¡é¢ DbContext è¨­å®š , åƒè€ƒ<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/ef/core/querying/related-data/lazy">å®˜ç¶²</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br><span class="line">    =&gt; optionsBuilder</span><br><span class="line">        .UseLazyLoadingProxies()</span><br><span class="line">        .UseSqlServer(myConnectionString);</span><br></pre></td></tr></table></figure>


<h3 id="ef-core-Lazy-loading-is-not-supported-for-detached-entities-or-entities-that-are-loaded-with-â€˜AsNoTrackingâ€™"><a href="#ef-core-Lazy-loading-is-not-supported-for-detached-entities-or-entities-that-are-loaded-with-â€˜AsNoTrackingâ€™" class="headerlink" title="ef core Lazy loading is not supported for detached entities or entities that are loaded with â€˜AsNoTrackingâ€™"></a>ef core Lazy loading is not supported for detached entities or entities that are loaded with â€˜AsNoTrackingâ€™</h3><p>å¦‚æœ <code>å•Ÿç”¨äº† Lazy loading</code> å¥½åƒè·Ÿ entity framework å¯«æ³•ç•¥æœ‰ä¸åŒ , ä»¥ä¸‹é€™å¥åœ¨ entity framework æ˜¯æ­£å¸¸çš„ , å¯æ˜¯ ef core å°±éœ€è¦å»æ‰ <code>AsNoTracking</code></p>
<p>éŒ¯èª¤</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = _db.YourTable</span><br><span class="line">    .Where(x =&gt; x.id == id)</span><br><span class="line">    .AsNoTracking()</span><br><span class="line">    .FirstOrDefault();</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = _db.YourTable</span><br><span class="line">    .Where(x =&gt; x.id == id)</span><br><span class="line">    .FirstOrDefault();</span><br></pre></td></tr></table></figure>

<p>é€™è£¡é‚„æœ‰å€‹é‡é» , è¬ä¸€ä½ ä¹‹å‰ <code>entity framework 6</code> navigation property æ²’æœ‰åŠ ä¸Š virtual çš„è©±å¯¦éš›ä¸Š api ä¸Ÿå‡ºä¾†æ˜¯å–ä¸åˆ°æ±è¥¿çš„åƒæ˜¯ä¸‹é¢é€™æ¨£</p>
<p>æ²’åŠ  <code>virtual</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ForeignKey( <span class="string">&quot;DeptId&quot;</span> )</span>]</span><br><span class="line"><span class="keyword">public</span> DEPT Dept &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ²’åŠ  <code>virtual</code> api çµæœ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;Dept&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>åŠ äº† <code>virtual</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ForeignKey( <span class="string">&quot;DeptId&quot;</span> )</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">virtual</span> DEPT Dept &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>

<p>åŠ äº† <code>virtual</code> api çµæœ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;Dept&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;DeptCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AAA&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;oId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h3 id="ef-core-Precision"><a href="#ef-core-Precision" class="headerlink" title="ef core Precision"></a>ef core Precision</h3><p>No store type was specified for the decimal property â€˜YourColumnâ€™ on entity type â€˜YourClassâ€™ This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in â€˜OnModelCreatingâ€™ using â€˜HasColumnTypeâ€™, specify precision and scale using â€˜HasPrecisionâ€™, or configure a value converter using â€˜HasConversionâ€™</p>
<p>é€™å€‹å•é¡Œæ˜¯æ²’æœ‰æ˜ç¢ºå®šç¾©è³‡æ–™å‹åˆ¥çš„å¤§å° , ä¾‹å¦‚ sql server æ˜¯ decimal(10,4) å¯ä»¥ç”¨é€™æ¨£å®šç¾©</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">YourClass</span>&#123;</span><br><span class="line">    [<span class="meta">Precision(10, 4)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> YourColumn &#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–æ˜¯åœ¨ <code>OnModelCreating</code> é€™æ¨£å®š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;YourClass&gt;(entity =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    entity.Property(x =&gt; x.YourColumn).HasPrecision(<span class="number">10</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-Keyless"><a href="#ef-core-Keyless" class="headerlink" title="ef core Keyless"></a>ef core Keyless</h3><p>The entity type â€˜YourColâ€™ has the [Keyless] attribute, but the [Key] attribute was specified on property â€˜YourViewâ€™; the two are incompatible, consider removing one. Note that the entity will have no key unless you configure one in â€˜OnModelCreatingâ€™</p>
<p>é€™å€‹å•é¡Œæ‡‰è©²æ˜¯ä½ å·²ç¶“åœ¨é¡åˆ¥è¨­å®š <code>Keyless</code> é‚£å€‹æ¬„ä½ä¸Šçš„ <code>Key</code> å»å¿˜äº†ç§»é™¤</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Keyless</span>]</span><br><span class="line"><span class="keyword">class</span> <span class="title">YourView</span>&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Key</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> YourCol &#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-BackingField"><a href="#ef-core-BackingField" class="headerlink" title="ef core BackingField"></a>ef core BackingField</h3><p>Lazy-loaded navigations must have backing fields. Either name the backing field so that it is discovered by convention or configure the backing field to use</p>
<p>é€™å€‹å•é¡Œæ˜¯å› ç‚ºåœ¨ .net core ä¸Šé¢è¦æ¨™è¨» <code>BackingField</code> ä¸ç„¶æœƒå™´ error ä»¥å‰å¥½åƒæ²’é€™æ±è¥¿</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">[<span class="meta">BackingField(nameof(name))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">string</span> Name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; name = <span class="keyword">value</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="ef-core-string-Compare-çš„å‘"><a href="#ef-core-string-Compare-çš„å‘" class="headerlink" title="ef core string.Compare çš„å‘"></a>ef core string.Compare çš„å‘</h3><p>æœ¬ä¾†æœ‰æœ‰ä¸²åœ¨ ef 6 é€™æ¨£å¯«çµ¦é , å®ƒè£¡é¢ç”¨äº† <code>string.Compare</code> åœ¨ ef core å°±ç‚¸äº†</p>
<p>The LINQ expression â€˜DbSet<XXX>()<br>.Where(b &#x3D;&gt;<br>string.Compare(\r\n strA: **code_0, \r\n strB: b.Start, \r\n ignoreCase: True) &gt;&#x3D; 0 &amp;&amp;<br>string.Compare(\r\n strA: **code_0, \r\n strB: b.End, \r\n ignoreCase: True) &lt;&#x3D; 0)â€™<br>could not be translated. </p>
<p>Additional information: Translation of method â€˜string.Compareâ€™ failed.<br>If this method can be mapped to your custom function, see <a target="_blank" rel="noopener" href="https://go.microsoft.com/fwlink/?linkid=2132413">https://go.microsoft.com/fwlink/?linkid=2132413</a> for more information.<br>Translation of method â€˜string.Compareâ€™ failed.<br>If this method can be mapped to your custom function, see <a target="_blank" rel="noopener" href="https://go.microsoft.com/fwlink/?linkid=2132413">https://go.microsoft.com/fwlink/?linkid=2132413</a> for more information.<br>Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to â€˜AsEnumerableâ€™, â€˜AsAsyncEnumerableâ€™, â€˜ToListâ€™, or â€˜ToListAsyncâ€™.<br>See <a target="_blank" rel="noopener" href="https://go.microsoft.com/fwlink/?linkid=2101038">https://go.microsoft.com/fwlink/?linkid=2101038</a> for more information.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = db.XXX</span><br><span class="line">.Where( x =&gt; <span class="built_in">string</span>.Compare( code, x.Start, <span class="literal">true</span> ) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">string</span>.Compare( code, x.End, <span class="literal">true</span> ) &lt;= <span class="number">0</span> )</span><br><span class="line">.AsNoTracking()</span><br><span class="line">.FirstOrDefault();</span><br></pre></td></tr></table></figure>

<p>èˆŠç‰ˆæ‰“å‡ºä¾†çš„ sql å¦‚ä¸‹ , è¦å°å‡ºæ–¹æ³•å¯ä»¥åƒè€ƒ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1412863/how-do-i-view-the-sql-generated-by-the-entity-framework">é€™è£¡</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sql = ((System.Data.Objects.ObjectQuery)query).ToTraceString();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">[Extent1].[id] <span class="keyword">AS</span> [id],</span><br><span class="line">[Extent1].[Code] <span class="keyword">AS</span> [Code],</span><br><span class="line">[Extent1].[<span class="keyword">Start</span>] <span class="keyword">AS</span> [<span class="keyword">Start</span>],</span><br><span class="line">[Extent1].[<span class="keyword">End</span>] <span class="keyword">AS</span> [<span class="keyword">End</span>]</span><br><span class="line"><span class="keyword">FROM</span> [dbo].[XXX] <span class="keyword">AS</span> [Extent1]</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="variable">@p__linq__0</span> <span class="operator">&gt;=</span> [Extent1].[<span class="keyword">Start</span>]) <span class="keyword">AND</span> (<span class="variable">@p__linq__1</span> <span class="operator">&lt;=</span> [Extent1].[<span class="keyword">End</span>])</span><br></pre></td></tr></table></figure>

<p>å¾Œä¾†æ¸¬åŠå¤© , æ”¹ç”¨ä»¥ä¸‹æŸ¥è©¢</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = db.XXX</span><br><span class="line">.Where(x =&gt; code.CompareTo(x.Start) &gt;= <span class="number">0</span>)</span><br><span class="line">.Where(x =&gt; code.CompareTo(x.End) &lt;= <span class="number">0</span>)</span><br><span class="line">.AsNoTracking()</span><br><span class="line">.FirstOrDefault();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰“å‡ºä¾†çš„ sql å¦‚ä¸‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [b].[id], [b].[Code], [b].[<span class="keyword">Start</span>], [b].[<span class="keyword">End</span>]</span><br><span class="line"><span class="keyword">FROM</span> [XXX] <span class="keyword">AS</span> [b]</span><br><span class="line"><span class="keyword">WHERE</span> (@__code_0 <span class="operator">&gt;=</span> [b].[StartSeq]) <span class="keyword">AND</span> (@__code_0 <span class="operator">&lt;=</span> [b].[EndSeq])</span><br></pre></td></tr></table></figure>


<h3 id="ef-core-â€˜System-Singleâ€™-to-type-â€˜System-Doubleâ€™-â€™"><a href="#ef-core-â€˜System-Singleâ€™-to-type-â€˜System-Doubleâ€™-â€™" class="headerlink" title="ef core â€˜System.Singleâ€™ to type â€˜System.Doubleâ€™.â€™"></a>ef core â€˜System.Singleâ€™ to type â€˜System.Doubleâ€™.â€™</h3><p>é€™å€‹å•é¡Œæ˜¯ä½ è¨­å®šçš„ entity è³‡æ–™å‹åˆ¥èˆ‡ db çš„ä¸ç›¸ç¬¦åˆ</p>
<p>ä¾‹å¦‚æ¸¬è©¦æ©Ÿå¯«æˆ real , æ­£å¼æ©Ÿç”¨ decimal ç„¶å¾Œä½ çš„ entity è¨­å®šè³‡æ–™å‹åˆ¥ç”¨ decimal</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">entity.Property(x =&gt; x.Power).HasPrecision(<span class="number">14</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>è¦æ¯”å°æ­£å¼èˆ‡æ¸¬è©¦çš„ table å¯ä»¥å…ˆ create as script</p>
<p>ç„¶å¾Œç”¨é€™å€‹<a target="_blank" rel="noopener" href="https://www.diffchecker.com/text-compare/">ç·šä¸Šå·¥å…·</a> çœ‹çœ‹å°å‡ºä¾†çš„ç›¸ç•°ä¹‹è™•</p>
<h3 id="ef-core-CTE"><a href="#ef-core-CTE" class="headerlink" title="ef core CTE"></a>ef core CTE</h3><p>é€™å€‹é‚„æ»¿é›·çš„è·Ÿä»¥å‰å¯«ç™¼å·®ç•°æœ‰é»å¤š , è¦å…ˆå®šç¾© CTE çš„é¡åˆ¥åœ¨ DbContext , ä¸¦ä¸”é¡åˆ¥çš„æ¬„ä½ä¸€å®šè¦ç”¨åˆ° , ä¸ç„¶ä¹Ÿæœƒå™´éŒ¯<br>é‚„æœ‰å¦‚æœå·æ‡¶æœ‰å…©å€‹ column åç¨±ä¸€æ¨£çš„è©± , ä¹Ÿæ˜¯æœƒç‚¸ , è¦ç‰¹åˆ¥æ³¨æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public virtual DbSet&lt;YOURCTEVIEW&gt; YOURCTEVIEW &#123; get; set; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥è‘—åœ¨ <code>OnModelCreating</code> å®šç¾©é€™å€‹è¨­å®š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;YOURCTEVIEW&gt;().HasNoKey().ToView(null);</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œä½¿ç”¨çš„æ™‚å€™è¦é€™æ¨£å¯«</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Set&lt;YOURCTEVIEW&gt;().FromSqlRaw(sql).ToList();</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-HasPrecision-å¿«é€Ÿä¿®æ­£"><a href="#ef-core-HasPrecision-å¿«é€Ÿä¿®æ­£" class="headerlink" title="ef core HasPrecision å¿«é€Ÿä¿®æ­£"></a>ef core HasPrecision å¿«é€Ÿä¿®æ­£</h3><p>warn: Microsoft.EntityFrameworkCore.Model.Validation[30000]<br>      No store type was specified for the decimal property â€˜COLUMNNAMEâ€™ on entity type â€˜TABLENAMEâ€™.<br>	  This will cause values to be silently truncated if they do not fit in the default precision and scale.<br>	  Explicitly specify the SQL server column type that can accommodate all the values in â€˜OnModelCreatingâ€™ using â€˜HasColumnTypeâ€™,<br>	  specify precision and scale using â€˜HasPrecisionâ€™,<br>	  or configure a value converter using â€˜HasConversionâ€™.<br>	<br>å¦‚æœå™´ä¸€å †é€™ç¨®é¡ä¼¼çš„éŒ¯èª¤ä»–æœƒè·³è­¦å‘Š , å¯ä»¥åœ¨ sql server ä¸Šé¢ä¸‹é€™ä¸² , è‡ªå·±ç”¢ code ç„¶å¾ŒåŠ åœ¨ DbContext è£¡é¢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select COLUMN_NAME , NUMERIC_PRECISION , NUMERIC_SCALE , </span><br><span class="line">&#x27;entity.Property(e=&gt;e.&#x27; + COLUMN_NAME + &#x27;).HasPrecision(&#x27;+ convert(varchar, NUMERIC_PRECISION) + &#x27;, &#x27;+ convert(varchar,NUMERIC_SCALE) + &#x27;);&#x27;</span><br><span class="line">from INFORMATION_SCHEMA.COLUMNS</span><br><span class="line">where TABLE_NAME=&#x27;TABLENAME&#x27;</span><br><span class="line">and DATA_TYPE = &#x27;decimal&#x27;</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œåœ¨ OnModelCreating åŠ ä¸Šå»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">modelBuilder.Entity&lt;TABLENAME&gt;(entity =&gt;</span><br><span class="line">&#123;</span><br><span class="line">	entity.Property(e =&gt; e.COLUMNNAME).HasPrecision(8, 1);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ef-core-CommandTimeout"><a href="#ef-core-CommandTimeout" class="headerlink" title="ef core CommandTimeout"></a>ef core CommandTimeout</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39058422/how-to-set-command-timeout-in-asp-net-core-entity-framework-core">https://stackoverflow.com/questions/39058422/how-to-set-command-timeout-in-asp-net-core-entity-framework-core</a></p>
<p>èˆŠç‰ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Database.CommandTimeout = 300;</span><br></pre></td></tr></table></figure>

<p>.net core</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var optionsBuilder = new DbContextOptionsBuilder&lt;YourDbContext&gt;();</span><br><span class="line">optionsBuilder.UseOracle(GetDbConnectionString() , opt =&gt; opt.CommandTimeout(60));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">services.AddDbContext&lt;YourDbContext&gt;(options =&gt; options.UseOracle(</span><br><span class="line">    this.Configuration.GetConnectionString(&quot;YourConnectionString&quot;),</span><br><span class="line">    sqlServerOptions =&gt; sqlServerOptions.CommandTimeout(60))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<h3 id="ef-core-Connection-State"><a href="#ef-core-Connection-State" class="headerlink" title="ef core Connection.State"></a>ef core Connection.State</h3><p>èˆŠç‰ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (db.Database.Connection.State != ConnectionState.Open)</span><br><span class="line">	db.Database.Connection.Open();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>.net core</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (db.Database.GetDbConnection().State != ConnectionState.Open)</span><br><span class="line">	db.Database.GetDbConnection().Open();</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="ef-core-Cannot-convert-implicitly-a-type-â€˜System-Linq-IQueryableâ€™-into-â€˜Microsoft-EntityFrameworkCore-Query-IIncludableQueryableâ€™"><a href="#ef-core-Cannot-convert-implicitly-a-type-â€˜System-Linq-IQueryableâ€™-into-â€˜Microsoft-EntityFrameworkCore-Query-IIncludableQueryableâ€™" class="headerlink" title="ef core Cannot convert implicitly a type â€˜System.Linq.IQueryableâ€™ into â€˜Microsoft.EntityFrameworkCore.Query.IIncludableQueryableâ€™"></a>ef core Cannot convert implicitly a type â€˜System.Linq.IQueryableâ€™ into â€˜Microsoft.EntityFrameworkCore.Query.IIncludableQueryableâ€™</h3><p>åƒè€ƒé€™ç¯‡<br><a target="_blank" rel="noopener" href="https://iditect.com/faq/csharp/cannot-convert-implicitly-a-type-39systemlinqiqueryable39-into-39microsoftentityframeworkcorequeryiincludablequeryable39.html">https://iditect.com/faq/csharp/cannot-convert-implicitly-a-type-39systemlinqiqueryable39-into-39microsoftentityframeworkcorequeryiincludablequeryable39.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// This will throw a compile-time error</span><br><span class="line">var query = context.MyEntity.Include(e =&gt; e.RelatedEntity);</span><br><span class="line"></span><br><span class="line">// This will work correctly</span><br><span class="line">var query = context.MyEntity.Include(e =&gt; e.RelatedEntity).AsQueryable();</span><br></pre></td></tr></table></figure>


<h2 id="Autofac"><a href="#Autofac" class="headerlink" title="Autofac"></a>Autofac</h2><h3 id="Autofac-æ³¨å…¥-DbContext"><a href="#Autofac-æ³¨å…¥-DbContext" class="headerlink" title="Autofac æ³¨å…¥ DbContext"></a>Autofac æ³¨å…¥ DbContext</h3><p>åŸºæœ¬ä¸Šæœ€å¥½æ˜¯ç”¨æ³¨å…¥çš„</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">builder.Register(x =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> optionsBuilder = <span class="keyword">new</span> DbContextOptionsBuilder&lt;YourDbContext&gt;();</span><br><span class="line">    optionsBuilder.UseSqlServer(configuration.GetConnectionString(<span class="string">&quot;YourDbContext&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> YourDbContext(optionsBuilder.Options);</span><br><span class="line">&#125;)</span><br><span class="line">.InstancePerLifetimeScope()</span><br><span class="line">.Named(<span class="string">&quot;db&quot;</span>, <span class="keyword">typeof</span>(YourDbContext));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Autofac-æ³¨å…¥å¤šåƒæ•¸å»ºæ§‹å­"><a href="#Autofac-æ³¨å…¥å¤šåƒæ•¸å»ºæ§‹å­" class="headerlink" title="Autofac æ³¨å…¥å¤šåƒæ•¸å»ºæ§‹å­"></a>Autofac æ³¨å…¥å¤šåƒæ•¸å»ºæ§‹å­</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">builder.RegisterType&lt;OOService&gt;()</span><br><span class="line">    .As&lt;IOOService&gt;()</span><br><span class="line">    .UsingConstructor(</span><br><span class="line">        <span class="keyword">typeof</span>(YourDbContext),</span><br><span class="line">        <span class="keyword">typeof</span>(GGDbContext)</span><br><span class="line">    )</span><br><span class="line">    .WithParameters(<span class="keyword">new</span> List&lt;ResolvedParameter&gt;() &#123;</span><br><span class="line">        <span class="keyword">new</span> ResolvedParameter(</span><br><span class="line">            (pi, ctx) =&gt; pi.ParameterType == <span class="keyword">typeof</span>(YourDbContext),</span><br><span class="line">            (pi, ctx) =&gt; ctx.ResolveNamed&lt;YourDbContext&gt;(<span class="string">&quot;db&quot;</span>)),</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> ResolvedParameter(</span><br><span class="line">            (pi, ctx) =&gt; pi.ParameterType == <span class="keyword">typeof</span>(GGDbContext),</span><br><span class="line">            (pi, ctx) =&gt; ctx.ResolveNamed&lt;GGDbContext&gt;(<span class="string">&quot;gg&quot;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    .Named(<span class="string">&quot;ooService&quot;</span>, <span class="keyword">typeof</span>(IOOService));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Autofac-æ³¨å…¥ç‰©ä»¶"><a href="#Autofac-æ³¨å…¥ç‰©ä»¶" class="headerlink" title="Autofac æ³¨å…¥ç‰©ä»¶"></a>Autofac æ³¨å…¥ç‰©ä»¶</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€™è£¡å¥½åƒä¸åŠ  As ä½¿ç”¨å…·åæœƒå£æ‰</span></span><br><span class="line">builder.RegisterType&lt;OOService&gt;()</span><br><span class="line">.As&lt;OOService&gt;()</span><br><span class="line">.Named(<span class="string">&quot;ooService&quot;</span>,<span class="keyword">typeof</span>(OOService));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å…¶ä»–é¡"><a href="#å…¶ä»–é¡" class="headerlink" title="å…¶ä»–é¡"></a>å…¶ä»–é¡</h2><h3 id="ApiController-ä¿®æ­£"><a href="#ApiController-ä¿®æ­£" class="headerlink" title="ApiController ä¿®æ­£"></a>ApiController ä¿®æ­£</h3><p>.net core æ”¹ç”¨ <code>IActionResult</code> å–ä»£ <code>IHttpActionResult</code></p>
<h3 id="Newtonsoft"><a href="#Newtonsoft" class="headerlink" title="Newtonsoft"></a>Newtonsoft</h3><p>èˆŠç‰ˆ <code>.net framework</code> æ‡‰è©²éƒ½ç”¨ <code>Newtonsoft</code><br><code>.net core</code> é è¨­æœƒç”¨ <code>System.Text.Json</code> ä¾†è™•ç† json<br>æ‰€ä»¥æœ€å¥½å®‰è£ä»¥ä¸‹é€™å…©å€‹å¥—ä»¶<br><code>Microsoft.AspNetCore.Mvc.NewtonsoftJson</code><br><code>Swashbuckle.AspNetCore.Newtonsoft</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddControllers().AddNewtonsoftJson(opt =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    opt.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore;</span><br><span class="line">    opt.SerializerSettings.ContractResolver = <span class="keyword">new</span> CamelCasePropertyNamesContractResolver();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.SwaggerDoc(<span class="string">&quot;v1&quot;</span>, <span class="keyword">new</span> OpenApiInfo</span><br><span class="line">    &#123;</span><br><span class="line">        Version = <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">        Title = <span class="string">&quot;ToDo API&quot;</span>,</span><br><span class="line">        Description = <span class="string">&quot;An ASP.NET Core Web API for managing ToDo items&quot;</span>,</span><br><span class="line">        TermsOfService = <span class="keyword">new</span> Uri(<span class="string">&quot;https://example.com/terms&quot;</span>),</span><br><span class="line">        Contact = <span class="keyword">new</span> OpenApiContact</span><br><span class="line">        &#123;</span><br><span class="line">            Name = <span class="string">&quot;Example Contact&quot;</span>,</span><br><span class="line">            Url = <span class="keyword">new</span> Uri(<span class="string">&quot;https://example.com/contact&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        License = <span class="keyword">new</span> OpenApiLicense</span><br><span class="line">        &#123;</span><br><span class="line">            Name = <span class="string">&quot;Example License&quot;</span>,</span><br><span class="line">            Url = <span class="keyword">new</span> Uri(<span class="string">&quot;https://example.com/license&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// using System.Reflection;</span></span><br><span class="line">    <span class="keyword">var</span> xmlFilename = <span class="string">$&quot;<span class="subst">&#123;Assembly.GetExecutingAssembly().GetName().Name&#125;</span>.xml&quot;</span>;</span><br><span class="line">    options.IncludeXmlComments(Path.Combine(AppContext.BaseDirectory, xmlFilename));</span><br><span class="line">&#125;);</span><br><span class="line">builder.Services.AddSwaggerGenNewtonsoftSupport();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–å¥½åƒ <code>.csproj</code> é‚„è¦åŠ ä¸Šé€™å€‹è¨­å®šæ‰æœƒæ­£å¸¸ç”¢æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">GenerateDocumentationFile</span>&gt;</span>true<span class="tag">&lt;/<span class="name">GenerateDocumentationFile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">NoWarn</span>&gt;</span>$(NoWarn);1591<span class="tag">&lt;/<span class="name">NoWarn</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="UserManager-CreateIdentityAsync-ç§»é™¤çš„è§£æ³•"><a href="#UserManager-CreateIdentityAsync-ç§»é™¤çš„è§£æ³•" class="headerlink" title="UserManager CreateIdentityAsync ç§»é™¤çš„è§£æ³•"></a>UserManager CreateIdentityAsync ç§»é™¤çš„è§£æ³•</h3><p>åœ¨ .net framework ä½¿ç”¨åˆ°äº† <code>CreateIdentityAsync</code> é€™å€‹å‡½æ•¸ä½†æ˜¯ .net core å·²ç¶“ç§»é™¤äº†</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»–é€™è£¡ return ClaimsIdentity</span></span><br><span class="line"><span class="keyword">var</span> claimsIdentity = <span class="keyword">await</span> mgr.CreateIdentityAsync(<span class="keyword">this</span>, DefaultAuthenticationTypes.ApplicationCookie);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ç›®å‰çš„è§£æ³•æ˜¯æ”¹ç”¨å¦‚ä¸‹æ–¹å¼ , ä¸éå°šæœªé©—è­‰<br>å¯åƒè€ƒ<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40304516/the-name-defaultauthenticationtypes-does-not-exist-in-the-current-context">https://stackoverflow.com/questions/40304516/the-name-defaultauthenticationtypes-does-not-exist-in-the-current-context</a><br><a target="_blank" rel="noopener" href="https://github.com/aspnet/AspNetIdentity/blob/main/src/Microsoft.AspNet.Identity.Core/DefaultAuthenticationTypes.cs">https://github.com/aspnet/AspNetIdentity/blob/main/src/Microsoft.AspNet.Identity.Core/DefaultAuthenticationTypes.cs</a></p>
<p>é€™å¥ <code>DefaultAuthenticationTypes.ApplicationCookie</code> å°±æ˜¯å€‹å¸¸æ•¸ <code>ApplicationCookie</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> claimsIdentity = <span class="keyword">new</span> ClaimsIdentity(<span class="keyword">await</span> mgr.GetClaimsAsync(<span class="keyword">this</span>), <span class="string">&quot;ApplicationCookie&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="AspNetUser-è³‡æ–™è¡¨çš„å•é¡Œ"><a href="#AspNetUser-è³‡æ–™è¡¨çš„å•é¡Œ" class="headerlink" title="AspNetUser è³‡æ–™è¡¨çš„å•é¡Œ"></a>AspNetUser è³‡æ–™è¡¨çš„å•é¡Œ</h3><p>å¦‚æœè¦åœ¨ .net core ä½¿ç”¨ <code>IdentityUser</code> çš„è©±æœƒå™´ä»¥ä¸‹éŒ¯èª¤ , é€™æ˜¯å› ç‚ºæ–°çš„è³‡æ–™è¡¨æœ‰é€™äº›æ¬„ä½ , å‡ç´šæ™‚æ‡‰è©²è¦æ³¨æ„ä¸‹é€™å€‹éƒ¨åˆ†</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/50343512/migrate-existing-microsoft-aspnet-identity-db-ef-6-to-microsoft-aspnetcore-ide">https://stackoverflow.com/questions/50343512/migrate-existing-microsoft-aspnet-identity-db-ef-6-to-microsoft-aspnetcore-ide</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=CByZc2CDDqE">https://www.youtube.com/watch?v=CByZc2CDDqE</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Microsoft.Data.SqlClient.SqlException (0x80131904): ç„¡æ•ˆçš„è³‡æ–™è¡Œåç¨± &#x27;ConcurrencyStamp&#x27;ã€‚</span><br><span class="line">ç„¡æ•ˆçš„è³‡æ–™è¡Œåç¨± &#x27;LockoutEnd&#x27;ã€‚</span><br><span class="line">ç„¡æ•ˆçš„è³‡æ–™è¡Œåç¨± &#x27;NormalizedEmail&#x27;ã€‚</span><br><span class="line">ç„¡æ•ˆçš„è³‡æ–™è¡Œåç¨± &#x27;NormalizedUserName</span><br></pre></td></tr></table></figure>

<h3 id="Application-Start-çš„è§£æ³•"><a href="#Application-Start-çš„è§£æ³•" class="headerlink" title="Application_Start çš„è§£æ³•"></a>Application_Start çš„è§£æ³•</h3><p>var app &#x3D; builder.Build();</p>
<p>&#x2F;&#x2F;<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/aspnet/core/migration/50-to-60-samples?view=aspnetcore-8.0">https://learn.microsoft.com/zh-tw/aspnet/core/migration/50-to-60-samples?view=aspnetcore-8.0</a><br>IHostApplicationLifetime lifetime &#x3D; app.Lifetime;</p>
<p>&#x2F;&#x2F;Application_Start<br>lifetime.ApplicationStarted.Register(() &#x3D;&gt;<br>{<br>	&#x2F;&#x2F;ä½ éœ€è¦åŸ·è¡Œçš„å…§å®¹<br>});</p>
<h3 id="MapPath-çš„è§£æ³•"><a href="#MapPath-çš„è§£æ³•" class="headerlink" title="MapPath çš„è§£æ³•"></a>MapPath çš„è§£æ³•</h3><p>å‡è¨­æœ‰ç”¨åˆ° <code>MapPath</code> å–å¾— <code>App_Data</code> è³‡æ–™å¤¾çš„è©± , å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è§£æ±º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//var targetPath = $&quot;&#123;HostingEnvironment.MapPath(&quot;~/App_Data&quot;)&#125;/photos&quot;;</span><br><span class="line">var targetPath = Path.Combine(Directory.GetCurrentDirectory(), &quot;App_Data/photos&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="ActionFilter-OnActionExecuted-çš„å‘"><a href="#ActionFilter-OnActionExecuted-çš„å‘" class="headerlink" title="ActionFilter OnActionExecuted çš„å‘"></a>ActionFilter OnActionExecuted çš„å‘</h3><p>åœ¨èˆŠç‰ˆçš„ mvc è£¡é¢è‡ªè¨‚ ActionFilter é€šå¸¸æœƒè¤‡å¯« <code>OnActionExecuting</code> åŠ <code>OnActionExecuted</code><br>å¯ä»¥ç”¨ <code>HttpActionContext</code> çš„ <code>ActionArguments</code> å»å¡ä¸€äº›ç‹€æ…‹ , å¦‚åŸ·è¡Œæ™‚é–“ , æ‹¿ client ip ä½œæ¯”å°ç­‰ç­‰ , å¤§æ¦‚é•·ä»¥ä¸‹é€™æ¨£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public override void OnActionExecuting( HttpActionContext actionContext )&#123;</span><br><span class="line">	actionContext.ActionArguments[&quot;ip&quot;] = ip;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public override void OnActionExecuted( HttpActionExecutedContext filterContext )&#123;</span><br><span class="line">	var ip = filterContext.ActionContext.ActionArguments[&quot;ip&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯æ˜¯åœ¨ . net core è£¡é¢æ˜¯æ‹¿ä¸åˆ° OnActionExecuted è£¡é¢çš„æ±æ± , æ‰€ä»¥è¦æ”¹å¯«é€™æ¨£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public override void OnActionExecuting(ActionExecutingContext context)&#123;</span><br><span class="line"></span><br><span class="line">	var ip = context.HttpContext.Features.Get&lt;IHttpConnectionFeature&gt;()?.RemoteIpAddress.ToString();</span><br><span class="line">	context.HttpContext.Items[&quot;ip&quot;] = ip;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public override void OnActionExecuted(ActionExecutedContext context)&#123;</span><br><span class="line">	var ip = (T)context.HttpContext.Items[&quot;ip&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¤šèªç³»"><a href="#å¤šèªç³»" class="headerlink" title="å¤šèªç³»"></a>å¤šèªç³»</h3><p>å¤šèªç³»å¦‚æœæ²¿ç”¨èˆŠç‰ˆçš„ Resource å¯ä»¥é€™æ¨£å¯« , ä»–æœƒåœ¨ä½  Request è£¡é¢å»ç”¨å°æ‡‰çš„èªç³»è™•ç† , å¹¾ä¹ç„¡ç—›å‡ç´š<br>ä¸€é–‹å§‹çœ‹åˆ°è¦åœ¨ controller åŠ ä¸Šä¸€å † <code>IStringLocalizer</code> å·®é»åš‡æ­» , å¥½éšªå¾Œä¾†æ‰¾åˆ°é€™å€‹æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddLocalization();</span><br><span class="line">   builder.Services.Configure&lt;RequestLocalizationOptions&gt;(</span><br><span class="line">       options =&gt;</span><br><span class="line">       &#123;</span><br><span class="line">           //å–å¾—ç›®å‰èªç³»</span><br><span class="line">           var currentCulture = CultureInfo.CurrentCulture;</span><br><span class="line">           Console.WriteLine(currentCulture);</span><br><span class="line">           var supportedCultures = new List&lt;CultureInfo&gt;</span><br><span class="line">           &#123;</span><br><span class="line">               new CultureInfo(&quot;zh-TW&quot;),</span><br><span class="line">               new CultureInfo(&quot;en&quot;),</span><br><span class="line">               new CultureInfo(&quot;zh-CN&quot;),</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           //è¨­å®šç›®å‰èªç³»</span><br><span class="line">           options.DefaultRequestCulture = new RequestCulture(currentCulture);</span><br><span class="line">           //options.DefaultRequestCulture = new RequestCulture(culture: &quot;en-US&quot;, uiCulture: &quot;en-US&quot;);</span><br><span class="line"></span><br><span class="line">           options.SupportedCultures = supportedCultures;</span><br><span class="line">           options.SupportedUICultures = supportedCultures;</span><br><span class="line">       &#125;);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">   //å¤šèªç³»</span><br><span class="line">   app.UseRequestLocalization();</span><br></pre></td></tr></table></figure>

<h3 id="IHttpActionResult"><a href="#IHttpActionResult" class="headerlink" title="IHttpActionResult"></a>IHttpActionResult</h3><p>åŸºæœ¬ä¸Šçœ‹åˆ° IHttpActionResult åªè¦æ”¹æˆ IActionResult å³å¯</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/c/" rel="tag"># c#</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/python-%E6%AD%A3%E5%A6%B9%E5%88%86%E6%9E%90/" rel="prev" title="python æ­£å¦¹åˆ†æ">
      <i class="fa fa-chevron-left"></i> python æ­£å¦¹åˆ†æ
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/c-%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95%E5%AF%A6%E5%8B%99/" rel="next" title="c# æ³›å‹æ–¹æ³•å¯¦å‹™">
      c# æ³›å‹æ–¹æ³•å¯¦å‹™ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®éŒ„
        </li>
        <li class="sidebar-nav-overview">
          æœ¬ç«™æ¦‚è¦
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ef-core"><span class="nav-number">1.</span> <span class="nav-text">ef core</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-The-entity-type-%E2%80%98IdentityUserLogin%E2%80%98-requires-a-primary-key-to-be-defined"><span class="nav-number">1.1.</span> <span class="nav-text">ef core The entity type â€˜IdentityUserLoginâ€˜ requires a primary key to be defined</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-DbContext-Include-Roles"><span class="nav-number">1.2.</span> <span class="nav-text">ef core DbContext Include Roles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-new-DbContext"><span class="nav-number">1.3.</span> <span class="nav-text">ef core new DbContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-%E6%B2%92%E6%9C%89-SqlQuery-%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="nav-number">1.4.</span> <span class="nav-text">ef core æ²’æœ‰ SqlQuery çš„è§£æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-string-null-%E5%99%B4%E7%9A%84%E9%8C%AF%E8%AA%A4"><span class="nav-number">1.5.</span> <span class="nav-text">ef core string null å™´çš„éŒ¯èª¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-HasOptional-WithMany"><span class="nav-number">1.6.</span> <span class="nav-text">ef core HasOptional WithMany</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-WillCascadeOnDelete"><span class="nav-number">1.7.</span> <span class="nav-text">ef core WillCascadeOnDelete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-HasRequired-WithMany"><span class="nav-number">1.8.</span> <span class="nav-text">ef core HasRequired WithMany</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-%E5%A4%9A-Key-%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="nav-number">1.9.</span> <span class="nav-text">ef core å¤š Key çš„å•é¡Œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-%E6%89%8B%E6%AE%98%E6%8A%8A%E9%97%9C%E8%81%AF%E9%8D%B5%E8%A8%AD%E5%AE%9A%E7%82%BA%E7%89%A9%E4%BB%B6"><span class="nav-number">1.10.</span> <span class="nav-text">ef core æ‰‹æ®˜æŠŠé—œè¯éµè¨­å®šç‚ºç‰©ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-view-%E4%B8%8A%E9%9D%A2-Key-%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="nav-number">1.11.</span> <span class="nav-text">ef core view ä¸Šé¢ Key çš„å•é¡Œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-AutoInclude"><span class="nav-number">1.12.</span> <span class="nav-text">ef core AutoInclude</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-HasDatabaseGeneratedOption-DatabaseGeneratedOption-Identity"><span class="nav-number">1.13.</span> <span class="nav-text">ef core HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Lazy-loading"><span class="nav-number">1.14.</span> <span class="nav-text">ef core Lazy loading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Lazy-loading-is-not-supported-for-detached-entities-or-entities-that-are-loaded-with-%E2%80%98AsNoTracking%E2%80%99"><span class="nav-number">1.15.</span> <span class="nav-text">ef core Lazy loading is not supported for detached entities or entities that are loaded with â€˜AsNoTrackingâ€™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Precision"><span class="nav-number">1.16.</span> <span class="nav-text">ef core Precision</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Keyless"><span class="nav-number">1.17.</span> <span class="nav-text">ef core Keyless</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-BackingField"><span class="nav-number">1.18.</span> <span class="nav-text">ef core BackingField</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-string-Compare-%E7%9A%84%E5%9D%91"><span class="nav-number">1.19.</span> <span class="nav-text">ef core string.Compare çš„å‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-%E2%80%98System-Single%E2%80%99-to-type-%E2%80%98System-Double%E2%80%99-%E2%80%99"><span class="nav-number">1.20.</span> <span class="nav-text">ef core â€˜System.Singleâ€™ to type â€˜System.Doubleâ€™.â€™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-CTE"><span class="nav-number">1.21.</span> <span class="nav-text">ef core CTE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-HasPrecision-%E5%BF%AB%E9%80%9F%E4%BF%AE%E6%AD%A3"><span class="nav-number">1.22.</span> <span class="nav-text">ef core HasPrecision å¿«é€Ÿä¿®æ­£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-CommandTimeout"><span class="nav-number">1.23.</span> <span class="nav-text">ef core CommandTimeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Connection-State"><span class="nav-number">1.24.</span> <span class="nav-text">ef core Connection.State</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ef-core-Cannot-convert-implicitly-a-type-%E2%80%98System-Linq-IQueryable%E2%80%99-into-%E2%80%98Microsoft-EntityFrameworkCore-Query-IIncludableQueryable%E2%80%99"><span class="nav-number">1.25.</span> <span class="nav-text">ef core Cannot convert implicitly a type â€˜System.Linq.IQueryableâ€™ into â€˜Microsoft.EntityFrameworkCore.Query.IIncludableQueryableâ€™</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Autofac"><span class="nav-number">2.</span> <span class="nav-text">Autofac</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Autofac-%E6%B3%A8%E5%85%A5-DbContext"><span class="nav-number">2.1.</span> <span class="nav-text">Autofac æ³¨å…¥ DbContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Autofac-%E6%B3%A8%E5%85%A5%E5%A4%9A%E5%8F%83%E6%95%B8%E5%BB%BA%E6%A7%8B%E5%AD%90"><span class="nav-number">2.2.</span> <span class="nav-text">Autofac æ³¨å…¥å¤šåƒæ•¸å»ºæ§‹å­</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Autofac-%E6%B3%A8%E5%85%A5%E7%89%A9%E4%BB%B6"><span class="nav-number">2.3.</span> <span class="nav-text">Autofac æ³¨å…¥ç‰©ä»¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E9%A1%9E"><span class="nav-number">3.</span> <span class="nav-text">å…¶ä»–é¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ApiController-%E4%BF%AE%E6%AD%A3"><span class="nav-number">3.1.</span> <span class="nav-text">ApiController ä¿®æ­£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Newtonsoft"><span class="nav-number">3.2.</span> <span class="nav-text">Newtonsoft</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UserManager-CreateIdentityAsync-%E7%A7%BB%E9%99%A4%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text">UserManager CreateIdentityAsync ç§»é™¤çš„è§£æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AspNetUser-%E8%B3%87%E6%96%99%E8%A1%A8%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="nav-number">3.4.</span> <span class="nav-text">AspNetUser è³‡æ–™è¡¨çš„å•é¡Œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Start-%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="nav-number">3.5.</span> <span class="nav-text">Application_Start çš„è§£æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MapPath-%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="nav-number">3.6.</span> <span class="nav-text">MapPath çš„è§£æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ActionFilter-OnActionExecuted-%E7%9A%84%E5%9D%91"><span class="nav-number">3.7.</span> <span class="nav-text">ActionFilter OnActionExecuted çš„å‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%AA%9E%E7%B3%BB"><span class="nav-number">3.8.</span> <span class="nav-text">å¤šèªç³»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IHttpActionResult"><span class="nav-number">3.9.</span> <span class="nav-text">IHttpActionResult</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ğŸŒ¹ å–‡è³½äºº ğŸŒ¹"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ğŸŒ¹ å–‡è³½äºº ğŸŒ¹</p>
  <div class="site-description" itemprop="description">ğŸŒ¹ å–‡è³½äººçš„ Blog ğŸŒ¹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">347</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ¨™ç±¤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/weber87na" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;weber87na" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

	  <!-- skilltree å»£å‘Š -->
	  <div id="myadblock" style="margin-top:25px;position:relative">
	  <div id="myadblock-title" style="position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  <script src="https://skilltree.my/promotion/cec9b4b0-be5e-4727-85c6-f7af5445124a?w=350"></script>
	  </div>

	  <!-- google å»£å‘Š -->
	  <!--
	  <ins class="adsbygoogle"
		  style="display:inline-block;width:220px;height:120px;margin-top:50px;position:relative;border-bottom-left-radius: 15px 255px;border-bottom-right-radius: 225px 15px;border-top-left-radius: 255px 15px;border-top-right-radius: 15px 225px;border: 2px solid #41403e;"
		  data-ad-client="ca-pub-1069539516107706"
		  data-ad-slot="6588270137">
	  <div id="myadblock-title2" style="z-index:999999;position:absolute;left:-10px;top:-10px;width:100px;background-color:rgba(0,0,0,.75);color:white;">å·æ”¾å·¥å•†</div>
	  </ins>
	  <script>
		  (adsbygoogle = window.adsbygoogle || []).push({});
	  </script>
	  -->

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å–‡è³½çš„äºº! G__G+</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç¸½å»¢è©±å­—æ•¸ï¼š</span>
    <span title="ç¸½å»¢è©±å­—æ•¸">1.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">æ‰€éœ€ç¸½æµªè²»æ™‚é–“ &asymp;</span>
    <span title="æ‰€éœ€ç¸½æµªè²»æ™‚é–“">26:07</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://la-sai-de-ren.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.blog.lasai.com.tw/posts/net-framework-4-8-to-net-core-%E7%AD%86%E8%A8%98/";
    this.page.identifier = "posts/net-framework-4-8-to-net-core-ç­†è¨˜/";
    this.page.title = ".net framework 4.8 to .net core ç­†è¨˜";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://la-sai-de-ren.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <!-- <div class="snow1" style="position:fixed !important"></div> -->
  <div class="cobweb" style="position:fixed !important"></div>
  <div class="spider" style="position:fixed !important"></div>
<div class="fswitch">é—œé–‰</div>
<div class="snowflakes" aria-hidden="true">
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
  <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
    <div class="snowflake">
 ğŸŒ¹
  </div>
  <div class="snowflake">
 ğŸ’©
  </div>
</div>

<!--
<script>
	function toggleSpell() {
		let spell = document.getElementsByClassName('spell')[0];
		let ghost = document.getElementsByClassName('ghost')[0];
		let noise = document.getElementsByClassName('noise')[0];
		let noise2 = document.getElementsByClassName('noise2')[0];
		if (spell.style.display === 'none') {
			spell.style.display = 'block';
			noise.style.display = '';
			noise2.style.display = '';
			ghost.style.display = 'none';
		} else {
			spell.style.display = 'none';
			noise.style.display = 'none';
			noise2.style.display = 'none';
			ghost.style.display = 'block';
		}
	}

	//è¨‚é–±å…§å®¹
	let spell = document.getElementsByClassName('spell')[0];
	let ghost = document.getElementsByClassName('ghost')[0];
	spell.addEventListener('click',toggleSpell);
	ghost.addEventListener('click',toggleSpell);
</script>
-->

<script>

let cobweb = document.querySelector('.cobweb');
let spider = document.querySelector('.spider');
let back = document.querySelector('.back-to-top');
let fswitch = document.querySelector('.fswitch');

document.addEventListener('keydown', function(event) {
	if (event.key === 'f') {
		console.log('press f key');
		ftoggle();
	}
});

fswitch.addEventListener('click' , function(){ 
	ftoggle();
});

function ftoggle(){
	if(cobweb.style.display === ''){
		cobweb.style.display = 'none';
	}else{
		cobweb.style.display = '';
	}
	if(spider.style.display === ''){
		spider.style.display = 'none';
	}else{
		spider.style.display = '';
	}
	if(back.style.display === ''){
		back.style.display = 'none';
	}else{
		back.style.display = '';
	}

	if(fswitch.innerText === 'é—œé–‰') fswitch.innerText = 'ä¹–ä¹–'
	else fswitch.innerText = 'é—œé–‰'
}



</script>

<script>
class ViNavigation {
  constructor() {
    this.Mode = {
      Normal: "normal",
      Motion: "motion",
    };

    this.lastKeyPressTime = 0;
    this.lastKeyPressed = "";
    this.currentMode = this.Mode.Normal;

    //å¯ä½¿ç”¨ç§»å‹•çš„å­—ç¢¼
    //å…± 18 å€‹å­— æ’é™¤ vi æœƒç”¨åˆ°çš„å­—
    this.tagChars = "ABCEILNOPQRSTVWXYZ";

    //ç›®å‰çš„ vim æ¨™ç¤ºå­—æ¨™ç±¤ array
    this.holdTags = new Array();

    //é å…ˆå»ºç«‹å…©å­—çµ„åˆçš„å­—å…¸
    this.dict = new Array();
    //é›™å±¤è¿´åœˆçŒå…¥æ‰€æœ‰å…©å­—çµ„åˆ
    for (var i = 0; i < this.tagChars.length; i++) {
      for (var j = 0; j < this.tagChars.length; j++) {
        this.dict.push(this.tagChars[i] + this.tagChars[j]);
      }
    }
  }

  viGoTop(keyPressed) {
    if (keyPressed === "g") {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  viGoBottom(keyPressed) {
    if (keyPressed === "G") {
      console.log("document.body.scrollHeight", document.body.scrollHeight);
      let h = Math.max(
        Math.max(
          document.body.scrollHeight,
          document.documentElement.scrollHeight
        ),
        Math.max(
          document.body.offsetHeight,
          document.documentElement.offsetHeight
        ),
        Math.max(
          document.body.clientHeight,
          document.documentElement.clientHeight
        )
      );
      window.scrollTo({ top: h, behavior: "smooth" });
    }
  }

  viFastDown(keyPressed) {
    if (keyPressed === "d") {
      this.move(350);
    }
  }

  viDown(keyPressed) {
    if (keyPressed === "j") {
      this.move(100);
    }
  }

  viFastUp(keyPressed) {
    if (keyPressed === "u") {
      this.move(-350);
    }
  }

  viUp(keyPressed) {
    if (keyPressed === "k") {
      this.move(-100);
    }
  }

  move(val) {
    var currentPosition =
      window.pageYOffset || document.documentElement.scrollTop;
    window.scrollTo({
      top: currentPosition + val,
      behavior: "smooth",
    });
  }

  removeViTags() {
    let allTags = document.querySelectorAll(".vim-tag");
    allTags.forEach(function (tag) {
      tag.parentNode.removeChild(tag);
    });
  }

  createViTag(text, href, top, left) {
    let newDiv = document.createElement("div");
    newDiv.classList.add("vim-tag");
    newDiv.style.fontFamily = "Arial, sans-serif";
    newDiv.style.fontSize = "12px";
    newDiv.style.position = "absolute";
    newDiv.style.backgroundColor = "#89CF07";
    newDiv.style.color = "black";
    newDiv.style.padding = "2px";
    newDiv.style.borderRadius = "2px";
    newDiv.style.zIndex = "999999";

    newDiv.textContent = text;
    newDiv.dataset.href = href;
    newDiv.style.top = top;
    newDiv.style.left = left;
    return newDiv;
  }

  createViTags() {
    let allTags = document.querySelectorAll("a");
    let counter = 0;
    for (let tag of allTags) {
      let rect = tag.getBoundingClientRect();
      let href = tag.href;
      //é€™å€‹è·é›¢éœ€è¦åŠ å…¥å·è»¸è·é›¢æ‰æœƒæ­£ç¢º
      let top = window.scrollY + rect.top + "px";
      let left = window.scrollX + rect.left + "px";
      let text = "";
      if (allTags.length <= this.tagChars.length) {
        text = this.tagChars[counter];
        this.holdTags.push(text);
      } else {
        text = this.dict[counter];
        this.holdTags.push(text);
      }
      let newDiv = this.createViTag(text, href, top, left);
      document.body.appendChild(newDiv);
      counter++;
    }
  }

  //æ‰¾å‡ºç›®å‰çš„é¦–å­— array
  firstCharArray() {
    let result = [];
    for (let i = 0; i < this.holdTags.length; i++) {
      let text = this.holdTags[i];
      if (text) {
        let theChar = text[0].toLowerCase();
        if (result.includes(theChar) === false) {
          result.push(theChar);
        }
      }
    }

    return result;
  }

  toggleMotion() {
    this.currentMode = this.Mode.Motion;
    this.lastKeyPressed = "";
    console.log("mode", this.currentMode);
    this.createViTags();
  }

  toggleNormal() {
    this.currentMode = this.Mode.Normal;
    console.log("mode", this.currentMode);
    this.removeViTags();
    this.holdTags = [];
    this.lastKeyPressed = "";
  }

  handleKeyDown(event) {
    let currentTime = new Date().getTime();
    let keyPressed = event.key;

    //æŒ‰ä¸‹ F æ™‚é€²å…¥ motion æ¨¡å¼
    if (this.currentMode === this.Mode.Normal && keyPressed === "F") {
      this.toggleMotion();
      return;
    }

    //æŒ‰ä¸‹ esc è·³é›¢ motion æ¨¡å¼å›åˆ° normal æ¨¡å¼
    if (this.currentMode === this.Mode.Motion && keyPressed === "Escape") {
      this.toggleNormal();
      return;
    }

    //ç•¶ motion ä¸€å€‹å­—æ™‚æ‰èµ°é€™æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length <= this.tagChars.length &&
      this.tagChars.toLowerCase().includes(keyPressed)
    ) {
      console.log("one char mode");
      let allTags = document.querySelectorAll(".vim-tag");

      allTags.forEach(function (tag) {
        if (tag.textContent.toLowerCase() === keyPressed) {
          window.location.href = tag.dataset.href;
        }
      });

      this.toggleNormal();
      return;
    }

    //ç•¶ motion å…©å€‹å­—æ‰èµ°é€™å€‹æ¨¡å¼
    if (
      this.currentMode === this.Mode.Motion &&
      document.querySelectorAll("a").length > this.tagChars.length
    ) {
      console.log("motion lastKeyPressed", this.lastKeyPressed);
      console.log("motion current", keyPressed);

      if (!this.lastKeyPressed) {
        //å¦‚æœå‡ºç¾å­—è¡¨ä»¥å¤–çš„å­—å‰‡å›åˆ° normal
        //console.log("firstCharArray", this.firstCharArray());
        if (this.firstCharArray().includes(keyPressed) === false) {
          this.toggleNormal();
          return;
        } else {
          let allTags = document.querySelectorAll(".vim-tag");
          allTags.forEach(function (tag) {
            if (tag.textContent[0].toLowerCase() !== keyPressed) {
              tag.parentNode.removeChild(tag);
            }

            //å°‡ç¬¬ä¸€å€‹å­—è®Šç‚ºç´…è‰²
            if (tag.textContent[0].toLowerCase() === keyPressed) {
              tag.innerHTML =
                '<span style="color: red;">' +
                tag.textContent.charAt(0) +
                "</span>" +
                tag.textContent.substring(1);
            }
          });
        }
      }

      //å¦‚æœæœ‰å­—çš„è©±æ‰åŸ·è¡Œ
      if (this.lastKeyPressed) {
        let chars = this.lastKeyPressed + keyPressed;
        console.log("chars", chars);
        let allTags = document.querySelectorAll(".vim-tag");
        allTags.forEach(function (tag) {
          if (tag.textContent.toLowerCase() === chars) {
            window.location.href = tag.dataset.href;
          }
        });
        //è¬ä¸€æ²’æ‰¾åˆ°åˆ‡å› Normal
        this.toggleNormal();
        return;
      }
    }

    // ä»»ä½•æ¨¡å¼æŒ‰å…©ä¸‹çš„å€åŸŸ
    if (
      keyPressed === this.lastKeyPressed &&
      currentTime - this.lastKeyPressTime < 300
    ) {
      this.viGoTop(keyPressed);
    }

    // æŒ‰ä¸€ä¸‹çš„å€åŸŸ
    this.viGoBottom(keyPressed);
    this.viDown(keyPressed);
    this.viFastDown(keyPressed);
    this.viUp(keyPressed);
    this.viFastUp(keyPressed);

    this.lastKeyPressTime = currentTime;
    this.lastKeyPressed = keyPressed;
  }

  init() {
    document.addEventListener("keydown", this.handleKeyDown.bind(this));
  }
}

const viNavigation = new ViNavigation();
viNavigation.init();
</script>



</body>
</html>
